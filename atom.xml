<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>BiJi | 爱你如初</title>
  
  <subtitle>笔迹 · 鱼沈雁杳天涯路，始信人间别离苦</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.ibiji.top/"/>
  <updated>2020-08-04T12:52:31.020Z</updated>
  <id>http://www.ibiji.top/</id>
  
  <author>
    <name>Antler</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>kubernetes 1.15.0 部署</title>
    <link href="http://www.ibiji.top/2020/01/16/%E6%90%AD%E5%BB%BAk8s-1.15.0/"/>
    <id>http://www.ibiji.top/2020/01/16/搭建k8s-1.15.0/</id>
    <published>2020-01-16T14:41:30.000Z</published>
    <updated>2020-08-04T12:52:31.020Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | CentOS 7.6 64位 | 阿里云 | kubernetes 1.15.0 |Docker 19.03.5, build 633a0ea</strong></p><h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld.service </span><br><span class="line"></span><br><span class="line">禁用seliunx</span><br><span class="line"></span><br><span class="line">setenforce 0</span><br><span class="line"></span><br><span class="line">swapoff -a</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="镜像源配置"><a href="#镜像源配置" class="headerlink" title="镜像源配置"></a>镜像源配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yum install wget epel-release -y</span><br><span class="line">cd /etc/yum.repos.d/ &amp;&amp; mkdir bak &amp;&amp; mv -f *.repo bak/</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/docker-ce.repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br><span class="line"></span><br><span class="line">yum -y install iotop iftop yum-utils net-tools git lrzsz expect gcc gcc-c++ make cmake libxml2-devel openssl-devel curl curl-devel unzip sudo ntp libaio-devel wget vim ncurses-devel autoconf automake zlib-devel  python-devel bash-completion</span><br></pre></td></tr></table></figure><h2 id="配置无密钥访问"><a href="#配置无密钥访问" class="headerlink" title="配置无密钥访问"></a>配置无密钥访问</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id &lt;host&gt;</span><br></pre></td></tr></table></figure><h2 id="创建-etc-sysctl-d-k8s-conf-文件"><a href="#创建-etc-sysctl-d-k8s-conf-文件" class="headerlink" title="创建 /etc/sysctl.d/k8s.conf 文件"></a>创建 <code>/etc/sysctl.d/k8s.conf</code> 文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="安装-docker-kubelet-1-15-0"><a href="#安装-docker-kubelet-1-15-0" class="headerlink" title="安装 docker kubelet-1.15.0"></a>安装 <code>docker kubelet-1.15.0</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce-18.06.1.ce</span><br><span class="line"></span><br><span class="line">yum install -y kubelet-1.15.0 kubeadm-1.15.0 kubectl-1.15.0</span><br></pre></td></tr></table></figure><h2 id="slave节点执行-yum-install-y-kubeadm-1-15-0-kubelet-1-15-0"><a href="#slave节点执行-yum-install-y-kubeadm-1-15-0-kubelet-1-15-0" class="headerlink" title="slave节点执行 yum install -y kubeadm-1.15.0 kubelet-1.15.0"></a>slave节点执行 <code>yum install -y kubeadm-1.15.0 kubelet-1.15.0</code></h2><h2 id="docker-kubelet-启动并开机自启"><a href="#docker-kubelet-启动并开机自启" class="headerlink" title="docker kubelet 启动并开机自启"></a><code>docker kubelet</code> 启动并开机自启</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker &amp;&amp; systemctl enable docker</span><br><span class="line"></span><br><span class="line">systemctl start kubelet.service &amp;&amp; systemctl enable kubelet.service</span><br></pre></td></tr></table></figure><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=v1.15.0  --image-repository registry.aliyuncs.com/google_containers --pod-network-cidr=10.244.0.0/16 --service-cidr=10.1.0.0/16 --apiserver-advertise-address=172.17.0.10</span><br><span class="line"></span><br><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure><h2 id="子节点加入"><a href="#子节点加入" class="headerlink" title="子节点加入"></a>子节点加入</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 172.17.0.10:6443 --token u97eh2.ba81kyeg93on6dc1 \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:5a533848690d47872d4370112bc0c2d22e49ac1971bc2486a40e6e6f221951ff</span><br></pre></td></tr></table></figure><h2 id="Docker-配置-vi-etc-docker-daemon-json"><a href="#Docker-配置-vi-etc-docker-daemon-json" class="headerlink" title="Docker 配置 vi /etc/docker/daemon.json"></a>Docker 配置 <code>vi /etc/docker/daemon.json</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;172.17.0.20&quot;],</span><br><span class="line">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="line">  &quot;log-opts&quot;: &#123;</span><br><span class="line">    &quot;max-size&quot;: &quot;20m&quot;,</span><br><span class="line">    &quot;max-file&quot;: &quot;10&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;live-restore&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="重启服务-systemctl-daemon-reload-amp-amp-systemctl-restart-docker-amp-amp-systemctl-restart-kubelet"><a href="#重启服务-systemctl-daemon-reload-amp-amp-systemctl-restart-docker-amp-amp-systemctl-restart-kubelet" class="headerlink" title="重启服务 systemctl daemon-reload &amp;&amp; systemctl restart docker &amp;&amp; systemctl restart kubelet"></a><code>重启服务 systemctl daemon-reload &amp;&amp; systemctl restart docker &amp;&amp; systemctl restart kubelet</code></h2><h2 id="配置flannel网络"><a href="#配置flannel网络" class="headerlink" title="配置flannel网络"></a>配置<code>flannel</code>网络</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kube-flannel.yml</span><br></pre></td></tr></table></figure><h2 id="查看各节点及pods"><a href="#查看各节点及pods" class="headerlink" title="查看各节点及pods"></a>查看各节点及<code>pods</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">master   Ready    master   24m   v1.15.0</span><br><span class="line">slave0   Ready    &lt;none&gt;   13m   v1.15.0</span><br><span class="line">slave1   Ready    &lt;none&gt;   13m   v1.15.0</span><br><span class="line">slave2   Ready    &lt;none&gt;   13m   v1.15.0</span><br><span class="line"></span><br><span class="line">[root@master ~]# kubectl get pods,svc --all-namespaces -o wide</span><br><span class="line">NAMESPACE     NAME                                 READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   pod/coredns-bccdc95cf-9hmjg          1/1     Running   0          24m   10.244.0.2    master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/coredns-bccdc95cf-vq4px          1/1     Running   0          24m   10.244.0.3    master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/etcd-master                      1/1     Running   0          23m   172.17.0.10   master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-apiserver-master            1/1     Running   0          23m   172.17.0.10   master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-controller-manager-master   1/1     Running   0          23m   172.17.0.10   master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-flannel-ds-amd64-cqvbg      1/1     Running   0          11m   172.17.0.11   slave0   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-flannel-ds-amd64-k9pm2      1/1     Running   0          11m   172.17.0.10   master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-flannel-ds-amd64-klsvd      1/1     Running   0          11m   172.17.0.13   slave2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-flannel-ds-amd64-rmg9k      1/1     Running   0          11m   172.17.0.12   slave1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-proxy-4twzz                 1/1     Running   0          13m   172.17.0.12   slave1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-proxy-kps2m                 1/1     Running   0          13m   172.17.0.13   slave2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-proxy-qhztw                 1/1     Running   0          13m   172.17.0.11   slave0   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-proxy-s5h9s                 1/1     Running   0          24m   172.17.0.10   master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-scheduler-master            1/1     Running   0          23m   172.17.0.10   master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE   SELECTOR</span><br><span class="line">default       service/kubernetes   ClusterIP   10.1.0.1     &lt;none&gt;        443/TCP                  24m   &lt;none&gt;</span><br><span class="line">kube-system   service/kube-dns     ClusterIP   10.1.0.10    &lt;none&gt;        53/UDP,53/TCP,9153/TCP   24m   k8s-app=kube-dns</span><br></pre></td></tr></table></figure><h2 id="配置dashboard"><a href="#配置dashboard" class="headerlink" title="配置dashboard"></a>配置<code>dashboard</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kubernetes-dashboard.yaml</span><br></pre></td></tr></table></figure><h2 id="创建集群管理账号"><a href="#创建集群管理账号" class="headerlink" title="创建集群管理账号"></a>创建集群管理账号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl create clusterrolebinding dashboard-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin</span><br><span class="line"></span><br><span class="line">查看 token</span><br><span class="line"></span><br><span class="line">kubectl describe secret -n kube-system dashboard-admin</span><br></pre></td></tr></table></figure><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="查看pod详细信息-kubectl-describe-pod-lt-pod名称-gt-namespace-kube-system"><a href="#查看pod详细信息-kubectl-describe-pod-lt-pod名称-gt-namespace-kube-system" class="headerlink" title="查看pod详细信息 kubectl describe pod &lt;pod名称&gt; --namespace kube-system"></a>查看pod详细信息 <code>kubectl describe pod &lt;pod名称&gt; --namespace kube-system</code></h3><h3 id="查看pod日志信息-kubectl-logs-lt-pod名称-gt-n-kube-system"><a href="#查看pod日志信息-kubectl-logs-lt-pod名称-gt-n-kube-system" class="headerlink" title="查看pod日志信息 kubectl logs &lt;pod名称&gt; -n kube-system"></a>查看pod日志信息 <code>kubectl logs &lt;pod名称&gt; -n kube-system</code></h3><h3 id="删除应用-kubectl-delete-deployment-lt-pod名称-gt-n-kube-system"><a href="#删除应用-kubectl-delete-deployment-lt-pod名称-gt-n-kube-system" class="headerlink" title="删除应用 kubectl delete deployment &lt;pod名称&gt; -n kube-system"></a>删除应用 <code>kubectl delete deployment &lt;pod名称&gt; -n kube-system</code></h3><h3 id="根据label删除-kubectl-delete-pod-l-app-flannel-n-kube-system"><a href="#根据label删除-kubectl-delete-pod-l-app-flannel-n-kube-system" class="headerlink" title="根据label删除 kubectl delete pod -l app=flannel -n kube-system"></a>根据label删除 <code>kubectl delete pod -l app=flannel -n kube-system</code></h3><h3 id="扩容-kubectl-scale-deployment-lt-pod名称-gt-replicas-8"><a href="#扩容-kubectl-scale-deployment-lt-pod名称-gt-replicas-8" class="headerlink" title="扩容 kubectl scale deployment &lt;pod名称&gt; --replicas=8"></a>扩容 <code>kubectl scale deployment &lt;pod名称&gt; --replicas=8</code></h3><h2 id="flannel及dashboard文件"><a href="#flannel及dashboard文件" class="headerlink" title="flannel及dashboard文件"></a><code>flannel</code>及<code>dashboard</code>文件</h2><h3 id="flannel-yml文件"><a href="#flannel-yml文件" class="headerlink" title="flannel.yml文件"></a><code>flannel.yml</code>文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">  - apiGroups:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">""</span></span><br><span class="line"><span class="attr">    resources:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">pods</span></span><br><span class="line"><span class="attr">    verbs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">get</span></span><br><span class="line"><span class="attr">  - apiGroups:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">""</span></span><br><span class="line"><span class="attr">    resources:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">nodes</span></span><br><span class="line"><span class="attr">    verbs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">list</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">watch</span></span><br><span class="line"><span class="attr">  - apiGroups:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">""</span></span><br><span class="line"><span class="attr">    resources:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">nodes/status</span></span><br><span class="line"><span class="attr">    verbs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">patch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">cni-conf.json:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "name": "cbr0",</span></span><br><span class="line"><span class="string">      "plugins": [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          "type": "flannel",</span></span><br><span class="line"><span class="string">          "delegate": &#123;</span></span><br><span class="line"><span class="string">            "hairpinMode": true,</span></span><br><span class="line"><span class="string">            "isDefaultGateway": true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          "type": "portmap",</span></span><br><span class="line"><span class="string">          "capabilities": &#123;</span></span><br><span class="line"><span class="string">            "portMappings": true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  net-conf.json: |</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "Network": "10.244.0.0/16",</span></span><br><span class="line"><span class="string">      "Backend": &#123;</span></span><br><span class="line"><span class="string">        "Type": "vxlan"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kube-flannel-ds-amd64</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      hostNetwork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      nodeSelector:</span></span><br><span class="line">        <span class="string">beta.kubernetes.io/arch:</span> <span class="string">amd64</span></span><br><span class="line"><span class="attr">      tolerations:</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node.kubernetes.io/not-ready</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">install-cni</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-amd64</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">cp</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">-f</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-amd64</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--ip-masq</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--kube-subnet-mgr</span></span><br><span class="line"><span class="attr">        resources:</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          configMap:</span></span><br><span class="line"><span class="attr">            name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kube-flannel-ds-arm64</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      hostNetwork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      nodeSelector:</span></span><br><span class="line">        <span class="string">beta.kubernetes.io/arch:</span> <span class="string">arm64</span></span><br><span class="line"><span class="attr">      tolerations:</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node.kubernetes.io/not-ready</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">install-cni</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-arm64</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">cp</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">-f</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-arm64</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--ip-masq</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--kube-subnet-mgr</span></span><br><span class="line"><span class="attr">        resources:</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          configMap:</span></span><br><span class="line"><span class="attr">            name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kube-flannel-ds-arm</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      hostNetwork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      nodeSelector:</span></span><br><span class="line">        <span class="string">beta.kubernetes.io/arch:</span> <span class="string">arm</span></span><br><span class="line"><span class="attr">      tolerations:</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node.kubernetes.io/not-ready</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">install-cni</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-arm</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">cp</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">-f</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-arm</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--ip-masq</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--kube-subnet-mgr</span></span><br><span class="line"><span class="attr">        resources:</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          configMap:</span></span><br><span class="line"><span class="attr">            name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kube-flannel-ds-ppc64le</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      hostNetwork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      nodeSelector:</span></span><br><span class="line">        <span class="string">beta.kubernetes.io/arch:</span> <span class="string">ppc64le</span></span><br><span class="line"><span class="attr">      tolerations:</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node.kubernetes.io/not-ready</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">install-cni</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-ppc64le</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">cp</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">-f</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-ppc64le</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--ip-masq</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--kube-subnet-mgr</span></span><br><span class="line"><span class="attr">        resources:</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          configMap:</span></span><br><span class="line"><span class="attr">            name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kube-flannel-ds-s390x</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        tier:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      hostNetwork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      nodeSelector:</span></span><br><span class="line">        <span class="string">beta.kubernetes.io/arch:</span> <span class="string">s390x</span></span><br><span class="line"><span class="attr">      tolerations:</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node.kubernetes.io/not-ready</span></span><br><span class="line"><span class="attr">        operator:</span> <span class="string">Exists</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">install-cni</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-s390x</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">cp</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">-f</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">quay.io/coreos/flannel:v0.10.0-s390x</span></span><br><span class="line"><span class="attr">        command:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--ip-masq</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--kube-subnet-mgr</span></span><br><span class="line"><span class="attr">        resources:</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="string">"100m"</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="string">"50Mi"</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">run</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">cni</span></span><br><span class="line"><span class="attr">          hostPath:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">flannel-cfg</span></span><br><span class="line"><span class="attr">          configMap:</span></span><br><span class="line"><span class="attr">            name:</span> <span class="string">kube-flannel-cfg</span></span><br></pre></td></tr></table></figure><h3 id="dashboard-yaml文件"><a href="#dashboard-yaml文件" class="headerlink" title="dashboard.yaml文件"></a><code>dashboard.yaml</code>文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright 2017 The Kubernetes Authors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the "License");</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configuration to deploy release version of the Dashboard UI compatible with</span></span><br><span class="line"><span class="comment"># Kubernetes 1.8.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example usage: kubectl create -f &lt;this_file&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- Dashboard Secret ------------------- #</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ------------------- Dashboard Service Account ------------------- #</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ------------------- Dashboard Role &amp; Role Binding ------------------- #</span></span><br><span class="line"></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard-minimal</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># Allow Dashboard to create 'kubernetes-dashboard2-key-holder' secret.</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["secrets"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["create"]</span></span><br><span class="line">  <span class="comment"># Allow Dashboard to create 'kubernetes-dashboard2-settings' config map.</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["configmaps"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["create"]</span></span><br><span class="line">  <span class="comment"># Allow Dashboard to get, update and delete Dashboard exclusive secrets.</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["secrets"]</span></span><br><span class="line"><span class="attr">  resourceNames:</span> <span class="string">["kubernetes-dashboard-key-holder",</span> <span class="string">"kubernetes-dashboard-certs"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"update"</span><span class="string">,</span> <span class="string">"delete"</span><span class="string">]</span></span><br><span class="line">  <span class="comment"># Allow Dashboard to get and update 'kubernetes-dashboard2-settings' config map.</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["configmaps"]</span></span><br><span class="line"><span class="attr">  resourceNames:</span> <span class="string">["kubernetes-dashboard-settings"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"update"</span><span class="string">]</span></span><br><span class="line">  <span class="comment"># Allow Dashboard to get metrics from heapster.</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["services"]</span></span><br><span class="line"><span class="attr">  resourceNames:</span> <span class="string">["heapster"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["proxy"]</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["services/proxy"]</span></span><br><span class="line"><span class="attr">  resourceNames:</span> <span class="string">["heapster",</span> <span class="string">"http:heapster:"</span><span class="string">,</span> <span class="string">"https:heapster:"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get"]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard-minimal</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard-minimal</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ------------------- Dashboard Deployment ------------------- #</span></span><br><span class="line"></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">8443</span></span><br><span class="line"><span class="attr">          protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">--auto-generate-certificates</span></span><br><span class="line">          <span class="comment"># Uncomment the following line to manually specify Kubernetes API server Host</span></span><br><span class="line">          <span class="comment"># If not specified, Dashboard will attempt to auto discover the API server and connect</span></span><br><span class="line">          <span class="comment"># to it. Uncomment only if the default does not work.</span></span><br><span class="line">          <span class="comment"># - --apiserver-host=http://my-address:port</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/certs</span></span><br><span class="line">          <span class="comment"># Create on-disk volume to store exec logs</span></span><br><span class="line"><span class="attr">        - mountPath:</span> <span class="string">/tmp</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">tmp-volume</span></span><br><span class="line"><span class="attr">        livenessProbe:</span></span><br><span class="line"><span class="attr">          httpGet:</span></span><br><span class="line"><span class="attr">            scheme:</span> <span class="string">HTTPS</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">            port:</span> <span class="number">8443</span></span><br><span class="line"><span class="attr">          initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">          timeoutSeconds:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line"><span class="attr">        secret:</span></span><br><span class="line"><span class="attr">          secretName:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">tmp-volume</span></span><br><span class="line"><span class="attr">        emptyDir:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">      <span class="comment"># Comment the following tolerations if Dashboard must not be deployed on master</span></span><br><span class="line"><span class="attr">      tolerations:</span></span><br><span class="line"><span class="attr">      - key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line"><span class="attr">        effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ------------------- Dashboard Service ------------------- #</span></span><br><span class="line"></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">8443</span></span><br><span class="line"><span class="attr">      nodePort:</span> <span class="number">30001</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | CentOS 7.6 64位 | 阿里云 | kubernetes 1.15.0 |Docker 19.03.5, build 633a0ea&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;关闭防火墙&quot;&gt;&lt;a href=&quot;#关闭防火墙&quot; class=&quot;headerlink&quot; title=&quot;关闭防火墙&quot;&gt;&lt;/a&gt;关闭防火墙&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;systemctl disable firewalld.service &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;禁用seliunx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;setenforce 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;swapoff -a&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="linux" scheme="http://www.ibiji.top/categories/linux/"/>
    
      <category term="k8s" scheme="http://www.ibiji.top/categories/linux/k8s/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/linux/k8s/centos/"/>
    
      <category term="部署" scheme="http://www.ibiji.top/categories/linux/k8s/centos/%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="部署" scheme="http://www.ibiji.top/tags/%E9%83%A8%E7%BD%B2/"/>
    
      <category term="k8s" scheme="http://www.ibiji.top/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>SQLServer向HDFS迁移(导入)</title>
    <link href="http://www.ibiji.top/2019/11/13/SQLServer%E5%90%91HDFS%E8%BF%81%E7%A7%BB(%E5%AF%BC%E5%85%A5)/"/>
    <id>http://www.ibiji.top/2019/11/13/SQLServer向HDFS迁移(导入)/</id>
    <published>2019-11-13T14:30:40.000Z</published>
    <updated>2020-08-04T12:52:30.999Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | windows 7 | sqoop 1.4.7 | hadoop-2.7.7 | hive-1.2.2 | SQLServer 2005 | VMware Workstation 15 Pro</strong></p><h2 id="SQLServer-导入HDFS-命令"><a href="#SQLServer-导入HDFS-命令" class="headerlink" title="SQLServer 导入HDFS 命令"></a>SQLServer 导入HDFS 命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./sqoop import \</span><br><span class="line">--connect 'jdbc:sqlserver://192.168.1.171;username=sa;password=sa;database=db' \</span><br><span class="line">--table=data_dictonary_test \</span><br><span class="line">--target-dir /sqlserver/output \</span><br><span class="line">-m 1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;运行环境 | windows 7 | sqoop 1.4.7 | hadoop-2.7.7 | hive-1.2.2 | SQLServer 2005 | VMware Workstation 15 Pro&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;SQLS
      
    
    </summary>
    
      <category term="linux" scheme="http://www.ibiji.top/categories/linux/"/>
    
      <category term="SQLServer" scheme="http://www.ibiji.top/categories/linux/SQLServer/"/>
    
      <category term="windows" scheme="http://www.ibiji.top/categories/linux/SQLServer/windows/"/>
    
      <category term="sqoop" scheme="http://www.ibiji.top/categories/linux/SQLServer/windows/sqoop/"/>
    
    
      <category term="SQLServer" scheme="http://www.ibiji.top/tags/SQLServer/"/>
    
      <category term="HDFS" scheme="http://www.ibiji.top/tags/HDFS/"/>
    
      <category term="sqoop" scheme="http://www.ibiji.top/tags/sqoop/"/>
    
  </entry>
  
  <entry>
    <title>Oracle向HDFS迁移(导入)数据报错</title>
    <link href="http://www.ibiji.top/2019/11/13/Oracle%E5%90%91HDFS%E8%BF%81%E7%A7%BB(%E5%AF%BC%E5%85%A5)%E6%95%B0%E6%8D%AE%E6%8A%A5%E9%94%99/"/>
    <id>http://www.ibiji.top/2019/11/13/Oracle向HDFS迁移(导入)数据报错/</id>
    <published>2019-11-13T14:12:40.000Z</published>
    <updated>2020-08-04T12:52:30.999Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | sqoop 1.4.7 | hadoop-2.7.7 | hive-1.2.2 | oracle 12C | MySQL5.7.28 | jdk1.8 | VMware Workstation 15 Pro</strong></p><h2 id="Oracle导入HDFS-命令"><a href="#Oracle导入HDFS-命令" class="headerlink" title="Oracle导入HDFS 命令"></a>Oracle导入HDFS 命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./sqoop import --connect jdbc:oracle:thin:@192.168.11.53:1521:oracledb \</span><br><span class="line">--username HIVE --password root123 \</span><br><span class="line">--table EXPHIVE -m 1 \</span><br><span class="line">--target-dir /oracle/output</span><br></pre></td></tr></table></figure><h2 id="报错表或视图不存在"><a href="#报错表或视图不存在" class="headerlink" title="报错表或视图不存在"></a>报错<code>表或视图不存在</code></h2><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">19/11/13 09:49:20 ERROR manager.SqlManager: Error executing statement: java.sql.SQLSyntaxErrorException: ORA-00942: 表或视图不存在</span><br><span class="line"></span><br><span class="line">java.sql.SQLSyntaxErrorException: ORA-00942: 表或视图不存在</span><br><span class="line"></span><br><span class="line">        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:494)</span><br><span class="line">        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:446)</span><br><span class="line">        at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1054)</span><br><span class="line">        at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:623)</span><br><span class="line">        at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:252)</span><br><span class="line">        at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:612)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:226)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:59)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.executeForDescribe(T4CPreparedStatement.java:747)</span><br><span class="line">        at oracle.jdbc.driver.OracleStatement.executeMaybeDescribe(OracleStatement.java:904)</span><br><span class="line">        at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1082)</span><br><span class="line">        at oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:3780)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.executeInternal(T4CPreparedStatement.java:1343)</span><br><span class="line">        at oracle.jdbc.driver.OraclePreparedStatement.executeQuery(OraclePreparedStatement.java:3822)</span><br><span class="line">        at oracle.jdbc.driver.OraclePreparedStatementWrapper.executeQuery(OraclePreparedStatementWrapper.java:1165)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.execute(SqlManager.java:777)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.execute(SqlManager.java:786)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.getColumnInfoForRawQuery(SqlManager.java:289)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.getColumnTypesForRawQuery(SqlManager.java:260)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.getColumnTypes(SqlManager.java:246)</span><br><span class="line">        at org.apache.sqoop.manager.ConnManager.getColumnTypes(ConnManager.java:327)</span><br><span class="line">        at org.apache.sqoop.orm.ClassWriter.getColumnTypes(ClassWriter.java:1872)</span><br><span class="line">        at org.apache.sqoop.orm.ClassWriter.generate(ClassWriter.java:1671)</span><br><span class="line">        at org.apache.sqoop.tool.CodeGenTool.generateORM(CodeGenTool.java:106)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.importTable(ImportTool.java:501)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.run(ImportTool.java:628)</span><br><span class="line">        at org.apache.sqoop.Sqoop.run(Sqoop.java:147)</span><br><span class="line">        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runSqoop(Sqoop.java:183)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:234)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:243)</span><br><span class="line">        at org.apache.sqoop.Sqoop.main(Sqoop.java:252)</span><br><span class="line">Caused by: Error : 942, Position : 16, Sql = SELECT t.* FROM TEST t WHERE 1=0, OriginalSql = SELECT t.* FROM TEST t WHERE 1=0, Error Msg = ORA-00942: 表或视图不存在</span><br><span class="line"></span><br><span class="line">        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:498)</span><br><span class="line">        ... 31 more</span><br><span class="line">19/11/13 09:49:20 ERROR tool.ImportTool: Import failed: java.io.IOException: No columns to generate for ClassWriter</span><br><span class="line">        at org.apache.sqoop.orm.ClassWriter.generate(ClassWriter.java:1677)</span><br><span class="line">        at org.apache.sqoop.tool.CodeGenTool.generateORM(CodeGenTool.java:106)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.importTable(ImportTool.java:501)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.run(ImportTool.java:628)</span><br><span class="line">        at org.apache.sqoop.Sqoop.run(Sqoop.java:147)</span><br><span class="line">        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runSqoop(Sqoop.java:183)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:234)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:243)</span><br><span class="line">        at org.apache.sqoop.Sqoop.main(Sqoop.java:252)</span><br></pre></td></tr></table></figure><h2 id="报错标识符无效"><a href="#报错标识符无效" class="headerlink" title="报错标识符无效"></a>报错<code>标识符无效</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">Error: java.io.IOException: SQLException in nextKeyValue</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBRecordReader.nextKeyValue(DBRecordReader.java:277)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask$NewTrackingRecordReader.nextKeyValue(MapTask.java:556)</span><br><span class="line">        at org.apache.hadoop.mapreduce.task.MapContextImpl.nextKeyValue(MapContextImpl.java:80)</span><br><span class="line">        at org.apache.hadoop.mapreduce.lib.map.WrappedMapper$Context.nextKeyValue(WrappedMapper.java:91)</span><br><span class="line">        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)</span><br><span class="line">        at org.apache.sqoop.mapreduce.AutoProgressMapper.run(AutoProgressMapper.java:64)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:787)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:164)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at javax.security.auth.Subject.doAs(Subject.java:422)</span><br><span class="line">        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1762)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)</span><br><span class="line">Caused by: java.sql.SQLSyntaxErrorException: ORA-00904: "NAME": 标识符无效</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">19/11/13 09:52:08 INFO mapreduce.Job: Task Id : attempt_1573608552785_0010_m_000000_2, Status : FAILED</span><br><span class="line">Error: java.io.IOException: SQLException in nextKeyValue</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBRecordReader.nextKeyValue(DBRecordReader.java:277)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask$NewTrackingRecordReader.nextKeyValue(MapTask.java:556)</span><br><span class="line">        at org.apache.hadoop.mapreduce.task.MapContextImpl.nextKeyValue(MapContextImpl.java:80)</span><br><span class="line">        at org.apache.hadoop.mapreduce.lib.map.WrappedMapper$Context.nextKeyValue(WrappedMapper.java:91)</span><br><span class="line">        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)</span><br><span class="line">        at org.apache.sqoop.mapreduce.AutoProgressMapper.run(AutoProgressMapper.java:64)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:787)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:164)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at javax.security.auth.Subject.doAs(Subject.java:422)</span><br><span class="line">        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1762)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)</span><br><span class="line">Caused by: java.sql.SQLSyntaxErrorException: ORA-00904: "NAME": 标识符无效</span><br><span class="line"></span><br><span class="line">        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:494)</span><br><span class="line">        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:446)</span><br><span class="line">        at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1054)</span><br><span class="line">        at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:623)</span><br><span class="line">        at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:252)</span><br><span class="line">        at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:612)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:226)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:59)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.executeForDescribe(T4CPreparedStatement.java:747)</span><br><span class="line">        at oracle.jdbc.driver.OracleStatement.executeMaybeDescribe(OracleStatement.java:904)</span><br><span class="line">        at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1082)</span><br><span class="line">        at oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:3780)</span><br><span class="line">        at oracle.jdbc.driver.T4CPreparedStatement.executeInternal(T4CPreparedStatement.java:1343)</span><br><span class="line">        at oracle.jdbc.driver.OraclePreparedStatement.executeQuery(OraclePreparedStatement.java:3822)</span><br><span class="line">        at oracle.jdbc.driver.OraclePreparedStatementWrapper.executeQuery(OraclePreparedStatementWrapper.java:1165)</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBRecordReader.executeQuery(DBRecordReader.java:111)</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBRecordReader.nextKeyValue(DBRecordReader.java:235)</span><br><span class="line">        ... 12 more</span><br><span class="line">Caused by: Error : 904, Position : 11, Sql = SELECT id, name FROM TEST WHERE ( 1=1 ) AND ( 1=1 ), OriginalSql = SELECT id, name FROM TEST WHERE ( 1=1 ) AND ( 1=1 ), Error Msg = ORA-00904: "NAME": 标识符无效</span><br><span class="line"></span><br><span class="line">        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:498)</span><br><span class="line">        ... 28 more</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">19/11/13 09:52:12 ERROR tool.ImportTool: Import failed: Import job failed!</span><br></pre></td></tr></table></figure><h3 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h3><blockquote><p>以上错误将 Oracle数据库中表名与字段名改为大写，在次运行成功</p></blockquote><h2 id="报错java-sql-SQLException-Listener-refused-the-connection-with-the-following-error-ORA-12505-TNS-listener-does-not-currently-know-of-SID-given-in-connect-descriptor"><a href="#报错java-sql-SQLException-Listener-refused-the-connection-with-the-following-error-ORA-12505-TNS-listener-does-not-currently-know-of-SID-given-in-connect-descriptor" class="headerlink" title="报错java.sql.SQLException: Listener refused the connection with the following error:ORA-12505, TNS:listener does not currently know of SID given in connect descriptor"></a>报错<code>java.sql.SQLException: Listener refused the connection with the following error:ORA-12505, TNS:listener does not currently know of SID given in connect descriptor</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">19/11/13 09:54:16 ERROR manager.SqlManager: Error executing statement: java.sql.SQLException: Listener refused the connection with the following error:</span><br><span class="line">ORA-12505, TNS:listener does not currently know of SID given in connect descriptor</span><br><span class="line"> </span><br><span class="line">java.sql.SQLException: Listener refused the connection with the following error:</span><br><span class="line">ORA-12505, TNS:listener does not currently know of SID given in connect descriptor</span><br><span class="line"> </span><br><span class="line">        at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:774)</span><br><span class="line">        at oracle.jdbc.driver.PhysicalConnection.connect(PhysicalConnection.java:688)</span><br><span class="line">        at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:39)</span><br><span class="line">        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:691)</span><br><span class="line">        at java.sql.DriverManager.getConnection(DriverManager.java:664)</span><br><span class="line">        at java.sql.DriverManager.getConnection(DriverManager.java:247)</span><br><span class="line">        at org.apache.sqoop.manager.OracleManager.makeConnection(OracleManager.java:329)</span><br><span class="line">        at org.apache.sqoop.manager.GenericJdbcManager.getConnection(GenericJdbcManager.java:59)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.execute(SqlManager.java:763)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.execute(SqlManager.java:786)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.getColumnInfoForRawQuery(SqlManager.java:289)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.getColumnTypesForRawQuery(SqlManager.java:260)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.getColumnTypes(SqlManager.java:246)</span><br><span class="line">        at org.apache.sqoop.manager.ConnManager.getColumnTypes(ConnManager.java:327)</span><br><span class="line">        at org.apache.sqoop.orm.ClassWriter.getColumnTypes(ClassWriter.java:1872)</span><br><span class="line">        at org.apache.sqoop.orm.ClassWriter.generate(ClassWriter.java:1671)</span><br><span class="line">        at org.apache.sqoop.tool.CodeGenTool.generateORM(CodeGenTool.java:106)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.importTable(ImportTool.java:501)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.run(ImportTool.java:628)</span><br><span class="line">        at org.apache.sqoop.Sqoop.run(Sqoop.java:147)</span><br><span class="line">        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runSqoop(Sqoop.java:183)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:234)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:243)</span><br><span class="line">        at org.apache.sqoop.Sqoop.main(Sqoop.java:252)</span><br><span class="line">Caused by: oracle.net.ns.NetException: Listener refused the connection with the following error:</span><br><span class="line">ORA-12505, TNS:listener does not currently know of SID given in connect descriptor</span><br><span class="line"> </span><br><span class="line">        at oracle.net.ns.NSProtocolNIO.negotiateConnection(NSProtocolNIO.java:271)</span><br><span class="line">        at oracle.net.ns.NSProtocol.connect(NSProtocol.java:317)</span><br><span class="line">        at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1438)</span><br><span class="line">        at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:518)</span><br><span class="line">        ... 24 more</span><br><span class="line">19/11/13 09:54:16 ERROR tool.ImportTool: Import failed: java.io.IOException: No columns to generate for ClassWriter</span><br><span class="line">        at org.apache.sqoop.orm.ClassWriter.generate(ClassWriter.java:1677)</span><br><span class="line">        at org.apache.sqoop.tool.CodeGenTool.generateORM(CodeGenTool.java:106)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.importTable(ImportTool.java:501)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.run(ImportTool.java:628)</span><br><span class="line">        at org.apache.sqoop.Sqoop.run(Sqoop.java:147)</span><br><span class="line">        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runSqoop(Sqoop.java:183)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:234)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:243)</span><br><span class="line">        at org.apache.sqoop.Sqoop.main(Sqoop.java:252)</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="解决方法：-1"><a href="#解决方法：-1" class="headerlink" title="解决方法："></a>解决方法：</h3><blockquote><p>填写Oracle数据库中对应SID(不是server ID)，在次运行成功</p></blockquote><h2 id="报错ERROR-tool-ImportTool-Import-failed-org-apache-hadoop-mapred-FileAlreadyExistsException-Output-directory-hdfs-master-9000-oracle-output-already-exists"><a href="#报错ERROR-tool-ImportTool-Import-failed-org-apache-hadoop-mapred-FileAlreadyExistsException-Output-directory-hdfs-master-9000-oracle-output-already-exists" class="headerlink" title="报错ERROR tool.ImportTool: Import failed: org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://master:9000/oracle/output already exists"></a>报错<code>ERROR tool.ImportTool: Import failed: org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://master:9000/oracle/output already exists</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">19/11/15 10:37:45 ERROR tool.ImportTool: Import failed: org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://master:9000/oracle/output already exists</span><br><span class="line">        at org.apache.hadoop.mapreduce.lib.output.FileOutputFormat.checkOutputSpecs(FileOutputFormat.java:146)</span><br><span class="line">        at org.apache.hadoop.mapreduce.JobSubmitter.checkSpecs(JobSubmitter.java:266)</span><br><span class="line">        at org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:139)</span><br><span class="line">        at org.apache.hadoop.mapreduce.Job$10.run(Job.java:1290)</span><br><span class="line">        at org.apache.hadoop.mapreduce.Job$10.run(Job.java:1287)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at javax.security.auth.Subject.doAs(Subject.java:422)</span><br><span class="line">        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1762)</span><br><span class="line">        at org.apache.hadoop.mapreduce.Job.submit(Job.java:1287)</span><br><span class="line">        at org.apache.hadoop.mapreduce.Job.waitForCompletion(Job.java:1308)</span><br><span class="line">        at org.apache.sqoop.mapreduce.ImportJobBase.doSubmitJob(ImportJobBase.java:200)</span><br><span class="line">        at org.apache.sqoop.mapreduce.ImportJobBase.runJob(ImportJobBase.java:173)</span><br><span class="line">        at org.apache.sqoop.mapreduce.ImportJobBase.runImport(ImportJobBase.java:270)</span><br><span class="line">        at org.apache.sqoop.manager.SqlManager.importTable(SqlManager.java:692)</span><br><span class="line">        at org.apache.sqoop.manager.OracleManager.importTable(OracleManager.java:454)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.importTable(ImportTool.java:520)</span><br><span class="line">        at org.apache.sqoop.tool.ImportTool.run(ImportTool.java:628)</span><br><span class="line">        at org.apache.sqoop.Sqoop.run(Sqoop.java:147)</span><br><span class="line">        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runSqoop(Sqoop.java:183)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:234)</span><br><span class="line">        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:243)</span><br><span class="line">        at org.apache.sqoop.Sqoop.main(Sqoop.java:252)</span><br></pre></td></tr></table></figure><h3 id="解决方法：-2"><a href="#解决方法：-2" class="headerlink" title="解决方法："></a>解决方法：</h3><blockquote><p>HDFS 目录已存在，删除问题解决</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | sqoop 1.4.7 | hadoop-2.7.7 | hive-1.2.2 | oracle 12C | MySQL5.7.28 | jdk1.8 | VMware Workstation 15 Pro&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;Oracle导入HDFS-命令&quot;&gt;&lt;a href=&quot;#Oracle导入HDFS-命令&quot; class=&quot;headerlink&quot; title=&quot;Oracle导入HDFS 命令&quot;&gt;&lt;/a&gt;Oracle导入HDFS 命令&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./sqoop import --connect jdbc:oracle:thin:@192.168.11.53:1521:oracledb \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--username HIVE --password root123 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--table EXPHIVE -m 1 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--target-dir /oracle/output&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;报错表或视图不存在&quot;&gt;&lt;a href=&quot;#报错表或视图不存在&quot; class=&quot;headerlink&quot; title=&quot;报错表或视图不存在&quot;&gt;&lt;/a&gt;报错&lt;code&gt;表或视图不存在&lt;/code&gt;&lt;/h2&gt;
    
    </summary>
    
      <category term="linux" scheme="http://www.ibiji.top/categories/linux/"/>
    
      <category term="Oracle" scheme="http://www.ibiji.top/categories/linux/Oracle/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/linux/Oracle/centos/"/>
    
      <category term="sqoop" scheme="http://www.ibiji.top/categories/linux/Oracle/centos/sqoop/"/>
    
    
      <category term="HDFS" scheme="http://www.ibiji.top/tags/HDFS/"/>
    
      <category term="sqoop" scheme="http://www.ibiji.top/tags/sqoop/"/>
    
      <category term="Oracle" scheme="http://www.ibiji.top/tags/Oracle/"/>
    
  </entry>
  
  <entry>
    <title>nginx + tomcat 集群测试</title>
    <link href="http://www.ibiji.top/2019/08/28/TomcatNginxab%E6%B5%8B%E8%AF%95/"/>
    <id>http://www.ibiji.top/2019/08/28/TomcatNginxab测试/</id>
    <published>2019-08-28T13:23:30.000Z</published>
    <updated>2020-08-04T12:52:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境| centos 7.0 | VMware Workstation 15 Pro | tomcat 8.5 | nginx 1.14.2</strong></p><p>Tomcat集群 + Nginx负载均衡测试</p><h2 id="测试命令："><a href="#测试命令：" class="headerlink" title="测试命令："></a>测试命令：</h2><p><code>ab -n20000 -c1000 http://192.168.244.10/drp/index.jsp</code></p><a id="more"></a><h2 id="Nginx-Tomcat集群测试结果"><a href="#Nginx-Tomcat集群测试结果" class="headerlink" title="Nginx + Tomcat集群测试结果"></a>Nginx + Tomcat集群测试结果</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Server Software:        nginx/1.14.2</span><br><span class="line">Server Hostname:        192.168.244.10</span><br><span class="line">Server Port:            80</span><br><span class="line"></span><br><span class="line">Document Path:          /drp/index.jsp</span><br><span class="line">Document Length:        216 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      1000</span><br><span class="line">Time taken for tests:   9.126 seconds</span><br><span class="line">Complete requests:      20000</span><br><span class="line">Failed requests:        488</span><br><span class="line">   (Connect: 0, Receive: 0, Length: 488, Exceptions: 0)</span><br><span class="line">Write errors:           0</span><br><span class="line">Non-2xx responses:      488</span><br><span class="line">Total transferred:      8973152 bytes</span><br><span class="line">HTML transferred:       4308776 bytes</span><br><span class="line">Requests per second:    2191.63 [#/sec] (mean)</span><br><span class="line">Time per request:       456.282 [ms] (mean)</span><br><span class="line">Time per request:       0.456 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          960.24 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0  226 628.0      0    7000</span><br><span class="line">Processing:     0  146 325.0     51    7122</span><br><span class="line">Waiting:        0  146 325.0     51    7122</span><br><span class="line">Total:          1  372 757.6     60    8422</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line"><span class="meta">  50%</span>     60</span><br><span class="line"><span class="meta">  66%</span>    147</span><br><span class="line"><span class="meta">  75%</span>    260</span><br><span class="line"><span class="meta">  80%</span>    385</span><br><span class="line"><span class="meta">  90%</span>   1070</span><br><span class="line"><span class="meta">  95%</span>   1831</span><br><span class="line"><span class="meta">  98%</span>   3062</span><br><span class="line"><span class="meta">  99%</span>   3230</span><br><span class="line"><span class="meta"> 100%</span>   8422 (longest request)</span><br></pre></td></tr></table></figure><h2 id="Tomcat-集群测试结果"><a href="#Tomcat-集群测试结果" class="headerlink" title="Tomcat 集群测试结果"></a>Tomcat 集群测试结果</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Server Software:        </span><br><span class="line">Server Hostname:        192.168.244.11</span><br><span class="line">Server Port:            8080</span><br><span class="line"></span><br><span class="line">Document Path:          /drp/index.jsp</span><br><span class="line">Document Length:        216 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      1000</span><br><span class="line">Time taken for tests:   5.161 seconds</span><br><span class="line">Complete requests:      20000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Write errors:           0</span><br><span class="line">Total transferred:      8733153 bytes</span><br><span class="line">HTML transferred:       4397112 bytes</span><br><span class="line">Requests per second:    3875.41 [#/sec] (mean)</span><br><span class="line">Time per request:       258.037 [ms] (mean)</span><br><span class="line">Time per request:       0.258 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          1652.56 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0  153 282.6     70    1125</span><br><span class="line">Processing:    17   96  51.3     85    2010</span><br><span class="line">Waiting:        0   74  44.9     69    2004</span><br><span class="line">Total:         28  250 294.5    167    2025</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line"><span class="meta">  50%</span>    167</span><br><span class="line"><span class="meta">  66%</span>    186</span><br><span class="line"><span class="meta">  75%</span>    198</span><br><span class="line"><span class="meta">  80%</span>    210</span><br><span class="line"><span class="meta">  90%</span>    293</span><br><span class="line"><span class="meta">  95%</span>   1185</span><br><span class="line"><span class="meta">  98%</span>   1219</span><br><span class="line"><span class="meta">  99%</span>   1232</span><br><span class="line"><span class="meta"> 100%</span>   2025 (longest request)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境| centos 7.0 | VMware Workstation 15 Pro | tomcat 8.5 | nginx 1.14.2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Tomcat集群 + Nginx负载均衡测试&lt;/p&gt;
&lt;h2 id=&quot;测试命令：&quot;&gt;&lt;a href=&quot;#测试命令：&quot; class=&quot;headerlink&quot; title=&quot;测试命令：&quot;&gt;&lt;/a&gt;测试命令：&lt;/h2&gt;&lt;p&gt;&lt;code&gt;ab -n20000 -c1000 http://192.168.244.10/drp/index.jsp&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="测试" scheme="http://www.ibiji.top/categories/%E6%B5%8B%E8%AF%95/"/>
    
      <category term="nginx" scheme="http://www.ibiji.top/categories/%E6%B5%8B%E8%AF%95/nginx/"/>
    
    
      <category term="tomcat" scheme="http://www.ibiji.top/tags/tomcat/"/>
    
      <category term="测试" scheme="http://www.ibiji.top/tags/%E6%B5%8B%E8%AF%95/"/>
    
      <category term="nginx" scheme="http://www.ibiji.top/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Hive启动报错2</title>
    <link href="http://www.ibiji.top/2019/08/25/Hive%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%992/"/>
    <id>http://www.ibiji.top/2019/08/25/Hive启动报错2/</id>
    <published>2019-08-25T15:41:30.000Z</published>
    <updated>2020-08-04T12:52:30.997Z</updated>
    
    <content type="html"><![CDATA[<h2 id="启动Hive报错"><a href="#启动Hive报错" class="headerlink" title="启动Hive报错"></a>启动Hive报错</h2><blockquote><p>Error: Failed to open new session: java.lang.RuntimeException: java.lang.RuntimeException: org.apache.hadoop.security.AccessControlException: Permission denied: user=anonymous, access=EXECUTE, inode=”/tmp”:root:supergroup:drwx——</p></blockquote><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Connecting to jdbc:hive2://master:10000</span><br><span class="line">Error: Failed to open new session: java.lang.RuntimeException: java.lang.RuntimeException: org.apache.hadoop.security.AccessControlException: Permission denied: user=anonymous, access=EXECUTE, inode="/tmp":root:supergroup:drwx------</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:318)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkTraverse(FSPermissionChecker.java:279)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:206)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:189)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkTraverse(FSPermissionChecker.java:507)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkTraverse(FSDirectory.java:1612)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkTraverse(FSDirectory.java:1630)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolvePath(FSDirectory.java:551)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getFileInfo(FSDirStatAndListingOp.java:110)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getFileInfo(FSNamesystem.java:3000)</span><br><span class="line">        at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getFileInfo(NameNodeRpcServer.java:1107)</span><br><span class="line">        at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getFileInfo(ClientNamenodeProtocolServerSideTranslatorPB.java:873)</span><br><span class="line">        at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)</span><br><span class="line">        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:447)</span><br><span class="line">        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:989)</span><br><span class="line">        at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:850)</span><br><span class="line">        at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:793)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at javax.security.auth.Subject.doAs(Subject.java:422)</span><br><span class="line">        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)</span><br><span class="line">        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2489) (state=,code=0)</span><br><span class="line">Beeline version 1.2.2 by Apache Hive</span><br></pre></td></tr></table></figure><h2 id="进入Hive后"><a href="#进入Hive后" class="headerlink" title="进入Hive后"></a>进入Hive后</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Connecting to jdbc:hive2://master:10000</span><br><span class="line">Error: Could not open client transport with JDBC Uri: jdbc:hive2://master:10000: java.net.ConnectException: Connection refused (Connection refused) (state=08S01,code=0)</span><br><span class="line">Beeline version 1.2.2 by Apache Hive</span><br><span class="line">0: jdbc:hive2://master:10000 (closed)&gt;</span><br></pre></td></tr></table></figure><h2 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h2><p>HDFS 没有读写权限 配置文件中加入<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="对-hdfs-tmp-加入777-权限-hdfs-dfs-chmod-R-777-tmp"><a href="#对-hdfs-tmp-加入777-权限-hdfs-dfs-chmod-R-777-tmp" class="headerlink" title="对 hdfs /tmp 加入777 权限 hdfs dfs -chmod -R 777 /tmp/"></a>对 hdfs /tmp 加入777 权限 <code>hdfs dfs -chmod -R 777 /tmp/</code></h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;启动Hive报错&quot;&gt;&lt;a href=&quot;#启动Hive报错&quot; class=&quot;headerlink&quot; title=&quot;启动Hive报错&quot;&gt;&lt;/a&gt;启动Hive报错&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Error: Failed to open new session: java.lang.RuntimeException: java.lang.RuntimeException: org.apache.hadoop.security.AccessControlException: Permission denied: user=anonymous, access=EXECUTE, inode=”/tmp”:root:supergroup:drwx——&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="改错" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/"/>
    
      <category term="hive" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/hive/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="error" scheme="http://www.ibiji.top/tags/error/"/>
    
      <category term="hive" scheme="http://www.ibiji.top/tags/hive/"/>
    
  </entry>
  
  <entry>
    <title>Hive HBase 整合</title>
    <link href="http://www.ibiji.top/2019/08/23/Hive%E4%B8%8EHBase%E6%95%B4%E5%90%88/"/>
    <id>http://www.ibiji.top/2019/08/23/Hive与HBase整合/</id>
    <published>2019-08-23T15:10:31.000Z</published>
    <updated>2020-08-04T12:52:30.996Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | hbase 1.2.10 | hive 1.2.2</strong></p><blockquote><p>Hive只支持insert和delete操作，并不支持update操作，所以无法实施更新hive里的数据，而HBase正好弥补了这一点，所以在某些场景下需要将Hive和HBase整合起来一起使用。<br>Hive与HBase整合的实现是利用两者本身对外的API接口互相通信来完成的，其具体工作交由Hive的lib目录中的<code>hive-hbase-handler-*.jar</code>工具类来实现，通信原理如下图所示</p></blockquote><h2 id="Hive整合HBase后的使用场景："><a href="#Hive整合HBase后的使用场景：" class="headerlink" title="Hive整合HBase后的使用场景："></a>Hive整合HBase后的使用场景：</h2><ul><li>通过Hive把数据加载到HBase中，数据源可以是文件也可以是Hive中的表。</li><li>通过整合，让HBase支持JOIN、GROUP等SQL查询语法。</li><li>通过整合，不仅可完成HBase的数据实时查询，也可以使用Hive查询HBase中的数据完成复杂的数据分析。</li></ul><a id="more"></a><h2 id="把HBASE-HOME-lib下所有的jar-复制到HIVE-HOME-lib-下"><a href="#把HBASE-HOME-lib下所有的jar-复制到HIVE-HOME-lib-下" class="headerlink" title="把HBASE_HOME/lib下所有的jar 复制到HIVE_HOME/lib/下"></a>把<code>HBASE_HOME/lib</code>下所有的jar 复制到<code>HIVE_HOME/lib/</code>下</h2><p><code>cp -n $HBASE_HOME/lib/* $HIVE_HOME/lib/</code> -n 表示对于目标路径下已经存在的文件，则不复制过去</p><h2 id="修改hive-site-xml文件，增加HBase的ZooKeeper集群信息"><a href="#修改hive-site-xml文件，增加HBase的ZooKeeper集群信息" class="headerlink" title="修改hive-site.xml文件，增加HBase的ZooKeeper集群信息"></a>修改<code>hive-site.xml</code>文件，增加HBase的ZooKeeper集群信息</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node01:2181,node02:2181,node03:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="指定-hbase-所使用的-zookeeper-集群的地址：默认端口是-2181，可以不写"><a href="#指定-hbase-所使用的-zookeeper-集群的地址：默认端口是-2181，可以不写" class="headerlink" title="指定 hbase 所使用的 zookeeper 集群的地址：默认端口是 2181，可以不写"></a>指定 hbase 所使用的 zookeeper 集群的地址：默认端口是 2181，可以不写</h2><p><code>set hbase.zookeeper.quorum=node01:2181,node02:2181,node03:2181;</code><br><code>set zookeeper.znode.parent=/var/zookeeper/local;</code></p><h2 id="指定-hbase-在-zookeeper-中使用的根目录"><a href="#指定-hbase-在-zookeeper-中使用的根目录" class="headerlink" title="指定 hbase 在 zookeeper 中使用的根目录"></a>指定 hbase 在 zookeeper 中使用的根目录</h2><p>该路径在hbase-site.xml可以查询，你在搭建hbase集群的时候，这个参数是必须设置的<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/var/zookeeper/local<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="把HIVE-HOME-lib-hive-hbase-handler-1-2-1-jar-复制到HBASE-HOME-lib-下"><a href="#把HIVE-HOME-lib-hive-hbase-handler-1-2-1-jar-复制到HBASE-HOME-lib-下" class="headerlink" title="把HIVE_HOME/lib/hive-hbase-handler-1.2.1.jar 复制到HBASE_HOME/lib/下"></a>把<code>HIVE_HOME/lib/hive-hbase-handler-1.2.1.jar</code> 复制到<code>HBASE_HOME/lib/</code>下</h2><p><code>cp */hive-1.2.1/lib/hive-hbase-handler-1.2.1.jar  */hbase/lib/</code></p><h2 id="启动HBase-创建HBase表”student”"><a href="#启动HBase-创建HBase表”student”" class="headerlink" title="启动HBase,创建HBase表”student”"></a>启动HBase,创建HBase表”student”</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="string">'student'</span>,<span class="string">'info'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0001'</span>,<span class="string">'info:name'</span>,<span class="string">'Tom'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0001'</span>,<span class="string">'info:age'</span>,<span class="string">'18'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0002'</span>,<span class="string">'info:name'</span>,<span class="string">'Madeline'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0002'</span>,<span class="string">'info:age'</span>,<span class="string">'15'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0003'</span>,<span class="string">'info:name'</span>,<span class="string">'jed'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0003'</span>,<span class="string">'info:age'</span>,<span class="string">'16'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0004'</span>,<span class="string">'info:name'</span>,<span class="string">'olivia'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0004'</span>,<span class="string">'info:age'</span>,<span class="string">'18'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0005'</span>,<span class="string">'info:name'</span>,<span class="string">'sarah'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0005'</span>,<span class="string">'info:age'</span>,<span class="string">'19'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0006'</span>,<span class="string">'info:name'</span>,<span class="string">'xiaohong'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0006'</span>,<span class="string">'info:age'</span>,<span class="string">'19'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0007'</span>,<span class="string">'info:name'</span>,<span class="string">'zhangsan'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0007'</span>,<span class="string">'info:age'</span>,<span class="string">'20'</span></span><br><span class="line"></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0008'</span>,<span class="string">'info:name'</span>,<span class="string">'wangwu'</span></span><br><span class="line">put <span class="string">'student'</span>,<span class="string">'0008'</span>,<span class="string">'info:age'</span>,<span class="string">'22'</span></span><br></pre></td></tr></table></figure><h2 id="Hive中创建表结构"><a href="#Hive中创建表结构" class="headerlink" title="Hive中创建表结构"></a>Hive中创建表结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> hive_student_name (<span class="keyword">key</span> <span class="keyword">string</span>,<span class="keyword">name</span> <span class="keyword">string</span>) <span class="keyword">STORED</span> <span class="keyword">BY</span> <span class="string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span> <span class="keyword">WITH</span> SERDEPROPERTIES (<span class="string">"hbase.columns.mapping"</span> = <span class="string">":key,info:name"</span>) TBLPROPERTIES (<span class="string">"hbase.table.name"</span> = <span class="string">"student"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> hive_student_age (<span class="keyword">key</span> <span class="keyword">string</span>,<span class="keyword">name</span> <span class="keyword">string</span>) <span class="keyword">STORED</span> <span class="keyword">BY</span> <span class="string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span> <span class="keyword">WITH</span> SERDEPROPERTIES (<span class="string">"hbase.columns.mapping"</span> = <span class="string">":key,info:age"</span>) TBLPROPERTIES (<span class="string">"hbase.table.name"</span> = <span class="string">"student"</span>);</span><br></pre></td></tr></table></figure><h2 id="通过Hive客户端可以查询该表的数据"><a href="#通过Hive客户端可以查询该表的数据" class="headerlink" title="通过Hive客户端可以查询该表的数据"></a>通过Hive客户端可以查询该表的数据</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | hbase 1.2.10 | hive 1.2.2&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hive只支持insert和delete操作，并不支持update操作，所以无法实施更新hive里的数据，而HBase正好弥补了这一点，所以在某些场景下需要将Hive和HBase整合起来一起使用。&lt;br&gt;Hive与HBase整合的实现是利用两者本身对外的API接口互相通信来完成的，其具体工作交由Hive的lib目录中的&lt;code&gt;hive-hbase-handler-*.jar&lt;/code&gt;工具类来实现，通信原理如下图所示&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Hive整合HBase后的使用场景：&quot;&gt;&lt;a href=&quot;#Hive整合HBase后的使用场景：&quot; class=&quot;headerlink&quot; title=&quot;Hive整合HBase后的使用场景：&quot;&gt;&lt;/a&gt;Hive整合HBase后的使用场景：&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;通过Hive把数据加载到HBase中，数据源可以是文件也可以是Hive中的表。&lt;/li&gt;
&lt;li&gt;通过整合，让HBase支持JOIN、GROUP等SQL查询语法。&lt;/li&gt;
&lt;li&gt;通过整合，不仅可完成HBase的数据实时查询，也可以使用Hive查询HBase中的数据完成复杂的数据分析。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="部署" scheme="http://www.ibiji.top/categories/%E9%83%A8%E7%BD%B2/"/>
    
      <category term="hive" scheme="http://www.ibiji.top/categories/%E9%83%A8%E7%BD%B2/hive/"/>
    
      <category term="hbase" scheme="http://www.ibiji.top/categories/%E9%83%A8%E7%BD%B2/hive/hbase/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/tags/centos/"/>
    
      <category term="hive" scheme="http://www.ibiji.top/tags/hive/"/>
    
      <category term="hbase" scheme="http://www.ibiji.top/tags/hbase/"/>
    
  </entry>
  
  <entry>
    <title>cesium(笔记-5)</title>
    <link href="http://www.ibiji.top/2019/08/21/cesium(%E7%AC%94%E8%AE%B0-5)/"/>
    <id>http://www.ibiji.top/2019/08/21/cesium(笔记-5)/</id>
    <published>2019-08-20T16:10:30.000Z</published>
    <updated>2020-08-04T12:52:31.006Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro</strong></p><p>记初步实现 cesium 通过鼠标完成模型创建<br><img class="alignnone size-medium" src="/images/secret/001.jpg"></p><p>通过鼠标滑动实时抓取当前坐标与高度，动态刷新到左侧二维缩略图信息框中，用户可通过手动输入或鼠标实时获取坐标点，点击确认添加后，在指定坐标点生成对应模型</p><a id="more"></a><p><strong>案例模型采用3D Tiles 及 GLTF</strong><br><a href="https://cesium.com/blog/2017/07/12/the-next-generation-of-3d-tiles/" target="_blank" rel="noopener">3D Tiles官方介绍</a><br><a href="https://github.com/javagl/glTF-Tutorials/blob/master/gltfTutorial/gltfTutorial_002_BasicGltfStructure.md" target="_blank" rel="noopener">GLTF 官方介绍</a></p><h1 id="3D-Tiles介绍："><a href="#3D-Tiles介绍：" class="headerlink" title="3D Tiles介绍："></a>3D Tiles介绍：</h1><p>3D Tiles 是：</p><ul><li>Open（开放）</li><li>Optimized for streaming and rendering（针对流和渲染进行了优化）</li><li>Designed for 3D（专为3D设计）</li><li>Interactive（交互式互动）</li><li>Styleable（设置样式）</li><li>Adaptable（适应性强）</li><li>Flexible（灵活）</li><li>Heterogeneous（异构的</li><li>Precise（精确）</li><li>Temporal（时间动态</li></ul><h2 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h2><p>  3D Tiles是基于状态，从UNLOADING开始，通过一系列的request，完成最初的数据加载过程，结束LOADING状态，进入Pocessing过程，也就是数据解析。数据解析完后进入READY状态，通过selectTile，最终调用Content对应的update方法，构造最终的drawcommand，加入渲染队列。当然，如果有需要释放的Tile，则在unloadTiles中处理。细心的人会发现Pocessing和Ready状态。最终调用的都是update方法。这里解释一下：3D Tiles中主要的数据部分就是glTF，而glTF也是基于状态管理的，无论是glTF的解析还是构造DrawCommand，只是state不同，都是在update方法中完成的。<br><img class="alignnone size-medium" src="/images/secret/002.jpg"></p><h1 id="GLTF介绍："><a href="#GLTF介绍：" class="headerlink" title="GLTF介绍："></a>GLTF介绍：</h1><p>gltf的核心是一个JSON文件。这个文件描述了3D场景的全部内容。它由场景结构本身的描述组成，由定义场景图的节点层次结构给出。场景中出现的三维对象是使用附着到节点上的网格定义的。材质定义对象的外观。动画描述了随着时间的推移，三维对象是如何转换的（例如，旋转到转换），而蒙皮定义了基于骨架姿势的对象几何体是如何变形的。摄影机描述渲染器的视图配置。</p><h2 id="基础结构"><a href="#基础结构" class="headerlink" title="基础结构"></a>基础结构</h2><ul><li>scene：整个场景的入口点，由node构成图（树）结构（类似OSG的场景组织）组成</li><li>node：场景层级中的一个节点，可以包含位置变换，可以有子节点。同时，node通过指向mesh、camera、skin来描述node的形变</li><li>camera：定义渲染场景的视点配置</li><li>mesh：描述了在场景中出现的几何物体，并通过accessor（访问器）来访问其真实的几何数据，通过material（材质）来确定渲染外观</li><li>skin：蒙皮描述模型绑定到骨骼上的参数，用来实现骨骼动画，其真实数据也是通过访问器来获取的</li><li>animation：骨骼动画，描述某个节点怎么随着时间运动</li><li>accessor：访问器，定义了如何从二进制数据源中获取数据，在mesh、animation、skin中都会用到访问器。其指向buffer和bufferview，在这里面存着真正的几何数据</li><li>material：材质包含了定义物体模型外观的参数，特别是纹理参数</li><li>texture：包括采样器和图片，定义如何将纹理映射到模型<br><img class="alignnone size-medium" src="/images/secret/003.jpg"></li></ul><h2 id="对外部数据的引用"><a href="#对外部数据的引用" class="headerlink" title="对外部数据的引用"></a>对外部数据的引用</h2><p>二进制数据，如三维对象的几何图形和纹理，通常不包含在JSON文件中。相反，它们存储在专用文件中，JSON部分只包含指向这些文件的链接。这允许二进制数据以非常紧凑的形式存储，并且可以通过Web高效地传输。此外，数据可以直接存储在渲染器中，而不必解析、解码或预处理数据。<br><img class="alignnone size-medium" src="/images/secret/004.jpg"></p><h1 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h1><h2 id="需要获取坐标点与高度"><a href="#需要获取坐标点与高度" class="headerlink" title="需要获取坐标点与高度"></a>需要获取坐标点与高度</h2><ul><li><p>屏幕坐标</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler= <span class="keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);</span><br><span class="line">handler.setInputAction(<span class="function"><span class="keyword">function</span> (<span class="params">movement</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(movement.position);</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);</span><br></pre></td></tr></table></figure></li><li><p>世界坐标</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = <span class="keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);</span><br><span class="line">handler.setInputAction(<span class="function"><span class="keyword">function</span> (<span class="params">movement</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> position = viewer.scene.camera.pickEllipsoid(movement.position, viewer.scene.globe.ellipsoid);</span><br><span class="line">     <span class="built_in">console</span>.log(position);</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);</span><br></pre></td></tr></table></figure></li><li><p>场景坐标</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = <span class="keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);</span><br><span class="line">handler.setInputAction(<span class="function"><span class="keyword">function</span> (<span class="params">movement</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> position = viewer.scene.pickPosition(movement.position);</span><br><span class="line">     <span class="built_in">console</span>.log(position);</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);</span><br></pre></td></tr></table></figure></li><li><p>地标坐标</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = <span class="keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);</span><br><span class="line">handler.setInputAction(<span class="function"><span class="keyword">function</span> (<span class="params">movement</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> ray=viewer.camera.getPickRay(movement.position);</span><br><span class="line">     <span class="keyword">var</span> position = viewer.scene.globe.pick(ray, viewer.scene);</span><br><span class="line">     <span class="built_in">console</span>.log(position);</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);</span><br></pre></td></tr></table></figure></li></ul><h2 id="加载模型"><a href="#加载模型" class="headerlink" title="加载模型"></a>加载模型</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> entity = viewer.entities.add(&#123;</span><br><span class="line">    name: <span class="string">'model/CesiumMilkTruck/CesiumMilkTruck.glb'</span>,</span><br><span class="line">    position: position,</span><br><span class="line">    orientation: orientation,</span><br><span class="line">    model: &#123;</span><br><span class="line">        uri: <span class="string">'model/CesiumMilkTruck/CesiumMilkTruck.glb'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">viewer.trackedEntity = entity;</span><br></pre></td></tr></table></figure><h1 id="完整代码实现"><a href="#完整代码实现" class="headerlink" title="完整代码实现"></a>完整代码实现</h1><h2 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">var</span> viewer = <span class="keyword">new</span> Cesium.Viewer(<span class="string">'cesiumContainer'</span>, &#123;</span><br><span class="line">      imageryProvider: Cesium.createOpenStreetMapImageryProvider(&#123;</span><br><span class="line">          url: <span class="string">'https://a.tile.openstreetmap.org/'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      shouldAnimate: <span class="literal">false</span>,</span><br><span class="line">      infoBox: <span class="literal">false</span>,</span><br><span class="line">      selectionIndicator: <span class="literal">false</span>,</span><br><span class="line">      shadows: <span class="literal">false</span>,</span><br><span class="line">      geocoder: <span class="literal">false</span>,</span><br><span class="line">      homeButton: <span class="literal">false</span>,</span><br><span class="line">      sceneModePicker: <span class="literal">false</span>,</span><br><span class="line">      baseLayerPicker: <span class="literal">false</span>,</span><br><span class="line">      navigationHelpButton: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// animation: false,</span></span><br><span class="line">      <span class="comment">// timeline: false,</span></span><br><span class="line">      fullscreenButton: <span class="literal">false</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> scene = viewer.scene;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">var</span> handler = <span class="keyword">new</span> Cesium.ScreenSpaceEventHandler(scene.canvas);</span><br><span class="line">  handler.setInputAction(<span class="function"><span class="keyword">function</span> (<span class="params">movement</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> cartesian = scene.camera.pickEllipsoid(movement.endPosition, ellipsoid);</span><br><span class="line">      <span class="keyword">var</span> ellipsoid = scene.globe.ellipsoid;</span><br><span class="line">      <span class="keyword">if</span> (cartesian) &#123;</span><br><span class="line">          <span class="keyword">var</span> cartographic = ellipsoid.cartesianToCartographic(cartesian);</span><br><span class="line">          <span class="keyword">var</span> coords = <span class="string">'lng'</span> + Cesium.Math.toDegrees(cartographic.longitude).toFixed(<span class="number">6</span>) + <span class="string">', '</span> + <span class="string">'lat'</span> + Cesium.Math.toDegrees(cartographic.latitude).toFixed(<span class="number">6</span>) + <span class="string">'，'</span> + <span class="string">'hig'</span> + <span class="built_in">Math</span>.ceil(viewer.camera.positionCartographic.height);</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"--&gt;"</span> + coords)</span><br><span class="line">          $(<span class="string">"#val1"</span>).val(Cesium.Math.toDegrees(cartographic.longitude).toFixed(<span class="number">6</span>))</span><br><span class="line">          $(<span class="string">"#val2"</span>).val(Cesium.Math.toDegrees(cartographic.latitude).toFixed(<span class="number">6</span>))</span><br><span class="line">          $(<span class="string">"#val3"</span>).val(<span class="built_in">Math</span>.ceil(viewer.camera.positionCartographic.height))</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">//</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"--&gt;"</span> + ERROR)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> params = &#123;</span><br><span class="line">      tx: $(<span class="string">"#val1"</span>).val(),    <span class="comment">//模型中心X轴坐标（经度，单位：十进制度）   </span></span><br><span class="line">      ty: $(<span class="string">"#val2"</span>).val(),     <span class="comment">//模型中心Y轴坐标（纬度，单位：十进制度）   </span></span><br><span class="line">      tz: <span class="number">0</span>,      <span class="comment">//模型中心Z轴坐标（高程，单位：米）   </span></span><br><span class="line">      rx: <span class="number">0</span>,     <span class="comment">//X轴（经度）方向旋转角度（单位：度）   </span></span><br><span class="line">      ry: <span class="number">0</span>,     <span class="comment">//Y轴（纬度）方向旋转角度（单位：度）   </span></span><br><span class="line">      rz: <span class="number">0</span>      <span class="comment">//Z轴（高程）方向旋转角度（单位：度）</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createModel</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"------&gt;"</span> + $(<span class="string">"#height"</span>).val());</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// viewer.entities.removeAll();</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> position = Cesium.Cartesian3.fromDegrees($(<span class="string">"#val1"</span>).val(), $(<span class="string">"#val2"</span>).val(), $(<span class="string">"#val3"</span>).val());</span><br><span class="line">      <span class="keyword">var</span> heading = Cesium.Math.toRadians(<span class="number">135</span>);</span><br><span class="line">      <span class="keyword">var</span> pitch = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">var</span> roll = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">var</span> hpr = <span class="keyword">new</span> Cesium.HeadingPitchRoll(heading, pitch, roll);</span><br><span class="line">      <span class="keyword">var</span> orientation = Cesium.Transforms.headingPitchRollQuaternion(position, hpr);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> entity = viewer.entities.add(&#123;</span><br><span class="line">          name: <span class="string">'model/CesiumMilkTruck/CesiumMilkTruck.glb'</span>,</span><br><span class="line">          position: position,</span><br><span class="line">          orientation: orientation,</span><br><span class="line">          model: &#123;</span><br><span class="line">              uri: <span class="string">'model/CesiumMilkTruck/CesiumMilkTruck.glb'</span>,</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      viewer.trackedEntity = entity;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3D Tiles</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*viewer.scene.globe.depthTestAgainstTerrain = true;</span></span><br><span class="line"><span class="comment">      // var url = "model/daodan/tileset.json";</span></span><br><span class="line"><span class="comment">      var url = Cesium.IonResource.fromAssetId(1);</span></span><br><span class="line"><span class="comment">      var tileset = new Cesium.Cesium3DTileset(&#123;url: url&#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      var primitive1 = viewer.scene.primitives.add(tileset);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      primitive1.readyPromise.then(function (t) &#123;</span></span><br><span class="line"><span class="comment">          console.log("====&gt;"+$("#val1").val() + ","+$("#val2").val())</span></span><br><span class="line"><span class="comment">          var originalSphere = t.boundingSphere;</span></span><br><span class="line"><span class="comment">          var radius = originalSphere.radius;</span></span><br><span class="line"><span class="comment">          viewer.zoomTo(t, new Cesium.HeadingPitchRange(0.5, -0.5, radius * 4.0));</span></span><br><span class="line"><span class="comment">          //</span></span><br><span class="line"><span class="comment">          var mx = Cesium.Matrix3.fromRotationX(Cesium.Math.toRadians(params.rx));</span></span><br><span class="line"><span class="comment">          var my = Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(params.ry));</span></span><br><span class="line"><span class="comment">          var mz = Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(params.rz));</span></span><br><span class="line"><span class="comment">          var rotationX = Cesium.Matrix4.fromRotationTranslation(mx);</span></span><br><span class="line"><span class="comment">          var rotationY = Cesium.Matrix4.fromRotationTranslation(my);</span></span><br><span class="line"><span class="comment">          var rotationZ = Cesium.Matrix4.fromRotationTranslation(mz);</span></span><br><span class="line"><span class="comment">          // var position = Cesium.Cartesian3.fromDegrees(params.tx, params.ty, $("#val3").val());</span></span><br><span class="line"><span class="comment">          var position = Cesium.Cartesian3.fromDegrees($("#val1").val(), $("#val2").val(), $("#val3").val());</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          var m = Cesium.Transforms.eastNorthUpToFixedFrame(position);</span></span><br><span class="line"><span class="comment">          //</span></span><br><span class="line"><span class="comment">          Cesium.Matrix4.multiply(m, rotationX, m);</span></span><br><span class="line"><span class="comment">          Cesium.Matrix4.multiply(m, rotationY, m);</span></span><br><span class="line"><span class="comment">          Cesium.Matrix4.multiply(m, rotationZ, m);</span></span><br><span class="line"><span class="comment">          tileset._root.transform = m;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &#125;).otherwise(function (error) &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          var msg = JSON.stringify(error);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          console.log("msg -------------&gt;" + msg);</span></span><br><span class="line"><span class="comment">      &#125;);*/</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="HTML-代码"><a href="#HTML-代码" class="headerlink" title="HTML 代码"></a>HTML 代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"css/widgets.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>add model<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/style.css"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"bootstrap/css/bootstrap.css"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery-3.4.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"bootstrap/js/bootstrap.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/Sandcastle-header.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/require.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/Cesium.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#cesiumContainer</span> &#123;</span></span><br><span class="line"><span class="undefined">            width: 100%;</span></span><br><span class="line"><span class="undefined">            height: 100%;</span></span><br><span class="line"><span class="undefined">            margin: 0;</span></span><br><span class="line"><span class="undefined">            padding: 0;</span></span><br><span class="line"><span class="undefined">            overflow: hidden;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    @<span class="keyword">import</span> url(css/bucket.css);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-tag">rgba</span>(42, 42, 42, 0<span class="selector-class">.8</span>);</span></span><br><span class="line"><span class="undefined">        padding: 4px;</span></span><br><span class="line"><span class="undefined">        border-radius: 4px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="undefined">        vertical-align: middle;</span></span><br><span class="line"><span class="undefined">        padding-top: 2px;</span></span><br><span class="line"><span class="undefined">        padding-bottom: 2px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"cesiumContainer"</span> <span class="attr">class</span>=<span class="string">"fullSize"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"loadingOverlay"</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"toolbar"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;div&gt;Height&lt;/div&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;input type="range" min="-100.0" max="100.0" step="1" data-bind="value: height, valueUpdate: 'input'"&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;input type="text" size="5" data-bind="value: height"&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;input value="0" id="height" type="text"&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;button onclick="createModel()"&gt;添加&lt;/button&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>车<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"img/car.jpg"</span> <span class="attr">style</span>=<span class="string">"height: 100px"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Single button --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-default dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">aria-haspopup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">                    参数 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>经度<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"val1"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">style</span>=<span class="string">"color: #000000"</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>纬度<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"val2"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">style</span>=<span class="string">"color: #000000"</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>高度<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"val3"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">style</span>=<span class="string">"color: #000000"</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"createModel()"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>确认添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>效果图</strong><br><img class="alignnone size-medium" src="/images/secret/005.jpg"><br><img class="alignnone size-medium" src="/images/secret/006.jpg"><br><img class="alignnone size-medium" src="/images/secret/007.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;记初步实现 cesium 通过鼠标完成模型创建&lt;br&gt;&lt;img class=&quot;alignnone size-medium&quot; src=&quot;/images/secret/001.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;通过鼠标滑动实时抓取当前坐标与高度，动态刷新到左侧二维缩略图信息框中，用户可通过手动输入或鼠标实时获取坐标点，点击确认添加后，在指定坐标点生成对应模型&lt;/p&gt;
    
    </summary>
    
      <category term="cesium" scheme="http://www.ibiji.top/categories/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/categories/cesium/js/"/>
    
    
      <category term="cesium" scheme="http://www.ibiji.top/tags/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>cesium(笔记-4)</title>
    <link href="http://www.ibiji.top/2019/08/20/cesium(%E7%AC%94%E8%AE%B0-4)/"/>
    <id>http://www.ibiji.top/2019/08/20/cesium(笔记-4)/</id>
    <published>2019-08-20T13:10:30.000Z</published>
    <updated>2020-08-04T12:52:31.005Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro</strong></p><p>粒子系统是一种图形技术，可以模拟复杂的物理效果。粒子系统是小图像的集合，当它们一起观看时，会形成一个更复杂的“模糊”物体，如火、烟、天气或烟花fireworkds。通过使用诸如初始位置、速度和寿命等属性指定单个粒子的行为，可以控制这些复杂的效果。</p><p>粒子系统效应在电影和电子游戏中很常见。例如，为了表示飞机的损坏，技术艺术家可以使用粒子系统来表示飞机引擎上的爆炸，然后渲染不同的粒子系统，表示飞机坠毁时的烟雾轨迹。<br><a id="more"></a></p><h2 id="Particle-system-basics-粒子系统基础"><a href="#Particle-system-basics-粒子系统基础" class="headerlink" title="Particle system basics 粒子系统基础"></a>Particle system basics 粒子系统基础</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> particleSystem = viewer.scene.primitives.add(<span class="keyword">new</span> Cesium.ParticleSystem(&#123;</span><br><span class="line">    image : <span class="string">'../../SampleData/smoke.png'</span>,</span><br><span class="line">    imageSize : <span class="keyword">new</span> Cesium.Cartesian2(<span class="number">20</span>, <span class="number">20</span>),</span><br><span class="line">    startScale : <span class="number">1.0</span>,</span><br><span class="line">    endScale : <span class="number">4.0</span>,</span><br><span class="line">    particleLife : <span class="number">1.0</span>,</span><br><span class="line">    speed : <span class="number">5.0</span>,</span><br><span class="line">    emitter : <span class="keyword">new</span> Cesium.CircleEmitter(<span class="number">0.5</span>),</span><br><span class="line">    emissionRate : <span class="number">5.0</span>,</span><br><span class="line">    modelMatrix : entity.computeModelMatrix(viewer.clock.startTime, <span class="keyword">new</span> Cesium.Matrix4()),</span><br><span class="line">    lifetime : <span class="number">16.0</span></span><br><span class="line">&#125;));</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Emitters 发射器</span></span><br><span class="line"><span class="string">当粒子诞生时，其初始位置和速度矢量由ParticleEmitter控制。发射器将每秒生成一些粒子，由emissionRate参数指定，根据发射器类型用随机速度初始化。</span></span><br><span class="line"><span class="string">### BoxEmitter 盒形发射器</span></span><br></pre></td></tr></table></figure><p>var particleSystem = scene.primitives.add(new Cesium.ParticleSystem({<br>    image : ‘../../SampleData/smoke.png’,<br>    color: Cesium.Color.MAGENTA,<br>    emissionRate: 5.0,<br>    emitter: new Cesium.BoxEmitter(new Cesium.Cartesian3(5.0, 5.0, 5.0)),<br>    imageSize : new Cesium.Cartesian2(25.0, 25.0),<br>    modelMatrix : entity.computeModelMatrix(viewer.clock.startTime, new Cesium.Matrix4()),<br>    lifetime : 16.0<br>}));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### CircleEmitter 圆形发射器</span><br><span class="line">BoxEmitter在一个盒子内随机取样的位置初始化粒子，从六个盒子表面中的一个引导出来.</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### CircleEmitter 圆形发射器</span><br><span class="line">CircleEmitter在发射器上轴线方向上的圆形内的随机采样位置初始化粒子。</span><br><span class="line">```js</span><br><span class="line">var particleSystem = scene.primitives.add(new Cesium.ParticleSystem(&#123;</span><br><span class="line">    image : &apos;../../SampleData/smoke.png&apos;,</span><br><span class="line">    color: Cesium.Color.MAGENTA,</span><br><span class="line">    emissionRate: 5.0,</span><br><span class="line">    emitter: new Cesium.CircleEmitter(5.0),</span><br><span class="line">    imageSize : new Cesium.Cartesian2(25.0, 25.0),</span><br><span class="line">    modelMatrix : entity.computeModelMatrix(viewer.clock.startTime, new Cesium.Matrix4()),</span><br><span class="line">    lifetime : 16.0</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="ConeEmitter-锥形发射器"><a href="#ConeEmitter-锥形发射器" class="headerlink" title="ConeEmitter 锥形发射器"></a>ConeEmitter 锥形发射器</h3><p>ConeEmitter在圆锥体的顶端初始化粒子，并以随机的角度引导它们离开圆锥体。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> particleSystem = scene.primitives.add(<span class="keyword">new</span> Cesium.ParticleSystem(&#123;</span><br><span class="line">    image : <span class="string">'../../SampleData/smoke.png'</span>,</span><br><span class="line">    color: Cesium.Color.MAGENTA,</span><br><span class="line">    emissionRate: <span class="number">5.0</span>,</span><br><span class="line">    emitter: <span class="keyword">new</span> Cesium.ConeEmitter(Cesium.Math.toRadians(<span class="number">30.0</span>)),</span><br><span class="line">    imageSize : <span class="keyword">new</span> Cesium.Cartesian2(<span class="number">25.0</span>, <span class="number">25.0</span>),</span><br><span class="line">    modelMatrix : entity.computeModelMatrix(viewer.clock.startTime, <span class="keyword">new</span> Cesium.Matrix4()),</span><br><span class="line">    lifetime : <span class="number">16.0</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p><h3 id="SphereEmitter-球形发射器"><a href="#SphereEmitter-球形发射器" class="headerlink" title="SphereEmitter 球形发射器"></a>SphereEmitter 球形发射器</h3><p>SphereEmitter在球体内随机取样的位置初始化粒子，并将它们从球体中心向外引导。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> particleSystem = scene.primitives.add(<span class="keyword">new</span> Cesium.ParticleSystem(&#123;</span><br><span class="line">    image : <span class="string">'../../SampleData/smoke.png'</span>,</span><br><span class="line">    color: Cesium.Color.MAGENTA,</span><br><span class="line">    emissionRate: <span class="number">5.0</span>,</span><br><span class="line">    emitter: <span class="keyword">new</span> Cesium.SphereEmitter(<span class="number">5.0</span>),</span><br><span class="line">    imageSize : <span class="keyword">new</span> Cesium.Cartesian2(<span class="number">25.0</span>, <span class="number">25.0</span>),</span><br><span class="line">    modelMatrix : entity.computeModelMatrix(viewer.clock.startTime, <span class="keyword">new</span> Cesium.Matrix4()),</span><br><span class="line">    lifetime : <span class="number">16.0</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p><h2 id="Particle-emission-rate-粒子发射率"><a href="#Particle-emission-rate-粒子发射率" class="headerlink" title="Particle emission rate 粒子发射率"></a>Particle emission rate 粒子发射率</h2><p>emissionRate控制每秒发射多少粒子，这会改变系统中粒子的密度。 指定一组突burst以在指定时间发射粒子burst（如上面的动画所示）。这会增加粒子系统的多样性或爆炸性。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bursts : [</span><br><span class="line">    <span class="keyword">new</span> Cesium.ParticleBurst(&#123;<span class="attr">time</span> : <span class="number">5.0</span>, <span class="attr">minimum</span> : <span class="number">300</span>, <span class="attr">maximum</span> : <span class="number">500</span>&#125;),</span><br><span class="line">    <span class="keyword">new</span> Cesium.ParticleBurst(&#123;<span class="attr">time</span> : <span class="number">10.0</span>, <span class="attr">minimum</span> : <span class="number">50</span>, <span class="attr">maximum</span> : <span class="number">100</span>&#125;),</span><br><span class="line">    <span class="keyword">new</span> Cesium.ParticleBurst(&#123;<span class="attr">time</span> : <span class="number">15.0</span>, <span class="attr">minimum</span> : <span class="number">200</span>, <span class="attr">maximum</span> : <span class="number">300</span>&#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><h2 id="Life-of-the-particle-and-life-of-the-system-粒子寿命和系统寿命"><a href="#Life-of-the-particle-and-life-of-the-system-粒子寿命和系统寿命" class="headerlink" title="Life of the particle and life of the system 粒子寿命和系统寿命"></a>Life of the particle and life of the system 粒子寿命和系统寿命</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lifetime : <span class="number">16.0</span>,</span><br><span class="line">loop: <span class="literal">false</span></span><br><span class="line"><span class="comment">//要随机化每个粒子的输出，使用变量minimumParticleLife和maximumArticleLife。</span></span><br><span class="line">minimumParticleLife: <span class="number">5.0</span>,</span><br><span class="line">maximumParticleLife: <span class="number">10.0</span></span><br></pre></td></tr></table></figure><h2 id="Styling-particles-样式化粒子"><a href="#Styling-particles-样式化粒子" class="headerlink" title="Styling particles 样式化粒子"></a>Styling particles 样式化粒子</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Color 颜色</span></span><br><span class="line">startColor : Cesium.Color.LIGHTSEAGREEN.withAlpha(<span class="number">0.7</span>),</span><br><span class="line">endColor : Cesium.Color.WHITE.withAlpha(<span class="number">0.0</span>),</span><br><span class="line"></span><br><span class="line"><span class="comment">//Size 大小</span></span><br><span class="line">minimumImageSize : <span class="keyword">new</span> Cesium.Cartesian2(<span class="number">30.0</span>, <span class="number">30.0</span>),</span><br><span class="line">maximumImageSize : <span class="keyword">new</span> Cesium.Cartesian2(<span class="number">60.0</span>, <span class="number">60.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以通过startScale和endscale属性在其生命周期中进行调整，以使粒子随时间增长或收缩。</span></span><br><span class="line">startScale: <span class="number">1.0</span>,</span><br><span class="line">endScale: <span class="number">4.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//速度由speed或minimumSpeed和maximumSpeed控制。</span></span><br><span class="line">minimumSpeed: <span class="number">5.0</span>,</span><br><span class="line">maximumSpeed: <span class="number">10.0</span></span><br></pre></td></tr></table></figure><h2 id="通过应用更新函数，可以进一步自定义粒子系统。"><a href="#通过应用更新函数，可以进一步自定义粒子系统。" class="headerlink" title="通过应用更新函数，可以进一步自定义粒子系统。"></a>通过应用更新函数，可以进一步自定义粒子系统。</h2><p>对于重力、风或颜色更改等效果，它充当每个粒子的手动更新程序。<br>项目系统有一个updateCallback，它在模拟过程中修改粒子的属性。此函数采用粒子和模拟时间步骤。大多数基于物理的效果将修改速度矢量以改变方向或速度。下面是一个让粒子对重力作出反应的例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gravityVector = <span class="keyword">new</span> Cesium.Cartesian3();</span><br><span class="line"><span class="keyword">var</span> gravity = -(<span class="number">9.8</span> * <span class="number">9.8</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyGravity</span>(<span class="params">p, dt</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Compute a local up vector for each particle in geocentric space.</span></span><br><span class="line">    <span class="keyword">var</span> position = p.position;</span><br><span class="line"></span><br><span class="line">    Cesium.Cartesian3.normalize(position, gravityVector);</span><br><span class="line">    Cesium.Cartesian3.multiplyByScalar(gravityVector, gravity * dt, gravityVector);</span><br><span class="line"></span><br><span class="line">    p.velocity = Cesium.Cartesian3.add(p.velocity, gravityVector, p.velocity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//该函数计算重力矢量，并使用重力加速度来改变粒子的速度。 将重力设置为粒子系统的updateFunction：</span></span><br><span class="line">updateCallback : applyGravity</span><br></pre></td></tr></table></figure></p><h2 id="Positioning-定位"><a href="#Positioning-定位" class="headerlink" title="Positioning 定位"></a>Positioning 定位</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">modelMatrix：将粒子系统从模型转换为世界坐标。</span></span><br><span class="line"><span class="comment">emitterModelMatrix：在粒子系统的局部坐标系中变换粒子系统发射器。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> entity = viewer.entities.add(&#123;</span><br><span class="line">    model : &#123;</span><br><span class="line">        uri : <span class="string">'../../SampleData/models/CesiumMilkTruck/CesiumMilkTruck-kmc.glb'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    position : Cesium.Cartesian3.fromDegrees(<span class="number">-75.15787310614596</span>, <span class="number">39.97862668312678</span>)</span><br><span class="line">&#125;);</span><br><span class="line">viewer.trackedEntity = entity;</span><br><span class="line"></span><br><span class="line">modelMatrix: entity.computeModelMatrix(time, <span class="keyword">new</span> Cesium.Matrix4())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">computeEmitterModelMatrix</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hpr = Cesium.HeadingPitchRoll.fromDegrees(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, hpr);</span><br><span class="line">    trs.translation = Cesium.Cartesian3.fromElements(<span class="number">-4.0</span>, <span class="number">0.0</span>, <span class="number">1.4</span>, translation);</span><br><span class="line">    trs.rotation = Cesium.Quaternion.fromHeadingPitchRoll(hpr, rotation);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Cesium.Matrix4.fromTranslationRotationScale(trs, emitterModelMatrix);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> particleSystem = viewer.scene.primitives.add(<span class="keyword">new</span> Cesium.ParticleSystem(&#123;</span><br><span class="line">    image : <span class="string">'../../SampleData/smoke.png'</span>,</span><br><span class="line">    </span><br><span class="line">    startColor : Cesium.Color.LIGHTSEAGREEN.withAlpha(<span class="number">0.7</span>),</span><br><span class="line">    endColor : Cesium.Color.WHITE.withAlpha(<span class="number">0.0</span>),</span><br><span class="line">    </span><br><span class="line">    startScale : <span class="number">1.0</span>,</span><br><span class="line">    endScale : <span class="number">4.0</span>,</span><br><span class="line">    </span><br><span class="line">    particleLife : <span class="number">1.0</span>,</span><br><span class="line">    </span><br><span class="line">    minimumSpeed : <span class="number">1.0</span>,</span><br><span class="line">    maximumSpeed : <span class="number">4.0</span></span><br><span class="line">    </span><br><span class="line">    imageSize : <span class="keyword">new</span> Cesium.Cartesian2(<span class="number">25</span>, <span class="number">25</span>),</span><br><span class="line">    emissionRate : <span class="number">5.0</span>,</span><br><span class="line">    lifetime : <span class="number">16.0</span>,</span><br><span class="line">    </span><br><span class="line">    modelMatrix : entity.computeModelMatrix(viewer.clock.startTime, <span class="keyword">new</span> Cesium.Matrix4())</span><br><span class="line">    emitterModelMatrix : computeEmitterModelMatrix()</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h2 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Cesium.Viewer(<span class="string">'cesiumContainer'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set the random number seed for consistent results.</span></span><br><span class="line">Cesium.Math.setRandomNumberSeed(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set bounds of our simulation time</span></span><br><span class="line"><span class="keyword">var</span> start = Cesium.JulianDate.fromDate(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">2</span>, <span class="number">25</span>, <span class="number">16</span>));</span><br><span class="line"><span class="keyword">var</span> stop = Cesium.JulianDate.addSeconds(start, <span class="number">120</span>, <span class="keyword">new</span> Cesium.JulianDate());</span><br><span class="line"></span><br><span class="line"><span class="comment">//Make sure viewer is at the desired time.</span></span><br><span class="line">viewer.clock.startTime = start.clone();</span><br><span class="line">viewer.clock.stopTime = stop.clone();</span><br><span class="line">viewer.clock.currentTime = start.clone();</span><br><span class="line">viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; <span class="comment">//Loop at the end</span></span><br><span class="line">viewer.clock.multiplier = <span class="number">1</span>;</span><br><span class="line">viewer.clock.shouldAnimate = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set timeline to simulation bounds</span></span><br><span class="line">viewer.timeline.zoomTo(start, stop);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> viewModel = &#123;</span><br><span class="line">    emissionRate : <span class="number">5.0</span>,</span><br><span class="line">    gravity : <span class="number">0.0</span>,</span><br><span class="line">    minimumParticleLife : <span class="number">1.2</span>,</span><br><span class="line">    maximumParticleLife : <span class="number">1.2</span>,</span><br><span class="line">    minimumSpeed : <span class="number">1.0</span>,</span><br><span class="line">    maximumSpeed : <span class="number">4.0</span>,</span><br><span class="line">    startScale : <span class="number">1.0</span>,</span><br><span class="line">    endScale : <span class="number">5.0</span>,</span><br><span class="line">    particleSize : <span class="number">25.0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Cesium.knockout.track(viewModel);</span><br><span class="line"><span class="keyword">var</span> toolbar = <span class="built_in">document</span>.getElementById(<span class="string">'toolbar'</span>);</span><br><span class="line">Cesium.knockout.applyBindings(viewModel, toolbar);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> entityPosition = <span class="keyword">new</span> Cesium.Cartesian3();</span><br><span class="line"><span class="keyword">var</span> entityOrientation = <span class="keyword">new</span> Cesium.Quaternion();</span><br><span class="line"><span class="keyword">var</span> rotationMatrix = <span class="keyword">new</span> Cesium.Matrix3();</span><br><span class="line"><span class="keyword">var</span> modelMatrix = <span class="keyword">new</span> Cesium.Matrix4();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">computeModelMatrix</span>(<span class="params">entity, time</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entity.computeModelMatrix(time, <span class="keyword">new</span> Cesium.Matrix4());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> emitterModelMatrix = <span class="keyword">new</span> Cesium.Matrix4();</span><br><span class="line"><span class="keyword">var</span> translation = <span class="keyword">new</span> Cesium.Cartesian3();</span><br><span class="line"><span class="keyword">var</span> rotation = <span class="keyword">new</span> Cesium.Quaternion();</span><br><span class="line"><span class="keyword">var</span> hpr = <span class="keyword">new</span> Cesium.HeadingPitchRoll();</span><br><span class="line"><span class="keyword">var</span> trs = <span class="keyword">new</span> Cesium.TranslationRotationScale();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">computeEmitterModelMatrix</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hpr = Cesium.HeadingPitchRoll.fromDegrees(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, hpr);</span><br><span class="line">    trs.translation = Cesium.Cartesian3.fromElements(<span class="number">-4.0</span>, <span class="number">0.0</span>, <span class="number">1.4</span>, translation);</span><br><span class="line">    trs.rotation = Cesium.Quaternion.fromHeadingPitchRoll(hpr, rotation);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Cesium.Matrix4.fromTranslationRotationScale(trs, emitterModelMatrix);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pos1 = Cesium.Cartesian3.fromDegrees(<span class="number">-75.15787310614596</span>, <span class="number">39.97862668312678</span>);</span><br><span class="line"><span class="keyword">var</span> pos2 = Cesium.Cartesian3.fromDegrees(<span class="number">-75.1633691390455</span>, <span class="number">39.95355089912078</span>);</span><br><span class="line"><span class="keyword">var</span> position = <span class="keyword">new</span> Cesium.SampledPositionProperty();</span><br><span class="line"></span><br><span class="line">position.addSample(start, pos1);</span><br><span class="line">position.addSample(stop, pos2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> entity = viewer.entities.add(&#123;</span><br><span class="line">    availability : <span class="keyword">new</span> Cesium.TimeIntervalCollection([<span class="keyword">new</span> Cesium.TimeInterval(&#123;</span><br><span class="line">        start : start,</span><br><span class="line">        stop : stop</span><br><span class="line">    &#125;)]),</span><br><span class="line">    model : &#123;</span><br><span class="line">        uri : <span class="string">'../SampleData/models/CesiumMilkTruck/CesiumMilkTruck-kmc.glb'</span>,</span><br><span class="line">        minimumPixelSize : <span class="number">64</span></span><br><span class="line">    &#125;,</span><br><span class="line">    viewFrom: <span class="keyword">new</span> Cesium.Cartesian3(<span class="number">-100.0</span>, <span class="number">0.0</span>, <span class="number">100.0</span>),</span><br><span class="line">    position : position,</span><br><span class="line">    orientation : <span class="keyword">new</span> Cesium.VelocityOrientationProperty(position)</span><br><span class="line">&#125;);</span><br><span class="line">viewer.trackedEntity = entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> scene = viewer.scene;</span><br><span class="line"><span class="keyword">var</span> particleSystem = scene.primitives.add(<span class="keyword">new</span> Cesium.ParticleSystem(&#123;</span><br><span class="line">    image : <span class="string">'../SampleData/smoke.png'</span>,</span><br><span class="line"></span><br><span class="line">    startColor : Cesium.Color.LIGHTSEAGREEN.withAlpha(<span class="number">0.7</span>),</span><br><span class="line">    endColor : Cesium.Color.WHITE.withAlpha(<span class="number">0.0</span>),</span><br><span class="line"></span><br><span class="line">    startScale : viewModel.startScale,</span><br><span class="line">    endScale : viewModel.endScale,</span><br><span class="line"></span><br><span class="line">    minimumParticleLife : viewModel.minimumParticleLife,</span><br><span class="line">    maximumParticleLife : viewModel.maximumParticleLife,</span><br><span class="line"></span><br><span class="line">    minimumSpeed : viewModel.minimumSpeed,</span><br><span class="line">    maximumSpeed : viewModel.maximumSpeed,</span><br><span class="line"></span><br><span class="line">    imageSize : <span class="keyword">new</span> Cesium.Cartesian2(viewModel.particleSize, viewModel.particleSize),</span><br><span class="line"></span><br><span class="line">    emissionRate : viewModel.emissionRate,</span><br><span class="line"></span><br><span class="line">    bursts : [</span><br><span class="line">        <span class="comment">// these burst will occasionally sync to create a multicolored effect</span></span><br><span class="line">        <span class="keyword">new</span> Cesium.ParticleBurst(&#123;<span class="attr">time</span> : <span class="number">5.0</span>, <span class="attr">minimum</span> : <span class="number">10</span>, <span class="attr">maximum</span> : <span class="number">100</span>&#125;),</span><br><span class="line">        <span class="keyword">new</span> Cesium.ParticleBurst(&#123;<span class="attr">time</span> : <span class="number">10.0</span>, <span class="attr">minimum</span> : <span class="number">50</span>, <span class="attr">maximum</span> : <span class="number">100</span>&#125;),</span><br><span class="line">        <span class="keyword">new</span> Cesium.ParticleBurst(&#123;<span class="attr">time</span> : <span class="number">15.0</span>, <span class="attr">minimum</span> : <span class="number">200</span>, <span class="attr">maximum</span> : <span class="number">300</span>&#125;)</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    lifetime : <span class="number">16.0</span>,</span><br><span class="line"></span><br><span class="line">    emitter : <span class="keyword">new</span> Cesium.CircleEmitter(<span class="number">2.0</span>),</span><br><span class="line"></span><br><span class="line">    emitterModelMatrix : computeEmitterModelMatrix(),</span><br><span class="line"></span><br><span class="line">    updateCallback : applyGravity</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gravityScratch = <span class="keyword">new</span> Cesium.Cartesian3();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyGravity</span>(<span class="params">p, dt</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// We need to compute a local up vector for each particle in geocentric space.</span></span><br><span class="line">    <span class="keyword">var</span> position = p.position;</span><br><span class="line"></span><br><span class="line">    Cesium.Cartesian3.normalize(position, gravityScratch);</span><br><span class="line">    Cesium.Cartesian3.multiplyByScalar(gravityScratch, viewModel.gravity * dt, gravityScratch);</span><br><span class="line"></span><br><span class="line">    p.velocity = Cesium.Cartesian3.add(p.velocity, gravityScratch, p.velocity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">viewer.scene.preUpdate.addEventListener(<span class="function"><span class="keyword">function</span>(<span class="params">scene, time</span>) </span>&#123;</span><br><span class="line">    particleSystem.modelMatrix = computeModelMatrix(entity, time);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Account for any changes to the emitter model matrix.</span></span><br><span class="line">    particleSystem.emitterModelMatrix = computeEmitterModelMatrix();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Spin the emitter if enabled.</span></span><br><span class="line">    <span class="keyword">if</span> (viewModel.spin) &#123;</span><br><span class="line">        viewModel.heading += <span class="number">1.0</span>;</span><br><span class="line">        viewModel.pitch += <span class="number">1.0</span>;</span><br><span class="line">        viewModel.roll += <span class="number">1.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'emissionRate'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        particleSystem.emissionRate = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'particleSize'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> particleSize = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">        particleSystem.minimumImageSize.x = particleSize;</span><br><span class="line">        particleSystem.minimumImageSize.y = particleSize;</span><br><span class="line">        particleSystem.maximumImageSize.x = particleSize;</span><br><span class="line">        particleSystem.maximumImageSize.y = particleSize;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'minimumParticleLife'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        particleSystem.minimumParticleLife = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'maximumParticleLife'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        particleSystem.maximumParticleLife = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'minimumSpeed'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        particleSystem.minimumSpeed = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'maximumSpeed'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        particleSystem.maximumSpeed = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'startScale'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        particleSystem.startScale = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'endScale'</span>).subscribe(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        particleSystem.endScale = <span class="built_in">parseFloat</span>(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = [&#123;</span><br><span class="line">    text : <span class="string">'Circle Emitter'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        particleSystem.emitter = <span class="keyword">new</span> Cesium.CircleEmitter(<span class="number">2.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text : <span class="string">'Sphere Emitter'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        particleSystem.emitter = <span class="keyword">new</span> Cesium.SphereEmitter(<span class="number">2.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text : <span class="string">'Cone Emitter'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        particleSystem.emitter = <span class="keyword">new</span> Cesium.ConeEmitter(Cesium.Math.toRadians(<span class="number">45.0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text : <span class="string">'Box Emitter'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        particleSystem.emitter = <span class="keyword">new</span> Cesium.BoxEmitter(<span class="keyword">new</span> Cesium.Cartesian3(<span class="number">10.0</span>, <span class="number">10.0</span>, <span class="number">10.0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">Sandcastle.addToolbarMenu(options);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    @<span class="keyword">import</span> url(../templates/bucket.css);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-tag">rgba</span>(42, 42, 42, 0<span class="selector-class">.8</span>);</span></span><br><span class="line"><span class="undefined">        padding: 4px;</span></span><br><span class="line"><span class="undefined">        border-radius: 4px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="undefined">        vertical-align: middle;</span></span><br><span class="line"><span class="undefined">        padding-top: 2px;</span></span><br><span class="line"><span class="undefined">        padding-bottom: 2px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> <span class="selector-class">.header</span> &#123;</span></span><br><span class="line"><span class="undefined">        font-weight: bold;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"cesiumContainer"</span> <span class="attr">class</span>=<span class="string">"fullSize"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"loadingOverlay"</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"toolbar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Rate<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0.0"</span> <span class="attr">max</span>=<span class="string">"100.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: emissionRate, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: emissionRate"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Size<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"2"</span> <span class="attr">max</span>=<span class="string">"60.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: particleSize, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: particleSize"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Min Life<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0.1"</span> <span class="attr">max</span>=<span class="string">"30.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: minimumParticleLife, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: minimumParticleLife"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Max Life<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0.1"</span> <span class="attr">max</span>=<span class="string">"30.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: maximumParticleLife, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: maximumParticleLife"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Min Speed<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0.0"</span> <span class="attr">max</span>=<span class="string">"30.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: minimumSpeed, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: minimumSpeed"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Max Speed<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0.0"</span> <span class="attr">max</span>=<span class="string">"30.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: maximumSpeed, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: maximumSpeed"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Start Scale<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0.0"</span> <span class="attr">max</span>=<span class="string">"10.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: startScale, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: startScale"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>End Scale<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0.0"</span> <span class="attr">max</span>=<span class="string">"10.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: endScale, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: endScale"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Gravity<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"-20.0"</span> <span class="attr">max</span>=<span class="string">"20.0"</span> <span class="attr">step</span>=<span class="string">"1"</span> <span class="attr">data-bind</span>=<span class="string">"value: gravity, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"5"</span> <span class="attr">data-bind</span>=<span class="string">"value: gravity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;粒子系统是一种图形技术，可以模拟复杂的物理效果。粒子系统是小图像的集合，当它们一起观看时，会形成一个更复杂的“模糊”物体，如火、烟、天气或烟花fireworkds。通过使用诸如初始位置、速度和寿命等属性指定单个粒子的行为，可以控制这些复杂的效果。&lt;/p&gt;
&lt;p&gt;粒子系统效应在电影和电子游戏中很常见。例如，为了表示飞机的损坏，技术艺术家可以使用粒子系统来表示飞机引擎上的爆炸，然后渲染不同的粒子系统，表示飞机坠毁时的烟雾轨迹。&lt;br&gt;
    
    </summary>
    
      <category term="cesium" scheme="http://www.ibiji.top/categories/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/categories/cesium/js/"/>
    
    
      <category term="cesium" scheme="http://www.ibiji.top/tags/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>cesium(笔记-3)</title>
    <link href="http://www.ibiji.top/2019/08/19/cesium(%E7%AC%94%E8%AE%B0-3)/"/>
    <id>http://www.ibiji.top/2019/08/19/cesium(笔记-3)/</id>
    <published>2019-08-19T13:10:30.000Z</published>
    <updated>2020-08-04T12:52:31.004Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro</strong></p><p>Cesium支持流式的、可视化的全球高程投影地形地势、水形数据，包括海洋、湖泊、河流、山峰、峡谷和其他能够被三维展示出来的且效果比二维好的地形数据。像图层数据一样，Cesium引擎会从一个服务器上请求流式地形数据，仅请求那些基于当前相机能看到的需要绘制的图层上的数据。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load Cesium World Terrain</span></span><br><span class="line">viewer.terrainProvider = Cesium.createWorldTerrain(&#123;</span><br><span class="line">    requestWaterMask : <span class="literal">true</span>, <span class="comment">// required for water effects</span></span><br><span class="line">    requestVertexNormals : <span class="literal">true</span> <span class="comment">// required for terrain lighting</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Enable depth testing so things behind the terrain disappear.</span></span><br><span class="line">viewer.scene.globe.depthTestAgainstTerrain = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></p><a id="more"></a><h2 id="高投影的arctic-terrain"><a href="#高投影的arctic-terrain" class="headerlink" title="高投影的arctic terrain"></a>高投影的arctic terrain</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// High-resolution arctic terrain from the Arctic DEM project (Release 4), tiled and hosted by Cesium ion.</span></span><br><span class="line"><span class="comment">// https://www.pgc.umn.edu/data/arcticdem/</span></span><br><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Cesium.Viewer(<span class="string">'cesiumContainer'</span>, &#123;</span><br><span class="line">    terrainProvider: <span class="keyword">new</span> Cesium.CesiumTerrainProvider(&#123;</span><br><span class="line">        url: Cesium.IonResource.fromAssetId(<span class="number">3956</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add Alaskan locations</span></span><br><span class="line">Sandcastle.addDefaultToolbarMenu([&#123;</span><br><span class="line">    text: <span class="string">'Denali'</span>,</span><br><span class="line">    onselect: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination: Cesium.Cartesian3.fromRadians(<span class="number">-2.6399828792482234</span>, <span class="number">1.0993550795541742</span>, <span class="number">5795</span>),</span><br><span class="line">            orientation: &#123;</span><br><span class="line">                heading: <span class="number">3.8455</span>,</span><br><span class="line">                pitch: <span class="number">-0.4535</span>,</span><br><span class="line">                roll: <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text: <span class="string">'Anchorage Area'</span>,</span><br><span class="line">    onselect: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination: Cesium.Cartesian3.fromRadians(<span class="number">-2.610708034601548</span>, <span class="number">1.0671172431736584</span>, <span class="number">1900</span>),</span><br><span class="line">            orientation: &#123;</span><br><span class="line">                heading: <span class="number">4.6</span>,</span><br><span class="line">                pitch: <span class="number">-0.341</span>,</span><br><span class="line">                roll: <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text: <span class="string">'Peaks'</span>,</span><br><span class="line">    onselect: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination: Cesium.Cartesian3.fromRadians(<span class="number">-2.6928866820212813</span>, <span class="number">1.072394255273859</span>, <span class="number">3700</span>),</span><br><span class="line">            orientation: &#123;</span><br><span class="line">                heading: <span class="number">1.6308222948889464</span>,</span><br><span class="line">                pitch: <span class="number">-0.6473480165020193</span>,</span><br><span class="line">                roll: <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text: <span class="string">'Riverbed'</span>,</span><br><span class="line">    onselect: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination: Cesium.Cartesian3.fromRadians(<span class="number">-2.6395623497608596</span>, <span class="number">1.0976443174490356</span>, <span class="number">2070</span>),</span><br><span class="line">            orientation: &#123;</span><br><span class="line">                heading: <span class="number">6.068794108659519</span>,</span><br><span class="line">                pitch: <span class="number">-0.08514161789475816</span>,</span><br><span class="line">                roll: <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;], <span class="string">'toolbar'</span>);</span><br></pre></td></tr></table></figure><h2 id="高投影的Pennsylvania-terrain"><a href="#高投影的Pennsylvania-terrain" class="headerlink" title="高投影的Pennsylvania terrain"></a>高投影的Pennsylvania terrain</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// High resolution terrain of Pennsylvania curated by Pennsylvania Spatial Data Access (PASDA)</span></span><br><span class="line"><span class="comment">// http://www.pasda.psu.edu/</span></span><br><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Cesium.Viewer(<span class="string">'cesiumContainer'</span>, &#123;</span><br><span class="line">    terrainProvider: <span class="keyword">new</span> Cesium.CesiumTerrainProvider(&#123;</span><br><span class="line">        url: Cesium.IonResource.fromAssetId(<span class="number">3957</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add PA locations</span></span><br><span class="line">Sandcastle.addDefaultToolbarMenu([&#123;</span><br><span class="line">    text : <span class="string">'Pinnacle'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination : Cesium.Cartesian3.fromRadians(<span class="number">-1.3324415110874286</span>, <span class="number">0.6954224325279967</span>, <span class="number">236.6770689945084</span>),</span><br><span class="line">            orientation : &#123;</span><br><span class="line">                heading : Cesium.Math.toRadians(<span class="number">310</span>),</span><br><span class="line">                pitch : Cesium.Math.toRadians(<span class="number">-15</span>),</span><br><span class="line">                roll : <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text : <span class="string">'Mount Nittany'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination : Cesium.Cartesian3.fromRadians(<span class="number">-1.358985133937573</span>, <span class="number">0.7123252393978314</span>, <span class="number">451.05748252867375</span>),</span><br><span class="line">            orientation : &#123;</span><br><span class="line">                heading : Cesium.Math.toRadians(<span class="number">85</span>),</span><br><span class="line">                pitch : Cesium.Math.toRadians(<span class="number">0</span>),</span><br><span class="line">                roll : <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text : <span class="string">'Horseshoe Curve'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination : Cesium.Cartesian3.fromRadians(<span class="number">-1.3700147546199826</span>, <span class="number">0.706808606166025</span>, <span class="number">993.7916313325215</span>),</span><br><span class="line">            orientation : &#123;</span><br><span class="line">                heading : Cesium.Math.toRadians(<span class="number">90</span>),</span><br><span class="line">                pitch : Cesium.Math.toRadians(<span class="number">-15</span>),</span><br><span class="line">                roll : <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text : <span class="string">'Jim Thorpe'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination : Cesium.Cartesian3.fromRadians(<span class="number">-1.3218297501066052</span>, <span class="number">0.713358272291525</span>, <span class="number">240.87968743408845</span>),</span><br><span class="line">            orientation : &#123;</span><br><span class="line">                heading : Cesium.Math.toRadians(<span class="number">200</span>),</span><br><span class="line">                pitch : Cesium.Math.toRadians(<span class="number">-5</span>),</span><br><span class="line">                roll : <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    text : <span class="string">'Grand Canyon of PA'</span>,</span><br><span class="line">    onselect : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        viewer.scene.camera.flyTo(&#123;</span><br><span class="line">            destination : Cesium.Cartesian3.fromRadians(<span class="number">-1.349379633251472</span>, <span class="number">0.720297672225785</span>, <span class="number">656.268309953562</span>),</span><br><span class="line">            orientation : &#123;</span><br><span class="line">                heading : Cesium.Math.toRadians(<span class="number">200</span>),</span><br><span class="line">                pitch : Cesium.Math.toRadians(<span class="number">-5</span>),</span><br><span class="line">                roll : <span class="number">0.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;], <span class="string">'toolbar'</span>);</span><br></pre></td></tr></table></figure><h2 id="一些地形数据配置和格式"><a href="#一些地形数据配置和格式" class="headerlink" title="一些地形数据配置和格式"></a>一些地形数据配置和格式</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cesium支持流式的、可视化的全球高程投影地形地势、水形数据，包括海洋、湖泊、河流、山峰、峡谷和其他能够被三维展示出来的且效果比二维好的地形数据。像图层数据一样，Cesium引擎会从一个服务器上请求流式地形数据，仅请求那些基于当前相机能看到的需要绘制的图层上的数据。&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Load Cesium World Terrain&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;viewer.terrainProvider = Cesium.createWorldTerrain(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    requestWaterMask : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;// required for water effects&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    requestVertexNormals : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// required for terrain lighting&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Enable depth testing so things behind the terrain disappear.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;viewer.scene.globe.depthTestAgainstTerrain = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="cesium" scheme="http://www.ibiji.top/categories/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/categories/cesium/js/"/>
    
    
      <category term="cesium" scheme="http://www.ibiji.top/tags/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>cesium(笔记-2)</title>
    <link href="http://www.ibiji.top/2019/08/18/cesium(%E7%AC%94%E8%AE%B0-2)/"/>
    <id>http://www.ibiji.top/2019/08/18/cesium(笔记-2)/</id>
    <published>2019-08-18T13:10:30.000Z</published>
    <updated>2020-08-04T12:52:31.003Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro</strong></p><p>Cesium应用程序另一个关键元素是Imagery(图层)。瓦片图集合根据不同的投影方式映射到虚拟的三维数字地球表面。依赖于相机指向地表的方向和距离，Cesium会去请求和渲染不同层级的图层详细信息。<br>多种图层能够被添加、移除、排序和适应到Cesium中。<br>Cesium提供了一系列方法用于处理图层，比如颜色自适应，图层叠加融合</p><a id="more"></a><h2 id="支持的图层格式："><a href="#支持的图层格式：" class="headerlink" title="支持的图层格式："></a>支持的图层格式：</h2><p>1.wms<br>2.TMS<br>3.WMTS (with time dynamic imagery)<br>4.ArcGIS<br>5.Bing Maps<br>6.Google Earth<br>7.Mapbox<br>8.OpenStreetMap</p><h2 id="基本图层"><a href="#基本图层" class="headerlink" title="基本图层"></a>基本图层</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Cesium.Viewer(<span class="string">'cesiumContainer'</span>, &#123;</span><br><span class="line">    imageryProvider : Cesium.createWorldImagery(&#123;</span><br><span class="line">        style : Cesium.IonWorldImageryStyle.AERIAL_WITH_LABELS</span><br><span class="line">    &#125;),</span><br><span class="line">    baseLayerPicker : <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> layers = viewer.scene.imageryLayers;</span><br><span class="line"><span class="keyword">var</span> blackMarble = layers.addImageryProvider(<span class="keyword">new</span> Cesium.IonImageryProvider(&#123; <span class="attr">assetId</span>: <span class="number">3812</span> &#125;));</span><br><span class="line"></span><br><span class="line">blackMarble.alpha = <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">blackMarble.brightness = <span class="number">2.0</span>;</span><br><span class="line"></span><br><span class="line">layers.addImageryProvider(<span class="keyword">new</span> Cesium.SingleTileImageryProvider(&#123;</span><br><span class="line">    url : <span class="string">'../images/Cesium_Logo_overlay.png'</span>,</span><br><span class="line">    rectangle : Cesium.Rectangle.fromDegrees(<span class="number">-75.0</span>, <span class="number">28.0</span>, <span class="number">-67.0</span>, <span class="number">29.75</span>)</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h2 id="自适应图层"><a href="#自适应图层" class="headerlink" title="自适应图层"></a>自适应图层</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">var viewer = new Cesium.Viewer(&apos;cesiumContainer&apos;);</span><br><span class="line">var imageryLayers = viewer.imageryLayers;</span><br><span class="line"></span><br><span class="line">// The viewModel tracks the state of our mini application.</span><br><span class="line">var viewModel = &#123;</span><br><span class="line">    brightness: 0,</span><br><span class="line">    contrast: 0,</span><br><span class="line">    hue: 0,</span><br><span class="line">    saturation: 0,</span><br><span class="line">    gamma: 0</span><br><span class="line">&#125;;</span><br><span class="line">// Convert the viewModel members into knockout observables.</span><br><span class="line">Cesium.knockout.track(viewModel);</span><br><span class="line"></span><br><span class="line">// Bind the viewModel to the DOM elements of the UI that call for it.</span><br><span class="line">var toolbar = document.getElementById(&apos;toolbar&apos;);</span><br><span class="line">Cesium.knockout.applyBindings(viewModel, toolbar);</span><br><span class="line"></span><br><span class="line">// Make the active imagery layer a subscriber of the viewModel.</span><br><span class="line">function subscribeLayerParameter(name) &#123;</span><br><span class="line">    Cesium.knockout.getObservable(viewModel, name).subscribe(</span><br><span class="line">        function(newValue) &#123;</span><br><span class="line">            if (imageryLayers.length &gt; 0) &#123;</span><br><span class="line">                var layer = imageryLayers.get(0);</span><br><span class="line">                layer[name] = newValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">subscribeLayerParameter(&apos;brightness&apos;);</span><br><span class="line">subscribeLayerParameter(&apos;contrast&apos;);</span><br><span class="line">subscribeLayerParameter(&apos;hue&apos;);</span><br><span class="line">subscribeLayerParameter(&apos;saturation&apos;);</span><br><span class="line">subscribeLayerParameter(&apos;gamma&apos;);</span><br><span class="line"></span><br><span class="line">// Make the viewModel react to base layer changes.</span><br><span class="line">function updateViewModel() &#123;</span><br><span class="line">    if (imageryLayers.length &gt; 0) &#123;</span><br><span class="line">        var layer = imageryLayers.get(0);</span><br><span class="line">        viewModel.brightness = layer.brightness;</span><br><span class="line">        viewModel.contrast = layer.contrast;</span><br><span class="line">        viewModel.hue = layer.hue;</span><br><span class="line">        viewModel.saturation = layer.saturation;</span><br><span class="line">        viewModel.gamma = layer.gamma;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">imageryLayers.layerAdded.addEventListener(updateViewModel);</span><br><span class="line">imageryLayers.layerRemoved.addEventListener(updateViewModel);</span><br><span class="line">imageryLayers.layerMoved.addEventListener(updateViewModel);</span><br><span class="line">updateViewModel();</span><br></pre></td></tr></table></figure><h2 id="控制调整图层顺序"><a href="#控制调整图层顺序" class="headerlink" title="控制调整图层顺序"></a>控制调整图层顺序</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Cesium.Viewer(<span class="string">'cesiumContainer'</span>, &#123;</span><br><span class="line">    baseLayerPicker : <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> imageryLayers = viewer.imageryLayers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> viewModel = &#123;</span><br><span class="line">    layers : [],</span><br><span class="line">    baseLayers : [],</span><br><span class="line">    upLayer : <span class="literal">null</span>,</span><br><span class="line">    downLayer : <span class="literal">null</span>,</span><br><span class="line">    selectedLayer : <span class="literal">null</span>,</span><br><span class="line">    isSelectableLayer : <span class="function"><span class="keyword">function</span>(<span class="params">layer</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.baseLayers.indexOf(layer) &gt;= <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    raise : <span class="function"><span class="keyword">function</span>(<span class="params">layer, index</span>) </span>&#123;</span><br><span class="line">        imageryLayers.raise(layer);</span><br><span class="line">        viewModel.upLayer = layer;</span><br><span class="line">        viewModel.downLayer = viewModel.layers[<span class="built_in">Math</span>.max(<span class="number">0</span>, index - <span class="number">1</span>)];</span><br><span class="line">        updateLayerList();</span><br><span class="line">        <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            viewModel.upLayer = viewModel.downLayer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    lower : <span class="function"><span class="keyword">function</span>(<span class="params">layer, index</span>) </span>&#123;</span><br><span class="line">        imageryLayers.lower(layer);</span><br><span class="line">        viewModel.upLayer = viewModel.layers[<span class="built_in">Math</span>.min(viewModel.layers.length - <span class="number">1</span>, index + <span class="number">1</span>)];</span><br><span class="line">        viewModel.downLayer = layer;</span><br><span class="line">        updateLayerList();</span><br><span class="line">        <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            viewModel.upLayer = viewModel.downLayer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    canRaise : <span class="function"><span class="keyword">function</span>(<span class="params">layerIndex</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> layerIndex &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    canLower : <span class="function"><span class="keyword">function</span>(<span class="params">layerIndex</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> layerIndex &gt;= <span class="number">0</span> &amp;&amp; layerIndex &lt; imageryLayers.length - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> baseLayers = viewModel.baseLayers;</span><br><span class="line"></span><br><span class="line">Cesium.knockout.track(viewModel);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setupLayers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Create all the base layers that this example will support.</span></span><br><span class="line">    <span class="comment">// These base layers aren't really special.  It's possible to have multiple of them</span></span><br><span class="line">    <span class="comment">// enabled at once, just like the other layers, but it doesn't make much sense because</span></span><br><span class="line">    <span class="comment">// all of these layers cover the entire globe and are opaque.</span></span><br><span class="line">    addBaseLayerOption(</span><br><span class="line">        <span class="string">'Bing Maps Aerial'</span>,</span><br><span class="line">        <span class="literal">undefined</span>); <span class="comment">// the current base layer</span></span><br><span class="line">    addBaseLayerOption(</span><br><span class="line">        <span class="string">'Bing Maps Road'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.BingMapsImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'https://dev.virtualearth.net'</span>,</span><br><span class="line">            mapStyle : Cesium.BingMapsStyle.ROAD</span><br><span class="line">        &#125;));</span><br><span class="line">    addBaseLayerOption(</span><br><span class="line">        <span class="string">'ArcGIS World Street Maps'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.ArcGisMapServerImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer'</span></span><br><span class="line">        &#125;));</span><br><span class="line">    addBaseLayerOption(</span><br><span class="line">        <span class="string">'OpenStreetMaps'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.OpenStreetMapImageryProvider());</span><br><span class="line">    addBaseLayerOption(</span><br><span class="line">        <span class="string">'Stamen Maps'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.OpenStreetMapImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'https://stamen-tiles.a.ssl.fastly.net/watercolor/'</span>,</span><br><span class="line">            fileExtension : <span class="string">'jpg'</span>,</span><br><span class="line">            credit : <span class="string">'Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA.'</span></span><br><span class="line">        &#125;));</span><br><span class="line">    addBaseLayerOption(</span><br><span class="line">        <span class="string">'Natural Earth II (local)'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.TileMapServiceImageryProvider(&#123;</span><br><span class="line">            url : Cesium.buildModuleUrl(<span class="string">'Assets/Textures/NaturalEarthII'</span>)</span><br><span class="line">        &#125;));</span><br><span class="line">    addBaseLayerOption(</span><br><span class="line">        <span class="string">'USGS Shaded Relief (via WMTS)'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.WebMapTileServiceImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS'</span>,</span><br><span class="line">            layer : <span class="string">'USGSShadedReliefOnly'</span>,</span><br><span class="line">            style : <span class="string">'default'</span>,</span><br><span class="line">            format : <span class="string">'image/jpeg'</span>,</span><br><span class="line">            tileMatrixSetID : <span class="string">'default028mm'</span>,</span><br><span class="line">            maximumLevel : <span class="number">19</span>,</span><br><span class="line">            credit : <span class="string">'U. S. Geological Survey'</span></span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create the additional layers</span></span><br><span class="line">    addAdditionalLayerOption(</span><br><span class="line">        <span class="string">'United States GOES Infrared'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.WebMapServiceImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'https://mesonet.agron.iastate.edu/cgi-bin/wms/goes/conus_ir.cgi?'</span>,</span><br><span class="line">            layers : <span class="string">'goes_conus_ir'</span>,</span><br><span class="line">            credit : <span class="string">'Infrared data courtesy Iowa Environmental Mesonet'</span>,</span><br><span class="line">            parameters : &#123;</span><br><span class="line">                transparent : <span class="string">'true'</span>,</span><br><span class="line">                format : <span class="string">'image/png'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    addAdditionalLayerOption(</span><br><span class="line">        <span class="string">'United States Weather Radar'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.WebMapServiceImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi?'</span>,</span><br><span class="line">            layers : <span class="string">'nexrad-n0r'</span>,</span><br><span class="line">            credit : <span class="string">'Radar data courtesy Iowa Environmental Mesonet'</span>,</span><br><span class="line">            parameters : &#123;</span><br><span class="line">                transparent : <span class="string">'true'</span>,</span><br><span class="line">                format : <span class="string">'image/png'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    addAdditionalLayerOption(</span><br><span class="line">        <span class="string">'TileMapService Image'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.TileMapServiceImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'../images/cesium_maptiler/Cesium_Logo_Color'</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="number">0.2</span>);</span><br><span class="line">    addAdditionalLayerOption(</span><br><span class="line">        <span class="string">'Single Image'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.SingleTileImageryProvider(&#123;</span><br><span class="line">            url : <span class="string">'../images/Cesium_Logo_overlay.png'</span>,</span><br><span class="line">            rectangle : Cesium.Rectangle.fromDegrees(<span class="number">-115.0</span>, <span class="number">38.0</span>, <span class="number">-107</span>, <span class="number">39.75</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="number">1.0</span>);</span><br><span class="line">    addAdditionalLayerOption(</span><br><span class="line">        <span class="string">'Grid'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.GridImageryProvider(), <span class="number">1.0</span>, <span class="literal">false</span>);</span><br><span class="line">    addAdditionalLayerOption(</span><br><span class="line">        <span class="string">'Tile Coordinates'</span>,</span><br><span class="line">        <span class="keyword">new</span> Cesium.TileCoordinatesImageryProvider(), <span class="number">1.0</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addBaseLayerOption</span>(<span class="params">name, imageryProvider</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> layer;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> imageryProvider === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        layer = imageryLayers.get(<span class="number">0</span>);</span><br><span class="line">        viewModel.selectedLayer = layer;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        layer = <span class="keyword">new</span> Cesium.ImageryLayer(imageryProvider);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    layer.name = name;</span><br><span class="line">    baseLayers.push(layer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addAdditionalLayerOption</span>(<span class="params">name, imageryProvider, alpha, show</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> layer = imageryLayers.addImageryProvider(imageryProvider);</span><br><span class="line">    layer.alpha = Cesium.defaultValue(alpha, <span class="number">0.5</span>);</span><br><span class="line">    layer.show = Cesium.defaultValue(show, <span class="literal">true</span>);</span><br><span class="line">    layer.name = name;</span><br><span class="line">    Cesium.knockout.track(layer, [<span class="string">'alpha'</span>, <span class="string">'show'</span>, <span class="string">'name'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateLayerList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numLayers = imageryLayers.length;</span><br><span class="line">    viewModel.layers.splice(<span class="number">0</span>, viewModel.layers.length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = numLayers - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        viewModel.layers.push(imageryLayers.get(i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setupLayers();</span><br><span class="line">updateLayerList();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Bind the viewModel to the DOM elements of the UI that call for it.</span></span><br><span class="line"><span class="keyword">var</span> toolbar = <span class="built_in">document</span>.getElementById(<span class="string">'toolbar'</span>);</span><br><span class="line">Cesium.knockout.applyBindings(viewModel, toolbar);</span><br><span class="line"></span><br><span class="line">Cesium.knockout.getObservable(viewModel, <span class="string">'selectedLayer'</span>).subscribe(<span class="function"><span class="keyword">function</span>(<span class="params">baseLayer</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Handle changes to the drop-down base layer selector.</span></span><br><span class="line">    <span class="keyword">var</span> activeLayerIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> numLayers = viewModel.layers.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numLayers; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (viewModel.isSelectableLayer(viewModel.layers[i])) &#123;</span><br><span class="line">            activeLayerIndex = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> activeLayer = viewModel.layers[activeLayerIndex];</span><br><span class="line">    <span class="keyword">var</span> show = activeLayer.show;</span><br><span class="line">    <span class="keyword">var</span> alpha = activeLayer.alpha;</span><br><span class="line">    imageryLayers.remove(activeLayer, <span class="literal">false</span>);</span><br><span class="line">    imageryLayers.add(baseLayer, numLayers - activeLayerIndex - <span class="number">1</span>);</span><br><span class="line">    baseLayer.show = show;</span><br><span class="line">    baseLayer.alpha = alpha;</span><br><span class="line">    updateLayerList();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    @<span class="keyword">import</span> url(../templates/bucket.css);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-tag">rgba</span>(42, 42, 42, 0<span class="selector-class">.8</span>);</span></span><br><span class="line"><span class="undefined">        padding: 4px;</span></span><br><span class="line"><span class="undefined">        border-radius: 4px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="undefined">        vertical-align: middle;</span></span><br><span class="line"><span class="undefined">        padding-top: 2px;</span></span><br><span class="line"><span class="undefined">        padding-bottom: 2px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> <span class="selector-tag">table</span> <span class="selector-tag">tr</span> &#123;</span></span><br><span class="line"><span class="undefined">        transform: translateY(0);</span></span><br><span class="line"><span class="css">        <span class="selector-tag">transition</span>: <span class="selector-tag">transform</span> 0<span class="selector-class">.4s</span> <span class="selector-tag">ease-out</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> <span class="selector-tag">table</span> <span class="selector-tag">tr</span><span class="selector-class">.up</span> &#123;</span></span><br><span class="line"><span class="undefined">        transform: translateY(33px);</span></span><br><span class="line"><span class="undefined">        transition: none;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#toolbar</span> <span class="selector-tag">table</span> <span class="selector-tag">tr</span><span class="selector-class">.down</span> &#123;</span></span><br><span class="line"><span class="undefined">        transform: translateY(-33px);</span></span><br><span class="line"><span class="undefined">        transition: none;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"cesiumContainer"</span> <span class="attr">class</span>=<span class="string">"fullSize"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"loadingOverlay"</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"toolbar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">data-bind</span>=<span class="string">"foreach: layers"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">data-bind</span>=<span class="string">"css: &#123; up: $parent.upLayer === $data, down: $parent.downLayer === $data &#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">data-bind</span>=<span class="string">"checked: show"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">data-bind</span>=<span class="string">"text: name, visible: !$parent.isSelectableLayer($data)"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">data-bind</span>=<span class="string">"visible: $parent.isSelectableLayer($data), options: $parent.baseLayers, optionsText: 'name', value: $parent.selectedLayer"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0"</span> <span class="attr">max</span>=<span class="string">"1"</span> <span class="attr">step</span>=<span class="string">"0.01"</span> <span class="attr">data-bind</span>=<span class="string">"value: alpha, valueUpdate: 'input'"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"cesium-button"</span> <span class="attr">data-bind</span>=<span class="string">"click: function() &#123; $parent.raise($data, $index()); &#125;, visible: $parent.canRaise($index())"</span>&gt;</span></span><br><span class="line">                    ▲</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"cesium-button"</span> <span class="attr">data-bind</span>=<span class="string">"click: function() &#123; $parent.lower($data, $index()); &#125;, visible: $parent.canLower($index())"</span>&gt;</span></span><br><span class="line">                    ▼</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="切割图层-卷帘"><a href="#切割图层-卷帘" class="headerlink" title="切割图层(卷帘)"></a>切割图层(卷帘)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">var viewer = new Cesium.Viewer(&apos;cesiumContainer&apos;, &#123;</span><br><span class="line">    imageryProvider : new Cesium.ArcGisMapServerImageryProvider(&#123;</span><br><span class="line">        url : &apos;https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer&apos;</span><br><span class="line">    &#125;),</span><br><span class="line">    baseLayerPicker : false,</span><br><span class="line">    infoBox : false</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var layers = viewer.imageryLayers;</span><br><span class="line">var earthAtNight = layers.addImageryProvider(new Cesium.IonImageryProvider(&#123; assetId: 3812 &#125;));</span><br><span class="line">earthAtNight.splitDirection = Cesium.ImagerySplitDirection.LEFT; // Only show to the left of the slider.</span><br><span class="line"></span><br><span class="line">// Sync the position of the slider with the split position</span><br><span class="line">var slider = document.getElementById(&apos;slider&apos;);</span><br><span class="line">viewer.scene.imagerySplitPosition = (slider.offsetLeft) / slider.parentElement.offsetWidth;</span><br><span class="line"></span><br><span class="line">var handler = new Cesium.ScreenSpaceEventHandler(slider);</span><br><span class="line"></span><br><span class="line">var moveActive = false;</span><br><span class="line"></span><br><span class="line">function move(movement) &#123;</span><br><span class="line">    if(!moveActive) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var relativeOffset = movement.endPosition.x ;</span><br><span class="line">    var splitPosition = (slider.offsetLeft + relativeOffset) / slider.parentElement.offsetWidth;</span><br><span class="line">    slider.style.left = 100.0 * splitPosition + &apos;%&apos;;</span><br><span class="line">    viewer.scene.imagerySplitPosition = splitPosition;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handler.setInputAction(function() &#123;</span><br><span class="line">    moveActive = true;</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.LEFT_DOWN);</span><br><span class="line">handler.setInputAction(function() &#123;</span><br><span class="line">    moveActive = true;</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.PINCH_START);</span><br><span class="line"></span><br><span class="line">handler.setInputAction(move, Cesium.ScreenSpaceEventType.MOUSE_MOVE);</span><br><span class="line">handler.setInputAction(move, Cesium.ScreenSpaceEventType.PINCH_MOVE);</span><br><span class="line"></span><br><span class="line">handler.setInputAction(function() &#123;</span><br><span class="line">    moveActive = false;</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.LEFT_UP);</span><br><span class="line">handler.setInputAction(function() &#123;</span><br><span class="line">    moveActive = false;</span><br><span class="line">&#125;, Cesium.ScreenSpaceEventType.PINCH_END);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cesium应用程序另一个关键元素是Imagery(图层)。瓦片图集合根据不同的投影方式映射到虚拟的三维数字地球表面。依赖于相机指向地表的方向和距离，Cesium会去请求和渲染不同层级的图层详细信息。&lt;br&gt;多种图层能够被添加、移除、排序和适应到Cesium中。&lt;br&gt;Cesium提供了一系列方法用于处理图层，比如颜色自适应，图层叠加融合&lt;/p&gt;
    
    </summary>
    
      <category term="cesium" scheme="http://www.ibiji.top/categories/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/categories/cesium/js/"/>
    
    
      <category term="cesium" scheme="http://www.ibiji.top/tags/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>cesium(笔记-1)</title>
    <link href="http://www.ibiji.top/2019/08/17/cesium(%E7%AC%94%E8%AE%B0-1)/"/>
    <id>http://www.ibiji.top/2019/08/17/cesium(笔记-1)/</id>
    <published>2019-08-17T13:10:30.000Z</published>
    <updated>2020-08-04T12:52:31.003Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro</strong></p><h2 id="隐藏界面中的元素"><a href="#隐藏界面中的元素" class="headerlink" title="隐藏界面中的元素"></a>隐藏界面中的元素</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Cesium.Viewer(<span class="string">'cesiumContainer'</span>,&#123;</span><br><span class="line">    geocoder:<span class="literal">false</span>,  <span class="comment">//查找位置工具，查找到之后会将镜头对准找到的地址，默认使用bing地图</span></span><br><span class="line">    homeButton:<span class="literal">false</span>, <span class="comment">//视角返回初始位置</span></span><br><span class="line">    sceneModePicker:<span class="literal">false</span>, <span class="comment">//选择视角的模式，有三种：3D，2D，哥伦布视图（CV）</span></span><br><span class="line">    baseLayerPicker:<span class="literal">false</span>, <span class="comment">//图层选择器，选择要显示的地图服务和地形服务.</span></span><br><span class="line">    navigationHelpButton:<span class="literal">false</span>, <span class="comment">//导航帮助按钮，显示默认的地图控制帮助.</span></span><br><span class="line">    animation:<span class="literal">false</span>, <span class="comment">//动画器件，控制视图动画的播放速度</span></span><br><span class="line">    creditContainer:<span class="string">"credit"</span>,</span><br><span class="line">    timeline:<span class="literal">false</span>, <span class="comment">//时间线,指示当前时间，并允许用户跳到特定的时间</span></span><br><span class="line">    fullscreenButton:<span class="literal">false</span>, <span class="comment">//</span></span><br><span class="line">    vrButton:<span class="literal">false</span>, <span class="comment">//</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="通过css控制"><a href="#通过css控制" class="headerlink" title="通过css控制"></a>通过css控制</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="selector-class">.cesium-viewer-toolbar</span>,             <span class="comment">/* 右上角按钮组 */</span></span><br><span class="line"> <span class="selector-class">.cesium-viewer-animationContainer</span>,  <span class="comment">/* 左下角动画控件 */</span></span><br><span class="line"> <span class="selector-class">.cesium-viewer-timelineContainer</span>,   <span class="comment">/* 时间线 */</span></span><br><span class="line"> <span class="selector-class">.cesium-viewer-bottom</span>               <span class="comment">/* logo信息 */</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attribute">display</span>: none;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="selector-class">.cesium-viewer-fullscreenContainer</span>  <span class="comment">/* 全屏按钮 */</span></span><br><span class="line">&#123; <span class="attribute">position</span>: absolute; <span class="attribute">top</span>: -<span class="number">999em</span>;  &#125;</span><br></pre></td></tr></table></figure><h2 id="显示帧速-FPS"><a href="#显示帧速-FPS" class="headerlink" title="显示帧速(FPS)"></a>显示帧速(FPS)</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewer.scene.debugShowFramesPerSecond = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | cesium 1.58 | webstorm 2018.2.2 | windows 10 pro&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;隐藏界面中的元素&quot;&gt;&lt;a href=&quot;#隐藏界面中的元素&quot; class=&quot;headerlink&quot; title=&quot;隐藏界面中的元素&quot;&gt;&lt;/a&gt;隐藏界面中的元素&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; viewer = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Cesium.Viewer(&lt;span class=&quot;string&quot;&gt;&#39;cesiumContainer&#39;&lt;/span&gt;,&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    geocoder:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;//查找位置工具，查找到之后会将镜头对准找到的地址，默认使用bing地图&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    homeButton:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//视角返回初始位置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sceneModePicker:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//选择视角的模式，有三种：3D，2D，哥伦布视图（CV）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    baseLayerPicker:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//图层选择器，选择要显示的地图服务和地形服务.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    navigationHelpButton:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//导航帮助按钮，显示默认的地图控制帮助.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    animation:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//动画器件，控制视图动画的播放速度&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    creditContainer:&lt;span class=&quot;string&quot;&gt;&quot;credit&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    timeline:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//时间线,指示当前时间，并允许用户跳到特定的时间&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fullscreenButton:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    vrButton:&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="cesium" scheme="http://www.ibiji.top/categories/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/categories/cesium/js/"/>
    
    
      <category term="cesium" scheme="http://www.ibiji.top/tags/cesium/"/>
    
      <category term="js" scheme="http://www.ibiji.top/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>OpenStack部署(queens版)</title>
    <link href="http://www.ibiji.top/2019/06/28/OpenStack%E9%83%A8%E7%BD%B2queens%E7%89%88/"/>
    <id>http://www.ibiji.top/2019/06/28/OpenStack部署queens版/</id>
    <published>2019-06-28T14:05:01.000Z</published>
    <updated>2020-08-04T12:52:30.998Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | OpenStack queens | VMware Workstation 15 Pro</strong></p><a id="more"></a><table><thead><tr><th>主机名</th><th>备注</th><th>操作系统</th></tr></thead><tbody><tr><td>controller</td><td>控制节点</td><td>CentOs7</td></tr><tr><td>compute</td><td>计算节点</td><td>CentOs7</td></tr><tr><td>cinder</td><td>块存储节点</td><td>CentOs7</td></tr></tbody></table><h2 id="关闭虚拟机防火墙及selinux"><a href="#关闭虚拟机防火墙及selinux" class="headerlink" title="关闭虚拟机防火墙及selinux"></a>关闭虚拟机防火墙及selinux</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld.service</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">vim /etc/sysconfig/selinux</span><br><span class="line">SELINUX=disable//将enforcing修改为disable，永久关闭</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><p><a href="https://blog.51cto.com/13643643/2171262" target="_blank" rel="noopener">https://blog.51cto.com/13643643/2171262</a></p><p><a href="https://blog.csdn.net/qq_40791253/article/details/83241299#Controller_20" target="_blank" rel="noopener">https://blog.csdn.net/qq_40791253/article/details/83241299#Controller_20</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | OpenStack queens | VMware Workstation 15 Pro&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://www.ibiji.top/categories/linux/"/>
    
      <category term="集群部署" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/centos/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="集群部署" scheme="http://www.ibiji.top/tags/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>kylin部署</title>
    <link href="http://www.ibiji.top/2019/05/25/kylin%E9%83%A8%E7%BD%B2/"/>
    <id>http://www.ibiji.top/2019/05/25/kylin部署/</id>
    <published>2019-05-25T01:41:30.000Z</published>
    <updated>2020-08-04T12:52:31.015Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 |kylin-2.6.2-hbase1x</strong></p><blockquote><p>Apache Kylin™是一个开源的分布式分析引擎，提供Hadoop/Spark之上的SQL查询接口及多维分析（OLAP）能力以支持超大规模数据，最初由eBay Inc. 开发并贡献至开源社区。它能在亚秒内查询巨大的Hive表。</p></blockquote><a id="more"></a><h1 id="kylin-部署"><a href="#kylin-部署" class="headerlink" title="kylin 部署"></a>kylin 部署</h1><ul><li>下载 apache-kylin-2.6.2-bin-hbase1x.tar.gz</li></ul><h1 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-kylin-2.6.2-bin-hbase1x.tar.gz -C /opt</span><br></pre></td></tr></table></figure><h1 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">export hive_dependency=/opt/hive-1.2.2/conf:/opt/hive-1.2.2/lib*:/opt/hive-1.2.2/hcatalog/share/hcatalog/hive-hcatalog-core-2.0.0.jar</span><br></pre></td></tr></table></figure><h1 id="启动报错一"><a href="#启动报错一" class="headerlink" title="启动报错一"></a>启动报错一</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Something wrong with Hive CLI or Beeline, please execute Hive CLI or Beeline CLI in terminal to find the root cause.</span><br></pre></td></tr></table></figure><ul><li>修改 <code>kylin/bin/find-hive-dependency.sh</code> 部分代码</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">if [ "$&#123;client_mode&#125;" == "beeline" ]</span><br><span class="line">then</span><br><span class="line">    #beeline_shell=`$KYLIN_HOME/bin/get-properties.sh kylin.source.hive.beeline-shell`</span><br><span class="line">    #beeline_params=`bash $&#123;KYLIN_HOME&#125;/bin/get-properties.sh kylin.source.hive.beeline-params`</span><br><span class="line">    #hive_env=`$&#123;beeline_shell&#125; $&#123;hive_conf_properties&#125; $&#123;beeline_params&#125; --outputformat=dsv -e "set;" 2&gt;&amp;1 | grep --text 'env:CLASSPATH' `</span><br><span class="line">    beeline_params=`sh $&#123;KYLIN_HOME&#125;/bin/get-properties.sh kylin.hive.beeline.params`</span><br><span class="line">    hive_env=`beeline $&#123;beeline_params&#125; --outputformat=dsv -e set | grep 'env:CLASSPATH'`</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">    source $&#123;dir&#125;/check-hive-usability.sh</span><br><span class="line">    hive_env=`hive -e set | grep 'env:CLASSPATH'`</span><br><span class="line">    #hive_env=`hive $&#123;hive_conf_properties&#125; -e set 2&gt;&amp;1 | grep 'env:CLASSPATH'`</span><br><span class="line">    </span><br><span class="line">    #hive -e set &gt;/tmp/hive_env.txt 2&gt;&amp;1</span><br><span class="line">    #hive_env=`grep 'env:CLASSPATH' /tmp/hive_env.txt`</span><br><span class="line">    #hive_env=`echo $&#123;hive_env#*env:CLASSPATH&#125;`</span><br><span class="line">    #hive_env="env:CLASSPATH"$&#123;hive_env&#125;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><ul><li>修改  <code>kylin/conf/kylin.properties</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kylin.rest.servers=192.168.83.128:7070,192.168.83.129:7070,192.168.83.130:7070</span><br><span class="line">kylin.rest.timezone=GMT+8</span><br><span class="line">kylin.hive.client=beeline</span><br><span class="line">kylin.hive.beeline.params=-n root --hiveconf hive.security.authorization.sqlstd.confwhitelist.append='mapreduce.job.*|dfs.*' -u 'jdbc:hive2://192.168.83.128:10000'</span><br></pre></td></tr></table></figure><ul><li>分别验证 <code>bin/find-hive-dependency.sh</code></li></ul><blockquote><p>Retrieving hive dependency…<br>Connecting to jdbc:hive2://192.168.83.128:10000<br>Connected to: Apache Hive (version 1.2.2)<br>Driver: Hive JDBC (version 1.2.2)<br>Transaction isolation: TRANSACTION_REPEATABLE_READ<br>1,484 rows selected (0.89 seconds)<br>Beeline version 1.2.2 by Apache Hive<br>Closing: 0: jdbc:hive2://192.168.83.128:10000</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/find-hbase-dependency.sh</span><br></pre></td></tr></table></figure><blockquote><p>Retrieving hbase dependency…</p></blockquote><h1 id="启动报错二"><a href="#启动报错二" class="headerlink" title="启动报错二"></a>启动报错二</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">java.net.UnknownHostException: master:2181: 未知的名称或服务</span><br><span class="line">        at java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method)</span><br><span class="line">        at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:928)</span><br><span class="line">        at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1323)</span><br><span class="line">        at java.net.InetAddress.getAllByName0(InetAddress.java:1276)</span><br><span class="line">        at java.net.InetAddress.getAllByName(InetAddress.java:1192)</span><br><span class="line">        at java.net.InetAddress.getAllByName(InetAddress.java:1126)</span><br><span class="line">        at org.apache.zookeeper.client.StaticHostProvider.&lt;init&gt;(StaticHostProvider.java:61)</span><br><span class="line">        at org.apache.zookeeper.ZooKeeper.&lt;init&gt;(ZooKeeper.java:445)</span><br><span class="line">        at org.apache.curator.utils.DefaultZookeeperFactory.newZooKeeper(DefaultZookeeperFactory.java:29)</span><br><span class="line">        at org.apache.curator.framework.imps.CuratorFrameworkImpl$2.newZooKeeper(CuratorFrameworkImpl.java:154)</span><br><span class="line">        at org.apache.curator.HandleHolder$1.getZooKeeper(HandleHolder.java:94)</span><br><span class="line">        at org.apache.curator.HandleHolder.getZooKeeper(HandleHolder.java:55)</span><br><span class="line">        at org.apache.curator.ConnectionState.reset(ConnectionState.java:219)</span><br><span class="line">        at org.apache.curator.ConnectionState.start(ConnectionState.java:103)</span><br><span class="line">        at org.apache.curator.CuratorZookeeperClient.start(CuratorZookeeperClient.java:190)</span><br><span class="line">        at org.apache.curator.framework.imps.CuratorFrameworkImpl.start(CuratorFrameworkImpl.java:256)</span><br><span class="line">        at org.apache.kylin.storage.hbase.util.ZookeeperDistributedLock$Factory.getZKClient(ZookeeperDistributedLock.java:85)</span><br><span class="line">        at org.apache.kylin.storage.hbase.util.ZookeeperDistributedLock$Factory.&lt;init&gt;(ZookeeperDistributedLock.java:109)</span><br><span class="line">        at org.apache.kylin.storage.hbase.util.ZookeeperDistributedLock$Factory.&lt;init&gt;(ZookeeperDistributedLock.java:105)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span><br><span class="line">        at org.apache.kylin.common.util.ClassUtil.newInstance(ClassUtil.java:88)</span><br><span class="line">        at org.apache.kylin.common.KylinConfigBase.getDistributedLockFactory(KylinConfigBase.java:458)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseConnection.createHTableIfNeeded(HBaseConnection.java:327)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseResourceStore.createHTableIfNeeded(HBaseResourceStore.java:114)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseResourceStore.&lt;init&gt;(HBaseResourceStore.java:88)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span><br><span class="line">        at org.apache.kylin.common.persistence.ResourceStore.createResourceStore(ResourceStore.java:92)</span><br><span class="line">        at org.apache.kylin.common.persistence.ResourceStore.getStore(ResourceStore.java:111)</span><br><span class="line">        at org.apache.kylin.rest.service.AclTableMigrationTool.checkIfNeedMigrate(AclTableMigrationTool.java:99)</span><br><span class="line">        at org.apache.kylin.tool.AclTableMigrationCLI.main(AclTableMigrationCLI.java:43)</span><br><span class="line">2019-05-20 20:11:14,464 DEBUG [main] util.ZookeeperDistributedLock:147 : 27720@master trying to lock /kylin/kylin_metadata/create_htable/kylin_metadata/lock</span><br><span class="line">2019-05-20 20:11:29,653 ERROR [main] curator.ConnectionState:201 : Connection timed out for connection string (master:2181:2181,slave0:2181:2181,slave1:2181:2181) and timeout (15000) / elapsed (21695)</span><br><span class="line">org.apache.curator.CuratorConnectionLossException: KeeperErrorCode = ConnectionLoss</span><br><span class="line">        at org.apache.curator.ConnectionState.checkTimeouts(ConnectionState.java:198)</span><br><span class="line">        at org.apache.curator.ConnectionState.getZooKeeper(ConnectionState.java:88)</span><br><span class="line">        at org.apache.curator.CuratorZookeeperClient.getZooKeeper(CuratorZookeeperClient.java:115)</span><br><span class="line">        at org.apache.curator.framework.imps.CuratorFrameworkImpl.getZooKeeper(CuratorFrameworkImpl.java:474)</span><br><span class="line">        at org.apache.curator.framework.imps.CreateBuilderImpl$11.call(CreateBuilderImpl.java:688)</span><br><span class="line">        at org.apache.curator.framework.imps.CreateBuilderImpl$11.call(CreateBuilderImpl.java:672)</span><br><span class="line">        at org.apache.curator.RetryLoop.callWithRetry(RetryLoop.java:107)</span><br><span class="line">        at org.apache.curator.framework.imps.CreateBuilderImpl.pathInForeground(CreateBuilderImpl.java:668)</span><br><span class="line">        at org.apache.curator.framework.imps.CreateBuilderImpl.protectedPathInForeground(CreateBuilderImpl.java:453)</span><br><span class="line">        at org.apache.curator.framework.imps.CreateBuilderImpl.forPath(CreateBuilderImpl.java:443)</span><br><span class="line">        at org.apache.curator.framework.imps.CreateBuilderImpl.forPath(CreateBuilderImpl.java:44)</span><br><span class="line">        at org.apache.kylin.storage.hbase.util.ZookeeperDistributedLock.lock(ZookeeperDistributedLock.java:150)</span><br><span class="line">        at org.apache.kylin.storage.hbase.util.ZookeeperDistributedLock.lock(ZookeeperDistributedLock.java:171)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseConnection.createHTableIfNeeded(HBaseConnection.java:328)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseResourceStore.createHTableIfNeeded(HBaseResourceStore.java:114)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseResourceStore.&lt;init&gt;(HBaseResourceStore.java:88)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span><br><span class="line">        at org.apache.kylin.common.persistence.ResourceStore.createResourceStore(ResourceStore.java:92)</span><br><span class="line">        at org.apache.kylin.common.persistence.ResourceStore.getStore(ResourceStore.java:111)</span><br><span class="line">        at org.apache.kylin.rest.service.AclTableMigrationTool.checkIfNeedMigrate(AclTableMigrationTool.java:99)</span><br><span class="line">        at org.apache.kylin.tool.AclTableMigrationCLI.main(AclTableMigrationCLI.java:43)</span><br></pre></td></tr></table></figure><ul><li><figure class="highlight plain"><figcaption><span>hbase-site.xml文件```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- 指定hbase在HDFS上存储的路径 --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.rootdir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;hdfs://master:9000/hbase&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 指定hbase是分布式的 --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</span><br><span class="line">&lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 指定zk的地址，多个用“,”分割 --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</span><br><span class="line">&lt;value&gt;master,slave0,slave1&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.support.append&lt;/name&gt;</span><br><span class="line">&lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt; </span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;</span><br><span class="line">&lt;value&gt;2181&lt;/value&gt;</span><br><span class="line">&lt;source&gt;2181默认值，来源hbase-default.xml&lt;/source&gt; </span><br><span class="line">&lt;/property&gt; </span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;/root/tmp/hbase/zookeeper&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>http://192.168.83.128:7070/kylin</code></p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">2019-05-20 22:39:35,530 INFO  [main] util.ZookeeperDistributedLock:238 : 70746@master released lock at /kylin/kylin_metadata/create_htable/kylin_metadata/lock</span><br><span class="line">Exception in thread "main" java.lang.IllegalArgumentException: Failed to find metadata store by url: kylin_metadata@hbase</span><br><span class="line">        at org.apache.kylin.common.persistence.ResourceStore.createResourceStore(ResourceStore.java:99)</span><br><span class="line">        at org.apache.kylin.common.persistence.ResourceStore.getStore(ResourceStore.java:111)</span><br><span class="line">        at org.apache.kylin.rest.service.AclTableMigrationTool.checkIfNeedMigrate(AclTableMigrationTool.java:99)</span><br><span class="line">        at org.apache.kylin.tool.AclTableMigrationCLI.main(AclTableMigrationCLI.java:43)</span><br><span class="line">Caused by: java.lang.reflect.InvocationTargetException</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span><br><span class="line">        at org.apache.kylin.common.persistence.ResourceStore.createResourceStore(ResourceStore.java:92)</span><br><span class="line">        ... 3 more</span><br><span class="line">Caused by: org.apache.hadoop.hbase.client.RetriesExhaustedException: Failed after attempts=1, exceptions:</span><br><span class="line">Mon May 20 22:39:35 CST 2019, RpcRetryingCaller&#123;globalStartTime=1558363169520, pause=100, retries=1&#125;, java.io.IOException: Call to master/192.168.83.128:16000 failed on local exception: org.apache.hadoop.hbase.ipc.CallTimeoutException: Call id=7, waitTime=5001, operationTimeout=5000 expired.</span><br><span class="line"></span><br><span class="line">        at org.apache.hadoop.hbase.client.RpcRetryingCaller.callWithRetries(RpcRetryingCaller.java:157)</span><br><span class="line">        at org.apache.hadoop.hbase.client.HBaseAdmin.executeCallable(HBaseAdmin.java:4297)</span><br><span class="line">        at org.apache.hadoop.hbase.client.HBaseAdmin.executeCallable(HBaseAdmin.java:4289)</span><br><span class="line">        at org.apache.hadoop.hbase.client.HBaseAdmin.createTableAsyncV2(HBaseAdmin.java:753)</span><br><span class="line">        at org.apache.hadoop.hbase.client.HBaseAdmin.createTable(HBaseAdmin.java:674)</span><br><span class="line">        at org.apache.hadoop.hbase.client.HBaseAdmin.createTable(HBaseAdmin.java:607)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseConnection.createHTableIfNeeded(HBaseConnection.java:347)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseResourceStore.createHTableIfNeeded(HBaseResourceStore.java:114)</span><br><span class="line">        at org.apache.kylin.storage.hbase.HBaseResourceStore.&lt;init&gt;(HBaseResourceStore.java:88)</span><br><span class="line">        ... 8 more</span><br><span class="line">Caused by: java.io.IOException: Call to master/192.168.83.128:16000 failed on local exception: org.apache.hadoop.hbase.ipc.CallTimeoutException: Call id=7, waitTime=5001, operationTimeout=5000 expired.</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.AbstractRpcClient.wrapException(AbstractRpcClient.java:292)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.RpcClientImpl.call(RpcClientImpl.java:1276)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.AbstractRpcClient.callBlockingMethod(AbstractRpcClient.java:227)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.AbstractRpcClient$BlockingRpcChannelImplementation.callBlockingMethod(AbstractRpcClient.java:336)</span><br><span class="line">        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$BlockingStub.createTable(MasterProtos.java:58551)</span><br><span class="line">        at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation$4.createTable(ConnectionManager.java:1864)</span><br><span class="line">        at org.apache.hadoop.hbase.client.HBaseAdmin$5.call(HBaseAdmin.java:762)</span><br><span class="line">        at org.apache.hadoop.hbase.client.HBaseAdmin$5.call(HBaseAdmin.java:754)</span><br><span class="line">        at org.apache.hadoop.hbase.client.RpcRetryingCaller.callWithRetries(RpcRetryingCaller.java:136)</span><br><span class="line">        ... 16 more</span><br><span class="line">Caused by: org.apache.hadoop.hbase.ipc.CallTimeoutException: Call id=7, waitTime=5001, operationTimeout=5000 expired.</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.Call.checkAndSetTimeout(Call.java:73)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.RpcClientImpl.call(RpcClientImpl.java:1250)</span><br><span class="line">        ... 23 more</span><br><span class="line">2019-05-20 22:39:35,682 INFO  [close-hbase-conn] hbase.HBaseConnection:136 : Closing HBase connections...</span><br><span class="line">2019-05-20 22:39:35,683 INFO  [close-hbase-conn] client.ConnectionManager$HConnectionImplementation:2155 : Closing master protocol: MasterService</span><br><span class="line">2019-05-20 22:39:35,684 INFO  [close-hbase-conn] client.ConnectionManager$HConnectionImplementation:1726 : Closing zookeeper sessionid=0x36ad53f63430007</span><br><span class="line">2019-05-20 22:39:35,749 INFO  [main-EventThread] zookeeper.ClientCnxn:512 : EventThread shut down</span><br><span class="line">2019-05-20 22:39:35,749 INFO  [close-hbase-conn] zookeeper.ZooKeeper:684 : Session: 0x36ad53f63430007 closed</span><br><span class="line">2019-05-20 22:39:36,113 INFO  [Thread-6] zookeeper.ZooKeeper:684 : Session: 0x36ad53f63430008 closed</span><br><span class="line">2019-05-20 22:39:36,114 INFO  [main-EventThread] zookeeper.ClientCnxn:512 : EventThread shut down</span><br><span class="line">ERROR: Unknown error. Please check full log.</span><br></pre></td></tr></table></figure><ul><li><p>提取出重要的内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.TableExistsException): kylin_metadata </span><br><span class="line"></span><br><span class="line">Caused by: org.apache.hadoop.hbase.TableExistsException: kylin_metadata</span><br></pre></td></tr></table></figure></li><li><p>进入 zookeeper zkCli.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/opt/zookeeper-3.4.6/bin/zkCli.sh </span><br><span class="line">ls /hbase/table</span><br><span class="line">rmr /hbase/table/kylin_metadata</span><br><span class="line"></span><br><span class="line">重启hbase</span><br></pre></td></tr></table></figure></li><li><p>登陆 <code>http://host:7070/kylin</code></p></li></ul><p>没有反应<br>注释 <code>kylin/tomcat/conf/server.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"7443"</span> <span class="attr">protocol</span>=<span class="string">"org.apache.coyote.http11.Http11Protocol"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxThreads</span>=<span class="string">"150"</span> <span class="attr">SSLEnabled</span>=<span class="string">"true"</span> <span class="attr">scheme</span>=<span class="string">"https"</span> <span class="attr">secure</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">keystoreFile</span>=<span class="string">"conf/.keystore"</span> <span class="attr">keystorePass</span>=<span class="string">"changeit"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">clientAuth</span>=<span class="string">"false"</span> <span class="attr">sslProtocol</span>=<span class="string">"TLS"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p><ul><li>补充：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive 启动时无法访问spark-assembly-*.jar的解决办法</span><br><span class="line">将加载原来的lib/spark-assembly-*.jar`替换成jars/*.jar</span><br></pre></td></tr></table></figure></li></ul><p>部分代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># add Spark assembly jar to the classpath</span><br><span class="line">if [[ -n &quot;$SPARK_HOME&quot; ]]</span><br><span class="line">then</span><br><span class="line">  #sparkAssemblyPath=`ls $&#123;SPARK_HOME&#125;/lib/spark-assembly-*.jar`</span><br><span class="line">  sparkAssemblyPath=`ls $&#123;SPARK_HOME&#125;/jars/*.jar`</span><br><span class="line">  CLASSPATH=&quot;$&#123;CLASSPATH&#125;:$&#123;sparkAssemblyPath&#125;&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 |kylin-2.6.2-hbase1x&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Apache Kylin™是一个开源的分布式分析引擎，提供Hadoop/Spark之上的SQL查询接口及多维分析（OLAP）能力以支持超大规模数据，最初由eBay Inc. 开发并贡献至开源社区。它能在亚秒内查询巨大的Hive表。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://www.ibiji.top/categories/linux/"/>
    
      <category term="kylin" scheme="http://www.ibiji.top/categories/linux/kylin/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/linux/kylin/centos/"/>
    
      <category term="部署" scheme="http://www.ibiji.top/categories/linux/kylin/centos/%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="kylin" scheme="http://www.ibiji.top/tags/kylin/"/>
    
      <category term="部署" scheme="http://www.ibiji.top/tags/%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>kafka生产者启动报错及kafka常用命令</title>
    <link href="http://www.ibiji.top/2019/05/02/kafka%E7%94%9F%E4%BA%A7%E8%80%85%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99%E5%8F%8Akafka%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.ibiji.top/2019/05/02/kafka生产者启动报错及kafka常用命令/</id>
    <published>2019-05-02T14:10:25.000Z</published>
    <updated>2020-08-04T12:52:31.014Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 6.6 | kafka_2.11-1.1.1</strong></p><blockquote><p>kafka启动生产者后报错<br>WARN [Producer clientId=console-producer] Got error produce response with correlation id 3 on topic-partition test-2, retrying (2 attempts left). Error: NETWORK_EXCEPTION (org.apache.kafka.clients.producer.internals.Sender)</p></blockquote><a id="more"></a><h2 id="运行生产者命令后报错"><a href="#运行生产者命令后报错" class="headerlink" title="运行生产者命令后报错"></a>运行生产者命令后报错</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./kafka-console-producer.sh --broker-list 192.168.83.128:9092 --topic test</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>[2019-04-29 10:37:39,906] WARN [Producer clientId=console-producer] Got error produce response with correlation id 3 on topic-partition test-2, retrying (2 attempts left). Error: NETWORK_EXCEPTION (org.apache.kafka.clients.producer.internals.Sender)</span><br></pre></td></tr></table></figure><h2 id="运行消费者报错"><a href="#运行消费者报错" class="headerlink" title="运行消费者报错"></a>运行消费者报错</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./kafka-console-consumer.sh -zookeeper 192.168.83.129:2181 --from-beginning --topic test</span><br><span class="line"></span><br><span class="line">Using the ConsoleConsumer with old consumer is deprecated and will be removed in a future major release. Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper].</span><br></pre></td></tr></table></figure><h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[2019-05-02 16:10:25,182] ERROR Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)</span><br><span class="line">kafka.common.InconsistentBrokerIdException: Configured broker.id 2 doesn't match stored broker.id 0 in meta.properties. If you moved your data, make sure your configured broker.id matches. If you intend to create a new broker, you should remove all data in your data directories (log.dirs).</span><br><span class="line">        at kafka.server.KafkaServer.getBrokerIdAndOfflineDirs(KafkaServer.scala:673)</span><br><span class="line">        at kafka.server.KafkaServer.startup(KafkaServer.scala:209)</span><br><span class="line">        at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:38)</span><br><span class="line">        at kafka.Kafka$.main(Kafka.scala:75)</span><br><span class="line">        at kafka.Kafka.main(Kafka.scala)</span><br><span class="line">[2019-05-02 16:10:25,185] INFO shutting down (kafka.server.KafkaServer)</span><br><span class="line">[2019-05-02 16:10:25,209] WARN  (kafka.utils.CoreUtils$)</span><br><span class="line">java.lang.NullPointerException</span><br><span class="line">        at kafka.server.KafkaServer$$anonfun$shutdown$5.apply$mcV$sp(KafkaServer.scala:572)</span><br><span class="line">        at kafka.utils.CoreUtils$.swallow(CoreUtils.scala:85)</span><br><span class="line">        at kafka.server.KafkaServer.shutdown(KafkaServer.scala:572)</span><br><span class="line">        at kafka.server.KafkaServer.startup(KafkaServer.scala:329)</span><br><span class="line">        at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:38)</span><br><span class="line">        at kafka.Kafka$.main(Kafka.scala:75)</span><br><span class="line">        at kafka.Kafka.main(Kafka.scala)</span><br><span class="line">[2019-05-02 16:10:25,211] INFO [ZooKeeperClient] Closing. (kafka.zookeeper.ZooKeeperClient)</span><br><span class="line">[2019-05-02 16:10:25,244] INFO Session: 0x26a778905c40001 closed (org.apache.zookeeper.ZooKeeper)</span><br><span class="line">[2019-05-02 16:10:25,246] INFO [ZooKeeperClient] Closed. (kafka.zookeeper.ZooKeeperClient)</span><br><span class="line">[2019-05-02 16:10:25,250] INFO shut down completed (kafka.server.KafkaServer)</span><br><span class="line">[2019-05-02 16:10:25,250] ERROR Exiting Kafka. (kafka.server.KafkaServerStartable)</span><br></pre></td></tr></table></figure><h1 id="原因：-所有配置-broker-id-0"><a href="#原因：-所有配置-broker-id-0" class="headerlink" title="原因： 所有配置  broker.id=0"></a>原因： 所有配置  <code>broker.id=0</code></h1><p>修改 <code>kafka-logs-data/meta.properties</code><br>修改后重启正常生产和消费</p><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><p>生产者操作：<br><code>./kafka-console-producer.sh --broker-list master:9092 --topic test</code></p><p>消费者操作：<br><code>./kafka-console-consumer.sh --bootstrap-server master:9092 --topic test --from-beginning</code></p><p>创建topic<br><code>./kafka-topics.sh --create --zookeeper master:2181 --replication-factor 2 --partitions 3 --topic test</code></p><p>查看topic列表<br><code>./kafka-topics.sh --list --zookeeper master:2181</code></p><p>如果需要查看topic的详细信息，需要使用describe命令<br><code>./kafka-topics.sh --describe --zookeeper node1:2181 --topic test-topic</code></p><p>若不指定topic，则查看所有topic的信息<br><code>./kafka-topics.sh --describe --zookeeper node1:2181</code></p><p>删除topic<br><code>./kafka-topics.sh --delete --zookeeper master:2181 --topic test</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 6.6 | kafka_2.11-1.1.1&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;kafka启动生产者后报错&lt;br&gt;WARN [Producer clientId=console-producer] Got error produce response with correlation id 3 on topic-partition test-2, retrying (2 attempts left). Error: NETWORK_EXCEPTION (org.apache.kafka.clients.producer.internals.Sender)&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/centos/"/>
    
      <category term="kafka" scheme="http://www.ibiji.top/categories/centos/kafka/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/tags/centos/"/>
    
      <category term="kafka" scheme="http://www.ibiji.top/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>kafka压力、数据丢失测试</title>
    <link href="http://www.ibiji.top/2019/04/20/kafka%E5%8E%8B%E5%8A%9B%E4%B8%8E%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E6%B5%8B%E8%AF%95/"/>
    <id>http://www.ibiji.top/2019/04/20/kafka压力与数据丢失测试/</id>
    <published>2019-04-20T14:05:01.000Z</published>
    <updated>2020-08-04T12:52:31.013Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | kafka_2.11-1.1.1 | opt/zookeeper-3.4.6 | flume-1.8.0 | nginx-openresty/1.13.6.2</strong></p><p>本文主要通过Nginx做日志服务器 以POST请求生成日志（每次请求约为275字节，JSON格式），利用lua脚本变为相应格式，flume指定<code>Source</code>为<code>TailDirSouce</code>、<code>kafka Channel</code>、配置ACK应答机制<code>a1.channels.c1.kafka.producer.acks = -1</code>失败重试次数<code>a1.channels.c1.kafka.producer.retries = 3</code>;kafka主题设定三个分区两个副本</p><a id="more"></a><table><thead><tr><th>主机名</th><th>备注</th><th>操作系统</th><th>运行服务</th><th>配置</th></tr></thead><tbody><tr><td>master</td><td>控制节点</td><td>CentOs7</td><td>kafka、zookeeper、nginx、flume</td><td>1C 2GM</td></tr><tr><td>slave0</td><td>计算节点</td><td>CentOs7</td><td>kafka、zookeeper</td><td>1C 1.5GM</td></tr><tr><td>slave1</td><td>块存储节点</td><td>CentOs7</td><td>kafka、zookeeper</td><td>1C 1.5GM</td></tr></tbody></table><p><code>注：C-核 M-内存</code></p><h1 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/openresty/nginx/sbin/nginx</span><br></pre></td></tr></table></figure><h1 id="启动zookeeper"><a href="#启动zookeeper" class="headerlink" title="启动zookeeper"></a>启动zookeeper</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/zookeeper-3.4.6/bin/zkServer.sh start</span><br></pre></td></tr></table></figure><h1 id="启动flume"><a href="#启动flume" class="headerlink" title="启动flume"></a>启动flume</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent -n a1 -c conf/ -f myconf/nginx-kafka-kill.conf -Dflume.root.logger=INFO,consoledate</span><br></pre></td></tr></table></figure><h1 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/kafka_2.11-1.1.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.11-1.1.1/config/server.properties</span><br></pre></td></tr></table></figure><h1 id="以下为-IDEA-程序输出log数-与-Nginx采集到的log数、各个节点kafka消费到的log数对比"><a href="#以下为-IDEA-程序输出log数-与-Nginx采集到的log数、各个节点kafka消费到的log数对比" class="headerlink" title="以下为 IDEA 程序输出log数 与 Nginx采集到的log数、各个节点kafka消费到的log数对比"></a>以下为 IDEA 程序输出log数 与 Nginx采集到的log数、各个节点kafka消费到的log数对比</h1><table><thead><tr><th>IDEA log</th><th>Nginx log</th><th>Master消费</th><th>slave0消费</th><th>slave1消费</th></tr></thead><tbody><tr><td>1000</td><td>842</td><td>701</td><td>722</td><td>732</td></tr><tr><td>1500</td><td>1269</td><td>1041</td><td>1086  1111</td></tr><tr><td>2000</td><td>1727</td><td>1480</td><td>1493</td><td>1461</td></tr><tr><td>2500</td><td>2022</td><td>1665</td><td>1739</td><td>1655</td></tr><tr><td>3000</td><td>2315</td><td>1892</td><td>1983</td><td>2163</td></tr><tr><td>5000</td><td>4800</td><td>2924</td><td>2924</td><td>—-</td></tr></tbody></table><h2 id="期间杀掉master节点kafka进程，slave0节点停止消费（这里很疑惑）"><a href="#期间杀掉master节点kafka进程，slave0节点停止消费（这里很疑惑）" class="headerlink" title="期间杀掉master节点kafka进程，slave0节点停止消费（这里很疑惑）"></a>期间杀掉master节点kafka进程，slave0节点停止消费（这里很疑惑）</h2><p>查看主题详情<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic testkill</span><br><span class="line">Topic:testkill  PartitionCount:3        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: testkill Partition: 0    Leader: 1       Replicas: 0,1   Isr: 1</span><br><span class="line">        Topic: testkill Partition: 1    Leader: 2       Replicas: 1,2   Isr: 2,1</span><br><span class="line">        Topic: testkill Partition: 2    Leader: 2       Replicas: 2,0   Isr: 2</span><br></pre></td></tr></table></figure></p><h2 id="IDEA程序中设定5000次请求，请求完后，启动kafka进程"><a href="#IDEA程序中设定5000次请求，请求完后，启动kafka进程" class="headerlink" title="IDEA程序中设定5000次请求，请求完后，启动kafka进程"></a>IDEA程序中设定5000次请求，请求完后，启动kafka进程</h2><p>恢复后查看节点详情<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic testkill</span><br><span class="line">Topic:testkill  PartitionCount:3        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: testkill Partition: 0    Leader: 1       Replicas: 0,1   Isr: 1,0</span><br><span class="line">        Topic: testkill Partition: 1    Leader: 2       Replicas: 1,2   Isr: 2,1</span><br><span class="line">        Topic: testkill Partition: 2    Leader: 2       Replicas: 2,0   Isr: 2,0</span><br></pre></td></tr></table></figure></p><blockquote><p>kafka启动后，消费之前没有消费的数据,进本地磁盘各分区查找比对数据，均在</p></blockquote><h3 id="结论：初步认定kafka高可用，数据0丢失（杀掉master节点kafka进程-slave0节点停止消费这里有待验证），吞吐量2000条一下压力正常，随着时间推移数据量越大积压越大"><a href="#结论：初步认定kafka高可用，数据0丢失（杀掉master节点kafka进程-slave0节点停止消费这里有待验证），吞吐量2000条一下压力正常，随着时间推移数据量越大积压越大" class="headerlink" title="结论：初步认定kafka高可用，数据0丢失（杀掉master节点kafka进程,slave0节点停止消费这里有待验证），吞吐量2000条一下压力正常，随着时间推移数据量越大积压越大"></a>结论：初步认定kafka高可用，数据0丢失（杀掉master节点kafka进程,slave0节点停止消费这里有待验证），吞吐量2000条一下压力正常，随着时间推移数据量越大积压越大</h3><h1 id="kafka-offset-维护方式"><a href="#kafka-offset-维护方式" class="headerlink" title="kafka offset 维护方式"></a>kafka offset 维护方式</h1><ul><li>zookeeper维护</li></ul><blockquote><p>使用zookeeper来维护offset<br>kafka 0.9 以前的版本是将offset 存储在zookeeper上的，kafka在传输数据时，数据消费成功就会修改偏移量，这样就可以保证数据不会丢失而导致传输出错；但是这也存在一个问题：那就是每次消费数据时都要将数据的offset写入一次，效率比较低，而且zookeeper与kafka的offset变化确认也需要走网络IO，这样就会给offset的维护带来不稳定性和低效。</p></blockquote><ul><li>kafka自己维护offset</li></ul><blockquote><p>使用broker来维护offset<br>kafka 0.9 以后，offset的使用了内部的roker来管理，这样仅仅只需要broker，而不要zookeeper来维护，都是将topic提交给__consumer_offsets函数来执行。</p></blockquote><ul><li>也可以将kafka偏移量存入redis中，利用redis事务性维护offset</li></ul><h2 id="kafka消息的位置"><a href="#kafka消息的位置" class="headerlink" title="kafka消息的位置"></a>kafka消息的位置</h2><table><thead><tr><th>含义</th><th>名称</th></tr></thead><tbody><tr><td>earlieastLeaderOffsets</td><td>存储在broker上的leader节点的最早的消息偏移量 </td></tr><tr><td>consumerOffsets</td><td>消费者消费的消息偏移量位置</td></tr></tbody></table><p>情况一：正常情况下，消费的消息偏移量应该大于broker上存储的最早的消息偏移量，即 A &lt; B<br><img class="alignnone size-medium" src="/images/kafka/001.png"></p><p>情况二：如果A 依然小于 B，则仍可以正常消费<br><img class="alignnone size-medium" src="/images/kafka/002.png"></p><p>情况三：然而，当 A &gt; B 时，则说明还没有被消费的消息已经被清除<br><img class="alignnone size-medium" src="/images/kafka/003.png"></p><p> 此种情况会抛出 kafka.common.OffsetOutOfRangeException 异常。</p><blockquote><p>在没有外部系统清除kafka消息的情况下，协调设置broker的最大保留大小 log.retention.bytes 和 最大保留时间log.retention.hours 等，来配合消费者端的读取消息。可以通过读取和监控消费者消费的offsets，来保证消息不会被意外清除。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | kafka_2.11-1.1.1 | opt/zookeeper-3.4.6 | flume-1.8.0 | nginx-openresty/1.13.6.2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;本文主要通过Nginx做日志服务器 以POST请求生成日志（每次请求约为275字节，JSON格式），利用lua脚本变为相应格式，flume指定&lt;code&gt;Source&lt;/code&gt;为&lt;code&gt;TailDirSouce&lt;/code&gt;、&lt;code&gt;kafka Channel&lt;/code&gt;、配置ACK应答机制&lt;code&gt;a1.channels.c1.kafka.producer.acks = -1&lt;/code&gt;失败重试次数&lt;code&gt;a1.channels.c1.kafka.producer.retries = 3&lt;/code&gt;;kafka主题设定三个分区两个副本&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://www.ibiji.top/categories/linux/"/>
    
      <category term="集群" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4/"/>
    
      <category term="测试" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4/%E6%B5%8B%E8%AF%95/"/>
    
      <category term="kafka" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4/%E6%B5%8B%E8%AF%95/kafka/"/>
    
      <category term="flume" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4/%E6%B5%8B%E8%AF%95/kafka/flume/"/>
    
      <category term="zookeeper" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4/%E6%B5%8B%E8%AF%95/kafka/flume/zookeeper/"/>
    
      <category term="nginx" scheme="http://www.ibiji.top/categories/linux/%E9%9B%86%E7%BE%A4/%E6%B5%8B%E8%AF%95/kafka/flume/zookeeper/nginx/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="zookeeper" scheme="http://www.ibiji.top/tags/zookeeper/"/>
    
      <category term="测试" scheme="http://www.ibiji.top/tags/%E6%B5%8B%E8%AF%95/"/>
    
      <category term="nginx" scheme="http://www.ibiji.top/tags/nginx/"/>
    
      <category term="flume" scheme="http://www.ibiji.top/tags/flume/"/>
    
      <category term="集群" scheme="http://www.ibiji.top/tags/%E9%9B%86%E7%BE%A4/"/>
    
      <category term="kafka" scheme="http://www.ibiji.top/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch 启动报错(3)</title>
    <link href="http://www.ibiji.top/2019/04/12/elasticsearch%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%993/"/>
    <id>http://www.ibiji.top/2019/04/12/elasticsearch启动报错3/</id>
    <published>2019-04-12T15:10:31.000Z</published>
    <updated>2020-08-04T12:52:31.008Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | elasticsearch 6.5.4</strong></p><p>elasticsearch 启动报错<code>org.elasticsearch.discovery.MasterNotDiscoveredException: null</code><br><a id="more"></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[2019-04-12T22:25:44,586][WARN ][r.suppressed             ] [master] path: /_cluster/health, params: &#123;&#125;</span><br><span class="line">org.elasticsearch.discovery.MasterNotDiscoveredException: null</span><br><span class="line">        at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$4.onTimeout(TransportMasterNodeAction.java:246) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onTimeout(ClusterStateObserver.java:317) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.onTimeout(ClusterStateObserver.java:244) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.service.ClusterApplierService$NotifyTimeout.run(ClusterApplierService.java:559) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:624) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]</span><br><span class="line">[2019-04-12T22:25:44,594][DEBUG][o.e.a.a.c.h.TransportClusterHealthAction] [master] timed out while retrying [cluster:monitor/health] after failure (timeout [30s])</span><br><span class="line">[2019-04-12T22:25:44,594][WARN ][r.suppressed             ] [master] path: /_cluster/health, params: &#123;&#125;</span><br><span class="line">org.elasticsearch.discovery.MasterNotDiscoveredException: null</span><br><span class="line">        at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$4.onTimeout(TransportMasterNodeAction.java:246) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onTimeout(ClusterStateObserver.java:317) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.onTimeout(ClusterStateObserver.java:244) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.service.ClusterApplierService$NotifyTimeout.run(ClusterApplierService.java:559) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:624) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]</span><br><span class="line">[2019-04-12T22:25:45,108][DEBUG][o.e.a.a.c.h.TransportClusterHealthAction] [master] timed out while retrying [cluster:monitor/health] after failure (timeout [30s])</span><br><span class="line">[2019-04-12T22:25:45,108][WARN ][r.suppressed             ] [master] path: /_cluster/health, params: &#123;pretty=&#125;</span><br><span class="line">org.elasticsearch.discovery.MasterNotDiscoveredException: null</span><br><span class="line">        at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$4.onTimeout(TransportMasterNodeAction.java:246) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onTimeout(ClusterStateObserver.java:317) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.onTimeout(ClusterStateObserver.java:244) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.cluster.service.ClusterApplierService$NotifyTimeout.run(ClusterApplierService.java:559) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:624) [elasticsearch-6.5.4.jar:6.5.4]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]</span><br></pre></td></tr></table></figure><h2 id="原因：elasticsearch没有发现master和集群初始化主节点的配置为空"><a href="#原因：elasticsearch没有发现master和集群初始化主节点的配置为空" class="headerlink" title="原因：elasticsearch没有发现master和集群初始化主节点的配置为空"></a>原因：elasticsearch没有发现master和集群初始化主节点的配置为空</h2><p>解决办法：修改elasticsearch.yml，添加如下配置</p><blockquote><p>cluster.initial_master_nodes: [“master”]</p></blockquote><h2 id="可能是网络原因，下次遇到的话先检查网络是否畅通-仅供参考-："><a href="#可能是网络原因，下次遇到的话先检查网络是否畅通-仅供参考-：" class="headerlink" title="可能是网络原因，下次遇到的话先检查网络是否畅通(仅供参考)："></a>可能是网络原因，下次遇到的话先检查网络是否畅通(仅供参考)：</h2><blockquote><p>discovery.zen.fd.ping_timeout: 1m<br>discovery.zen.fd.ping_retries: 5</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | elasticsearch 6.5.4&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;elasticsearch 启动报错&lt;code&gt;org.elasticsearch.discovery.MasterNotDiscoveredException: null&lt;/code&gt;&lt;br&gt;
    
    </summary>
    
      <category term="改错" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/"/>
    
      <category term="elasticsearch" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/elasticsearch/"/>
    
      <category term="es" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/elasticsearch/es/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="error" scheme="http://www.ibiji.top/tags/error/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/tags/centos/"/>
    
      <category term="elasticsearch" scheme="http://www.ibiji.top/tags/elasticsearch/"/>
    
      <category term="es" scheme="http://www.ibiji.top/tags/es/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch 启动报错(2)</title>
    <link href="http://www.ibiji.top/2019/04/11/elasticsearch%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%992/"/>
    <id>http://www.ibiji.top/2019/04/11/elasticsearch启动报错2/</id>
    <published>2019-04-11T14:30:10.000Z</published>
    <updated>2020-08-04T12:52:31.008Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | elasticsearch 6.5.4 | VMware Workstation Pro</strong></p><h1 id="初次启动elasticsearch报错"><a href="#初次启动elasticsearch报错" class="headerlink" title="初次启动elasticsearch报错"></a>初次启动elasticsearch报错</h1><ul><li>[2019-04-11T17:32:11,932][INFO ][o.e.e.NodeEnvironment    ] [uITtGcF] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [41.5gb], net total_space [49.9gb], types [rootfs]<a id="more"></a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[doit@master ~]$ /opt/elasticsearch-6.5.4/bin/elasticsearch</span><br><span class="line">[2019-04-11T17:32:11,932][INFO ][o.e.e.NodeEnvironment    ] [uITtGcF] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [41.5gb], net total_space [49.9gb], types [rootfs]</span><br><span class="line">[2019-04-11T17:32:11,990][INFO ][o.e.e.NodeEnvironment    ] [uITtGcF] heap size [1015.6mb], compressed ordinary object pointers [true]</span><br><span class="line">[2019-04-11T17:32:11,993][INFO ][o.e.n.Node               ] [uITtGcF] node name derived from node ID [uITtGcFxRLSFwkuE1FUtwg]; set [node.name] to override</span><br><span class="line">[2019-04-11T17:32:11,994][INFO ][o.e.n.Node               ] [uITtGcF] version[6.5.4], pid[2833], build[default/tar/d2ef93d/2018-12-17T21:17:40.758843Z], OS[Linux/3.10.0-514.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_131/25.131-b11]</span><br><span class="line">[2019-04-11T17:32:11,994][INFO ][o.e.n.Node               ] [uITtGcF] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/tmp/elasticsearch.nQEcpVMV, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -Des.path.home=/opt/elasticsearch-6.5.4, -Des.path.conf=/opt/elasticsearch-6.5.4/config, -Des.distribution.flavor=default, -Des.distribution.type=tar]</span><br><span class="line">[2019-04-11T17:32:29,133][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [aggs-matrix-stats]</span><br><span class="line">[2019-04-11T17:32:29,133][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [analysis-common]</span><br><span class="line">[2019-04-11T17:32:29,134][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [ingest-common]</span><br><span class="line">[2019-04-11T17:32:29,134][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [lang-expression]</span><br><span class="line">[2019-04-11T17:32:29,134][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [lang-mustache]</span><br><span class="line">[2019-04-11T17:32:29,134][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [lang-painless]</span><br><span class="line">[2019-04-11T17:32:29,134][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [mapper-extras]</span><br><span class="line">[2019-04-11T17:32:29,135][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [parent-join]</span><br><span class="line">[2019-04-11T17:32:29,135][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [percolator]</span><br><span class="line">[2019-04-11T17:32:29,135][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [rank-eval]</span><br><span class="line">[2019-04-11T17:32:29,135][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [reindex]</span><br><span class="line">[2019-04-11T17:32:29,135][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [repository-url]</span><br><span class="line">[2019-04-11T17:32:29,136][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [transport-netty4]</span><br><span class="line">[2019-04-11T17:32:29,136][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [tribe]</span><br><span class="line">[2019-04-11T17:32:29,136][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-ccr]</span><br><span class="line">[2019-04-11T17:32:29,136][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-core]</span><br><span class="line">[2019-04-11T17:32:29,136][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-deprecation]</span><br><span class="line">[2019-04-11T17:32:29,136][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-graph]</span><br><span class="line">[2019-04-11T17:32:29,137][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-logstash]</span><br><span class="line">[2019-04-11T17:32:29,137][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-ml]</span><br><span class="line">[2019-04-11T17:32:29,137][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-monitoring]</span><br><span class="line">[2019-04-11T17:32:29,137][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-rollup]</span><br><span class="line">[2019-04-11T17:32:29,137][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-security]</span><br><span class="line">[2019-04-11T17:32:29,138][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-sql]</span><br><span class="line">[2019-04-11T17:32:29,138][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-upgrade]</span><br><span class="line">[2019-04-11T17:32:29,138][INFO ][o.e.p.PluginsService     ] [uITtGcF] loaded module [x-pack-watcher]</span><br><span class="line">[2019-04-11T17:32:29,138][INFO ][o.e.p.PluginsService     ] [uITtGcF] no plugins loaded</span><br><span class="line">[2019-04-11T17:32:56,126][INFO ][o.e.x.s.a.s.FileRolesStore] [uITtGcF] parsed [0] roles from file [/opt/elasticsearch-6.5.4/config/roles.yml]</span><br><span class="line">[2019-04-11T17:33:00,018][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [uITtGcF] [controller/2892] [Main.cc@109] controller (64 bit): Version 6.5.4 (Build b616085ef32393) Copyright (c) 2018 Elasticsearch BV</span><br><span class="line">[2019-04-11T17:33:03,297][DEBUG][o.e.a.ActionModule       ] [uITtGcF] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security</span><br><span class="line">[2019-04-11T17:33:05,848][INFO ][o.e.d.DiscoveryModule    ] [uITtGcF] using discovery type [zen] and host providers [settings]</span><br><span class="line">[2019-04-11T17:33:09,911][INFO ][o.e.n.Node               ] [uITtGcF] initialized</span><br><span class="line">[2019-04-11T17:33:09,912][INFO ][o.e.n.Node               ] [uITtGcF] starting ...</span><br><span class="line">[2019-04-11T17:33:11,314][INFO ][o.e.t.TransportService   ] [uITtGcF] publish_address &#123;192.168.83.128:9300&#125;, bound_addresses &#123;192.168.83.128:9300&#125;</span><br><span class="line">[2019-04-11T17:33:11,462][INFO ][o.e.b.BootstrapChecks    ] [uITtGcF] bound or publishing to a non-loopback address, enforcing bootstrap checks</span><br><span class="line">ERROR: [1] bootstrap checks failed</span><br><span class="line">[1]: max number of threads [3782] for user [doit] is too low, increase to at least [4096]</span><br><span class="line">[2019-04-11T17:33:11,505][INFO ][o.e.n.Node               ] [uITtGcF] stopping ...</span><br><span class="line">[2019-04-11T17:33:11,891][INFO ][o.e.n.Node               ] [uITtGcF] stopped</span><br><span class="line">[2019-04-11T17:33:11,891][INFO ][o.e.n.Node               ] [uITtGcF] closing ...</span><br><span class="line">[2019-04-11T17:33:11,957][INFO ][o.e.n.Node               ] [uITtGcF] closed</span><br><span class="line">[2019-04-11T17:33:11,985][INFO ][o.e.x.m.j.p.NativeController] [uITtGcF] Native controller process has stopped - no new native processes can be started</span><br></pre></td></tr></table></figure><h1 id="问题原因-amp-解决方法"><a href="#问题原因-amp-解决方法" class="headerlink" title="问题原因 &amp; 解决方法"></a>问题原因 &amp; 解决方法</h1><blockquote><ul><li>内存不足,加大内存,报错前内存是1G，修改为2G问题解决</li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | elasticsearch 6.5.4 | VMware Workstation Pro&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&quot;初次启动elasticsearch报错&quot;&gt;&lt;a href=&quot;#初次启动elasticsearch报错&quot; class=&quot;headerlink&quot; title=&quot;初次启动elasticsearch报错&quot;&gt;&lt;/a&gt;初次启动elasticsearch报错&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;[2019-04-11T17:32:11,932][INFO ][o.e.e.NodeEnvironment    ] [uITtGcF] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [41.5gb], net total_space [49.9gb], types [rootfs]
    
    </summary>
    
      <category term="改错" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/"/>
    
      <category term="elasticsearch" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/elasticsearch/"/>
    
      <category term="es" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/elasticsearch/es/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="error" scheme="http://www.ibiji.top/tags/error/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/tags/centos/"/>
    
      <category term="elasticsearch" scheme="http://www.ibiji.top/tags/elasticsearch/"/>
    
      <category term="es" scheme="http://www.ibiji.top/tags/es/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch 启动报错(1)</title>
    <link href="http://www.ibiji.top/2019/04/11/elasticsearch%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%991/"/>
    <id>http://www.ibiji.top/2019/04/11/elasticsearch启动报错1/</id>
    <published>2019-04-11T14:10:31.000Z</published>
    <updated>2020-08-04T12:52:31.007Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | elasticsearch 6.5.4</strong></p><h1 id="elasticsearch-启动报错"><a href="#elasticsearch-启动报错" class="headerlink" title="elasticsearch 启动报错"></a>elasticsearch 启动报错</h1><ul><li>2019-04-11 21:24:31,724 main ERROR Unable to invoke factory method in class org.apache.logging.log4j.core.appender.RollingFileAppender for element RollingFile: java.lang.IllegalStateException: No factory method found for class </li></ul><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">2019-04-11 21:24:31,724 main ERROR Unable to invoke factory method in class org.apache.logging.log4j.core.appender.RollingFileAppender for element RollingFile: java.lang.IllegalStateException: No factory method found for class </span><br><span class="line">org.apache.logging.log4j.core.appender.RollingFileAppender java.lang.IllegalStateException: No factory method found for class org.apache.logging.log4j.core.appender.RollingFileAppender</span><br><span class="line">        at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.findFactoryMethod(PluginBuilder.java:235)</span><br><span class="line">        at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:135)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:959)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:899)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:891)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:514)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:238)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:250)</span><br><span class="line">        at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:547)</span><br><span class="line">        at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:263)</span><br><span class="line">        at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:234)</span><br><span class="line">        at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:127)</span><br><span class="line">        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:302)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127)</span><br><span class="line">        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)</span><br><span class="line">        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)</span><br><span class="line">        at org.elasticsearch.cli.Command.main(Command.java:90)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86)</span><br><span class="line"></span><br><span class="line">2019-04-11 21:24:31,734 main ERROR RollingFileManager (/opt/elasticsearch-6.5.4/logs/mycluster_index_search_slowlog.log) java.io.FileNotFoundException: /opt/elasticsearch-6.5.4/logs/mycluster_index_search_slowlog.log (权限不够) java.io.FileNotFoundException: /opt/elasticsearch-6.5.4/logs/mycluster_index_search_slowlog.log (权限不够)</span><br><span class="line">        at java.io.FileOutputStream.open0(Native Method)</span><br><span class="line">        at java.io.FileOutputStream.open(FileOutputStream.java:270)</span><br><span class="line">        at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:213)</span><br><span class="line">        at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:133)</span><br><span class="line">        at org.apache.logging.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory.createManager(RollingFileManager.java:640)</span><br><span class="line">        at org.apache.logging.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory.createManager(RollingFileManager.java:608)</span><br><span class="line">        at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:113)</span><br><span class="line">        at org.apache.logging.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:114)</span><br><span class="line">        at org.apache.logging.log4j.core.appender.rolling.RollingFileManager.getFileManager(RollingFileManager.java:188)</span><br><span class="line">        at org.apache.logging.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:145)</span><br><span class="line">        at org.apache.logging.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:61)</span><br><span class="line">        at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:123)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:959)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:899)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:891)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:514)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:238)</span><br><span class="line">        at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:250)</span><br><span class="line">        at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:547)</span><br><span class="line">        at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:263)</span><br><span class="line">        at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:234)</span><br><span class="line">        at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:127)</span><br><span class="line">        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:302)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127)</span><br><span class="line">        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)</span><br><span class="line">        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)</span><br><span class="line">        at org.elasticsearch.cli.Command.main(Command.java:90)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93)</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86)</span><br></pre></td></tr></table></figure><blockquote><ul><li>检查文件权限问题</li><li>系日志文件造成，删除执行命令的输出日志</li><li>以非root账号启动，启动成功</li></ul></blockquote><h1 id="百度参考解决方法："><a href="#百度参考解决方法：" class="headerlink" title="百度参考解决方法："></a>百度参考解决方法：</h1><p><a href="https://discuss.elastic.co/t/error-null-object-returned-for-rollingfile-in-appenders/103990" target="_blank" rel="noopener">elastic官网</a><br><a href="https://www.2cto.com/net/201812/790168.html" target="_blank" rel="noopener">红黑联盟</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | elasticsearch 6.5.4&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&quot;elasticsearch-启动报错&quot;&gt;&lt;a href=&quot;#elasticsearch-启动报错&quot; class=&quot;headerlink&quot; title=&quot;elasticsearch 启动报错&quot;&gt;&lt;/a&gt;elasticsearch 启动报错&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;2019-04-11 21:24:31,724 main ERROR Unable to invoke factory method in class org.apache.logging.log4j.core.appender.RollingFileAppender for element RollingFile: java.lang.IllegalStateException: No factory method found for class &lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="改错" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/"/>
    
      <category term="elasticsearch" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/elasticsearch/"/>
    
      <category term="es" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/elasticsearch/es/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="error" scheme="http://www.ibiji.top/tags/error/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/tags/centos/"/>
    
      <category term="elasticsearch" scheme="http://www.ibiji.top/tags/elasticsearch/"/>
    
      <category term="es" scheme="http://www.ibiji.top/tags/es/"/>
    
  </entry>
  
  <entry>
    <title>flume启动agent报错</title>
    <link href="http://www.ibiji.top/2019/04/06/flume%E5%90%AF%E5%8A%A8agent%E6%8A%A5%E9%94%99/"/>
    <id>http://www.ibiji.top/2019/04/06/flume启动agent报错/</id>
    <published>2019-04-06T15:58:40.000Z</published>
    <updated>2020-08-04T12:52:31.009Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | ubuntu 18.4 | flume 1.8.0</strong></p><h1 id="flume-启动agent报错"><a href="#flume-启动agent报错" class="headerlink" title="flume 启动agent报错"></a>flume 启动agent报错</h1><ul><li>Including Hadoop libraries found via (/opt/hadoop-2.8.5/bin/hadoop) for HDFS access<br>Info: Including Hive libraries found via (/opt/hive-1.2.2) for Hive access</li></ul><ul><li>exec /usr/jdk1.8/bin/java -Xmx20m -Dflume.root.logger=INFO,console</li></ul><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">antler@antler:/opt/flume-1.8.0$ ./bin/flume-ng agent -c conf/ -f myconf/flume.conf -Dflume.root.logger=INFO,consoleInfo: Including Hadoop libraries found via (/opt/hadoop-2.8.5/bin/hadoop) for HDFS access</span><br><span class="line">Info: Including Hive libraries found via (/opt/hive-1.2.2) for Hive access</span><br><span class="line">+ exec /usr/jdk1.8/bin/java -Xmx20m -Dflume.root.logger=INFO,console -cp &apos;/opt/flume-1.8.0/conf:/opt/flume-1.8.0/lib/*:/opt/hadoop-2.8.5/etc/hadoop:/opt/hadoop-2.8.5/share/hadoop/common/lib/*:/opt/hadoop-2.8.5/share/hadoop/common/*:/opt/hadoop-2.8.5/share/hadoop/hdfs:/opt/hadoop-2.8.5/share/hadoop/hdfs/lib/*:/opt/hadoop-2.8.5/share/hadoop/hdfs/*:/opt/hadoop-2.8.5/share/hadoop/yarn/lib/*:/opt/hadoop-2.8.5/share/hadoop/yarn/*:/opt/hadoop-2.8.5/share/hadoop/mapreduce/lib/*:/opt/hadoop-2.8.5/share/hadoop/mapreduce/*:/opt/hadoop-2.8.5/contrib/capacity-scheduler/*.jar:/opt/hive-1.2.2/lib/*&apos; -Djava.library.path=:/opt/hadoop-2.8.5/lib/native org.apache.flume.node.Application -f myconf/flume.conf</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/flume-1.8.0/lib/slf4j-log4j12-1.6.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hadoop-2.8.5/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">2019-04-06 19:58:40,247 (main) [ERROR - org.apache.flume.node.Application.main(Application.java:348)] A fatal error occurred while running. Exception follows.</span><br><span class="line">org.apache.commons.cli.MissingOptionException: Missing required option: n</span><br><span class="line">at org.apache.commons.cli.Parser.checkRequiredOptions(Parser.java:299)</span><br><span class="line">at org.apache.commons.cli.Parser.parse(Parser.java:231)</span><br><span class="line">at org.apache.commons.cli.Parser.parse(Parser.java:85)</span><br><span class="line">at org.apache.flume.node.Application.main(Application.java:263)</span><br></pre></td></tr></table></figure><h1 id="问题原因-amp-解决方法"><a href="#问题原因-amp-解决方法" class="headerlink" title="问题原因 &amp; 解决方法"></a>问题原因 &amp; 解决方法</h1><blockquote><ul><li>命令错误</li><li>正确命令： bin/flume-ng agent -n a1 -c conf/ -f myconf/tail-avro.conf -Dflume.root.logger=INFO,console</li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | ubuntu 18.4 | flume 1.8.0&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&quot;flume-启动agent报错&quot;&gt;&lt;a href=&quot;#flume-启动agent报错&quot; class=&quot;headerlink&quot; title=&quot;flume 启动agent报错&quot;&gt;&lt;/a&gt;flume 启动agent报错&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;Including Hadoop libraries found via (/opt/hadoop-2.8.5/bin/hadoop) for HDFS access&lt;br&gt;Info: Including Hive libraries found via (/opt/hive-1.2.2) for Hive access&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;exec /usr/jdk1.8/bin/java -Xmx20m -Dflume.root.logger=INFO,console&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="改错" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/"/>
    
      <category term="ubuntu" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/ubuntu/"/>
    
      <category term="flume" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/ubuntu/flume/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="error" scheme="http://www.ibiji.top/tags/error/"/>
    
      <category term="flume" scheme="http://www.ibiji.top/tags/flume/"/>
    
      <category term="ubuntu" scheme="http://www.ibiji.top/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>spark-sql启动报错util.NativeCodeLoader</title>
    <link href="http://www.ibiji.top/2019/03/16/sparksql%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99utilNativeCodeLoader/"/>
    <id>http://www.ibiji.top/2019/03/16/sparksql启动报错utilNativeCodeLoader/</id>
    <published>2019-03-16T15:50:10.000Z</published>
    <updated>2020-08-04T12:52:31.017Z</updated>
    
    <content type="html"><![CDATA[<p><strong>运行环境 | centos 7.0 | spark 2.2.0 | scala-2.11.8 | mysql-connector-java-5.1.38.jar</strong></p><h1 id="启动saprk-sql报错"><a href="#启动saprk-sql报错" class="headerlink" title="启动saprk-sql报错"></a>启动saprk-sql报错</h1><ul><li>19/03/16 20:40:48 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable</li></ul><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">[root@master bin]# ./spark-sql --master spark://master:7077 --jars /root/mysql-connector-java-5.1.38.jar </span><br><span class="line">19/03/16 20:40:48 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">19/03/16 20:40:48 INFO metastore.HiveMetaStore: 0: Opening raw store with implemenation class:org.apache.hadoop.hive.metastore.ObjectStore</span><br><span class="line">19/03/16 20:40:48 INFO metastore.ObjectStore: ObjectStore, initialize called</span><br><span class="line">19/03/16 20:40:49 INFO DataNucleus.Persistence: Property hive.metastore.integral.jdo.pushdown unknown - will be ignored</span><br><span class="line">19/03/16 20:40:49 INFO DataNucleus.Persistence: Property datanucleus.cache.level2 unknown - will be ignored</span><br><span class="line">19/03/16 20:40:58 INFO metastore.ObjectStore: Setting MetaStore object pin classes with hive.metastore.cache.pinobjtypes=&quot;Table,StorageDescriptor,SerDeInfo,Partition,Database,Type,FieldSchema,Order&quot;</span><br><span class="line">19/03/16 20:41:03 INFO DataNucleus.Datastore: The class &quot;org.apache.hadoop.hive.metastore.model.MFieldSchema&quot; is tagged as &quot;embedded-only&quot; so does not have its own datastore table.</span><br><span class="line">19/03/16 20:41:03 INFO DataNucleus.Datastore: The class &quot;org.apache.hadoop.hive.metastore.model.MOrder&quot; is tagged as &quot;embedded-only&quot; so does not have its own datastore table.</span><br><span class="line">19/03/16 20:41:05 INFO DataNucleus.Datastore: The class &quot;org.apache.hadoop.hive.metastore.model.MFieldSchema&quot; is tagged as &quot;embedded-only&quot; so does not have its own datastore table.</span><br><span class="line">19/03/16 20:41:05 INFO DataNucleus.Datastore: The class &quot;org.apache.hadoop.hive.metastore.model.MOrder&quot; is tagged as &quot;embedded-only&quot; so does not have its own datastore table.</span><br><span class="line">19/03/16 20:41:06 INFO metastore.MetaStoreDirectSql: Using direct SQL, underlying DB is DERBY</span><br><span class="line">19/03/16 20:41:06 INFO metastore.ObjectStore: Initialized ObjectStore</span><br><span class="line">19/03/16 20:41:07 WARN metastore.ObjectStore: Version information not found in metastore. hive.metastore.schema.verification is not enabled so recording the schema version 1.2.0</span><br><span class="line">19/03/16 20:41:07 WARN metastore.ObjectStore: Failed to get database default, returning NoSuchObjectException</span><br><span class="line">19/03/16 20:41:11 INFO metastore.HiveMetaStore: Added admin role in metastore</span><br><span class="line">19/03/16 20:41:11 INFO metastore.HiveMetaStore: Added public role in metastore</span><br><span class="line">19/03/16 20:41:11 INFO metastore.HiveMetaStore: No user is added in admin role, since config is empty</span><br><span class="line">19/03/16 20:41:12 INFO metastore.HiveMetaStore: 0: get_all_databases</span><br><span class="line">19/03/16 20:41:12 INFO HiveMetaStore.audit: ugi=root    ip=unknown-ip-addr      cmd=get_all_databases</span><br><span class="line">19/03/16 20:41:12 INFO metastore.HiveMetaStore: 0: get_functions: db=default pat=*</span><br><span class="line">19/03/16 20:41:12 INFO HiveMetaStore.audit: ugi=root    ip=unknown-ip-addr      cmd=get_functions: db=default pat=*</span><br><span class="line">19/03/16 20:41:12 INFO DataNucleus.Datastore: The class &quot;org.apache.hadoop.hive.metastore.model.MResourceUri&quot; is tagged as &quot;embedded-only&quot; so does not have its own datastore table.</span><br><span class="line">19/03/16 20:41:13 INFO session.SessionState: Created local directory: /tmp/6a909914-1d3e-40f9-b997-ec14d17ef1db_resources</span><br><span class="line">19/03/16 20:41:14 INFO session.SessionState: Created HDFS directory: /tmp/hive/root/6a909914-1d3e-40f9-b997-ec14d17ef1db</span><br><span class="line">19/03/16 20:41:14 INFO session.SessionState: Created local directory: /tmp/root/6a909914-1d3e-40f9-b997-ec14d17ef1db</span><br><span class="line">19/03/16 20:41:14 INFO session.SessionState: Created HDFS directory: /tmp/hive/root/6a909914-1d3e-40f9-b997-ec14d17ef1db/_tmp_space.db</span><br><span class="line">19/03/16 20:41:15 INFO spark.SparkContext: Running Spark version 2.2.0</span><br><span class="line">19/03/16 20:41:15 INFO spark.SparkContext: Submitted application: SparkSQL::192.168.83.10</span><br><span class="line">19/03/16 20:41:15 INFO spark.SecurityManager: Changing view acls to: root</span><br><span class="line">19/03/16 20:41:15 INFO spark.SecurityManager: Changing modify acls to: root</span><br><span class="line">19/03/16 20:41:15 INFO spark.SecurityManager: Changing view acls groups to: </span><br><span class="line">19/03/16 20:41:15 INFO spark.SecurityManager: Changing modify acls groups to: </span><br><span class="line">19/03/16 20:41:15 INFO spark.SecurityManager: SecurityManager: authentication disabled; ui acls disabled; users  with view permissions: Set(root); groups with view permissions: Set(); users  with modify permissions: Set(root); groups with modify permissions: Set()</span><br><span class="line">19/03/16 20:41:17 INFO util.Utils: Successfully started service &apos;sparkDriver&apos; on port 58142.</span><br><span class="line">19/03/16 20:41:17 INFO spark.SparkEnv: Registering MapOutputTracker</span><br><span class="line">19/03/16 20:41:17 INFO spark.SparkEnv: Registering BlockManagerMaster</span><br><span class="line">19/03/16 20:41:17 INFO storage.BlockManagerMasterEndpoint: Using org.apache.spark.storage.DefaultTopologyMapper for getting topology information</span><br><span class="line">19/03/16 20:41:17 INFO storage.BlockManagerMasterEndpoint: BlockManagerMasterEndpoint up</span><br><span class="line">19/03/16 20:41:17 INFO storage.DiskBlockManager: Created local directory at /tmp/blockmgr-f02e18ee-fc40-4a05-80ba-0c60c369ed5a</span><br><span class="line">19/03/16 20:41:17 INFO memory.MemoryStore: MemoryStore started with capacity 413.9 MB</span><br><span class="line">19/03/16 20:41:18 INFO spark.SparkEnv: Registering OutputCommitCoordinator</span><br><span class="line">19/03/16 20:41:18 INFO util.log: Logging initialized @42429ms</span><br><span class="line">19/03/16 20:41:19 INFO server.Server: jetty-9.3.z-SNAPSHOT</span><br><span class="line">19/03/16 20:41:19 INFO server.Server: Started @42899ms</span><br><span class="line">19/03/16 20:41:19 WARN util.Utils: Service &apos;SparkUI&apos; could not bind on port 4040. Attempting port 4041.</span><br><span class="line">19/03/16 20:41:19 INFO server.AbstractConnector: Started ServerConnector@2e49b91c&#123;HTTP/1.1,[http/1.1]&#125;&#123;0.0.0.0:4041&#125;</span><br><span class="line">19/03/16 20:41:19 INFO util.Utils: Successfully started service &apos;SparkUI&apos; on port 4041.</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@18c7f6b5&#123;/jobs,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@53bb71e5&#123;/jobs/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@15994b0b&#123;/jobs/job,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@4cb00fa5&#123;/jobs/job/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@698d6d30&#123;/stages,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@3407aa4f&#123;/stages/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@538b3c88&#123;/stages/stage,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@22ae905f&#123;/stages/stage/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@4fbaa7f5&#123;/stages/pool,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@6d4a05f7&#123;/stages/pool/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@4b476233&#123;/storage,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@4f235e8e&#123;/storage/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@29dcdd1c&#123;/storage/rdd,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@524f5ea5&#123;/storage/rdd/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@17134190&#123;/environment,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@5599b5bb&#123;/environment/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@4264beb8&#123;/executors,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@7cd3e0da&#123;/executors/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@67e77f52&#123;/executors/threadDump,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@1d1bf7bf&#123;/executors/threadDump/json,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@4d43a1b7&#123;/static,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@44aa91e2&#123;/,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@650a1aff&#123;/api,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@11c7a0b4&#123;/jobs/job/kill,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@653a5967&#123;/stages/stage/kill,null,AVAILABLE,@Spark&#125;</span><br><span class="line">19/03/16 20:41:19 INFO ui.SparkUI: Bound SparkUI to 0.0.0.0, and started at http://192.168.83.10:4041</span><br><span class="line">19/03/16 20:41:19 INFO spark.SparkContext: Added JAR file:/root/mysql-connector-java-5.1.38.jar at spark://192.168.83.10:58142/jars/mysql-connector-java-5.1.38.jar with timestamp 1552740079770</span><br><span class="line">19/03/16 20:41:20 INFO client.StandaloneAppClient$ClientEndpoint: Connecting to master spark://master:7077...</span><br><span class="line">19/03/16 20:41:20 INFO client.TransportClientFactory: Successfully created connection to master/192.168.83.10:7077 after 132 ms (0 ms spent in bootstraps)</span><br><span class="line">19/03/16 20:41:40 INFO client.StandaloneAppClient$ClientEndpoint: Connecting to master spark://master:7077...</span><br><span class="line">19/03/16 20:42:00 INFO client.StandaloneAppClient$ClientEndpoint: Connecting to master spark://master:7077...</span><br><span class="line">19/03/16 20:42:20 ERROR cluster.StandaloneSchedulerBackend: Application has been killed. Reason: All masters are unresponsive! Giving up.</span><br><span class="line">19/03/16 20:42:20 WARN cluster.StandaloneSchedulerBackend: Application ID is not initialized yet.</span><br><span class="line">19/03/16 20:42:20 INFO util.Utils: Successfully started service &apos;org.apache.spark.network.netty.NettyBlockTransferService&apos; on port 34217.</span><br><span class="line">19/03/16 20:42:20 INFO netty.NettyBlockTransferService: Server created on 192.168.83.10:34217</span><br><span class="line">19/03/16 20:42:20 INFO storage.BlockManager: Using org.apache.spark.storage.RandomBlockReplicationPolicy for block replication policy</span><br><span class="line">19/03/16 20:42:20 INFO storage.BlockManagerMaster: Registering BlockManager BlockManagerId(driver, 192.168.83.10, 34217, None)</span><br><span class="line">19/03/16 20:42:20 INFO server.AbstractConnector: Stopped Spark@2e49b91c&#123;HTTP/1.1,[http/1.1]&#125;&#123;0.0.0.0:4041&#125;</span><br><span class="line">19/03/16 20:42:20 INFO ui.SparkUI: Stopped Spark web UI at http://192.168.83.10:4041</span><br><span class="line">19/03/16 20:42:20 INFO storage.BlockManagerMasterEndpoint: Registering block manager 192.168.83.10:34217 with 413.9 MB RAM, BlockManagerId(driver, 192.168.83.10, 34217, None)</span><br><span class="line">19/03/16 20:42:20 INFO cluster.StandaloneSchedulerBackend: Shutting down all executors</span><br><span class="line">19/03/16 20:42:20 INFO storage.BlockManagerMaster: Registered BlockManager BlockManagerId(driver, 192.168.83.10, 34217, None)</span><br><span class="line">19/03/16 20:42:20 INFO storage.BlockManager: Initialized BlockManager: BlockManagerId(driver, 192.168.83.10, 34217, None)</span><br><span class="line">19/03/16 20:42:20 INFO cluster.CoarseGrainedSchedulerBackend$DriverEndpoint: Asking each executor to shut down</span><br><span class="line">19/03/16 20:42:20 WARN client.StandaloneAppClient$ClientEndpoint: Drop UnregisterApplication(null) because has not yet connected to master</span><br><span class="line">19/03/16 20:42:20 INFO spark.MapOutputTrackerMasterEndpoint: MapOutputTrackerMasterEndpoint stopped!</span><br><span class="line">19/03/16 20:42:21 INFO memory.MemoryStore: MemoryStore cleared</span><br><span class="line">19/03/16 20:42:21 INFO storage.BlockManager: BlockManager stopped</span><br><span class="line">19/03/16 20:42:21 INFO storage.BlockManagerMaster: BlockManagerMaster stopped</span><br><span class="line">19/03/16 20:42:21 INFO scheduler.OutputCommitCoordinator$OutputCommitCoordinatorEndpoint: OutputCommitCoordinator stopped!</span><br><span class="line">19/03/16 20:42:21 ERROR spark.SparkContext: Error initializing SparkContext.</span><br><span class="line">java.lang.IllegalArgumentException: requirement failed: Can only call getServletHandlers on a running MetricsSystem</span><br><span class="line">        at scala.Predef$.require(Predef.scala:224)</span><br><span class="line">        at org.apache.spark.metrics.MetricsSystem.getServletHandlers(MetricsSystem.scala:91)</span><br><span class="line">        at org.apache.spark.SparkContext.&lt;init&gt;(SparkContext.scala:524)</span><br><span class="line">        at org.apache.spark.SparkContext$.getOrCreate(SparkContext.scala:2509)</span><br><span class="line">        at org.apache.spark.sql.SparkSession$Builder$$anonfun$6.apply(SparkSession.scala:909)</span><br><span class="line">        at org.apache.spark.sql.SparkSession$Builder$$anonfun$6.apply(SparkSession.scala:901)</span><br><span class="line">        at scala.Option.getOrElse(Option.scala:121)</span><br><span class="line">        at org.apache.spark.sql.SparkSession$Builder.getOrCreate(SparkSession.scala:901)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLEnv$.init(SparkSQLEnv.scala:48)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.&lt;init&gt;(SparkSQLCLIDriver.scala:293)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver$.main(SparkSQLCLIDriver.scala:138)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.main(SparkSQLCLIDriver.scala)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:755)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.doRunMain$1(SparkSubmit.scala:180)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.submit(SparkSubmit.scala:205)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:119)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)</span><br><span class="line">19/03/16 20:42:21 INFO spark.SparkContext: SparkContext already stopped.</span><br><span class="line">19/03/16 20:42:21 INFO spark.SparkContext: Successfully stopped SparkContext</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: requirement failed: Can only call getServletHandlers on a running MetricsSystem</span><br><span class="line">        at scala.Predef$.require(Predef.scala:224)</span><br><span class="line">        at org.apache.spark.metrics.MetricsSystem.getServletHandlers(MetricsSystem.scala:91)</span><br><span class="line">        at org.apache.spark.SparkContext.&lt;init&gt;(SparkContext.scala:524)</span><br><span class="line">        at org.apache.spark.SparkContext$.getOrCreate(SparkContext.scala:2509)</span><br><span class="line">        at org.apache.spark.sql.SparkSession$Builder$$anonfun$6.apply(SparkSession.scala:909)</span><br><span class="line">        at org.apache.spark.sql.SparkSession$Builder$$anonfun$6.apply(SparkSession.scala:901)</span><br><span class="line">        at scala.Option.getOrElse(Option.scala:121)</span><br><span class="line">        at org.apache.spark.sql.SparkSession$Builder.getOrCreate(SparkSession.scala:901)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLEnv$.init(SparkSQLEnv.scala:48)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.&lt;init&gt;(SparkSQLCLIDriver.scala:293)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver$.main(SparkSQLCLIDriver.scala:138)</span><br><span class="line">        at org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.main(SparkSQLCLIDriver.scala)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:755)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.doRunMain$1(SparkSubmit.scala:180)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.submit(SparkSubmit.scala:205)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:119)</span><br><span class="line">        at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)</span><br><span class="line">19/03/16 20:42:21 INFO util.ShutdownHookManager: Shutdown hook called</span><br><span class="line">19/03/16 20:42:21 INFO util.ShutdownHookManager: Deleting directory /tmp/spark-06aa1468-390b-4e70-9151-405bd556805a</span><br><span class="line">19/03/16 20:42:22 INFO util.ShutdownHookManager: Deleting directory /tmp/spark-6774f957-ed7c-4d8b-b3ce-eaf17bda1df1</span><br></pre></td></tr></table></figure><h1 id="问题原因-amp-解决方法"><a href="#问题原因-amp-解决方法" class="headerlink" title="问题原因 &amp; 解决方法"></a>问题原因 &amp; 解决方法</h1><blockquote><ul><li>由于spark 配置为高可用模式下，要启动zookeeper</li></ul></blockquote><h1 id="启动zookeeper后正常启动"><a href="#启动zookeeper后正常启动" class="headerlink" title="启动zookeeper后正常启动"></a>启动zookeeper后正常启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master sbin]# ./start-all.sh </span><br><span class="line">starting org.apache.spark.deploy.master.Master, logging to /opt/spark-2.2.0/logs/</span><br><span class="line"></span><br><span class="line">.................  日志量太大 此处省略  ...........................</span><br><span class="line"></span><br><span class="line">19/03/16 20:47:52 INFO client.HiveClientImpl: Warehouse location for Hive client (version 1.2.1) is file:/opt/spark-2.2.0/sbin/spark-warehouse</span><br><span class="line"></span><br><span class="line">spark-sql&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;运行环境 | centos 7.0 | spark 2.2.0 | scala-2.11.8 | mysql-connector-java-5.1.38.jar&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&quot;启动saprk-sql报错&quot;&gt;&lt;a href=&quot;#启动saprk-sql报错&quot; class=&quot;headerlink&quot; title=&quot;启动saprk-sql报错&quot;&gt;&lt;/a&gt;启动saprk-sql报错&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;19/03/16 20:40:48 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="改错" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/"/>
    
      <category term="spark-sql" scheme="http://www.ibiji.top/categories/%E6%94%B9%E9%94%99/centos/spark-sql/"/>
    
    
      <category term="linux" scheme="http://www.ibiji.top/tags/linux/"/>
    
      <category term="error" scheme="http://www.ibiji.top/tags/error/"/>
    
      <category term="centos" scheme="http://www.ibiji.top/tags/centos/"/>
    
      <category term="spark-sql" scheme="http://www.ibiji.top/tags/spark-sql/"/>
    
  </entry>
  
</feed>
